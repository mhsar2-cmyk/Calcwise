<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="google-site-verification" content="vjZJ7FIIQEzuqWHnktvhfF-XDMZ4jFHz1xGMrJgskS0" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#6C63FF">
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icon-192.png">
  <title>CalcWise ‚Äì Free Online Calculators for Finance, Health & Math</title>
  <meta name="description"
    content="Free online calculators for finance, health, fitness, and math. Instant results, no signup required. Mortgage, BMI, loan, calorie, and 30+ more calculators.">
  <meta name="keywords"
    content="online calculator, mortgage calculator, BMI calculator, loan calculator, calorie calculator, free calculators">

  <!-- ‚îÄ‚îÄ CANONICAL & HREFLANG ‚îÄ‚îÄ -->
  <link rel="canonical" href="https://calcwises.com/">
  <link rel="alternate" hreflang="en" href="https://calcwises.com/">
  <link rel="alternate" hreflang="ar" href="https://calcwises.com/index-ar.html">
  <link rel="alternate" hreflang="x-default" href="https://calcwises.com/">

  <script>
    (function () {
      const saved = localStorage.getItem('cw-theme');
      if (saved === 'light') {
        document.documentElement.setAttribute('data-theme', 'light');
      }
    })();
  </script>

  <!-- ‚îÄ‚îÄ OPEN GRAPH ‚îÄ‚îÄ -->
  <meta property="og:type" content="website">
  <meta property="og:site_name" content="CalcWise">
  <meta property="og:title" content="CalcWise ‚Äì 36+ Free Online Calculators">
  <meta property="og:description"
    content="Free online calculators for finance, health, fitness, and math. Instant results, no signup. Mortgage, BMI, loan, calorie, and more.">
  <meta property="og:url" content="https://calcwises.com/">
  <meta property="og:image" content="https://calcwises.com/og-image.png">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:locale" content="en_US">
  <meta property="og:locale:alternate" content="ar_SA">

  <!-- ‚îÄ‚îÄ TWITTER CARD ‚îÄ‚îÄ -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="CalcWise ‚Äì 36+ Free Online Calculators">
  <meta name="twitter:description"
    content="Free calculators for finance, health, fitness & math. Instant results, no signup.">
  <meta name="twitter:image" content="https://calcwises.com/og-image.png">

  <!-- ‚îÄ‚îÄ STRUCTURED DATA (JSON-LD) ‚îÄ‚îÄ -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "CalcWise",
    "url": "https://calcwises.com",
    "description": "36+ free online calculators for finance, health, fitness, and math. Instant results with no signup required.",
    "applicationCategory": "UtilitiesApplication",
    "operatingSystem": "All",
    "offers": {
      "@type": "Offer",
      "price": "0",
      "priceCurrency": "USD"
    },
    "aggregateRating": {
      "@type": "AggregateRating",
      "ratingValue": "4.8",
      "ratingCount": "150",
      "bestRating": "5"
    },
    "featureList": "Mortgage Calculator, BMI Calculator, Loan Calculator, Calorie Calculator, Currency Converter, Compound Interest, Tip Calculator, Body Fat Calculator, Macros Calculator, Percentage Calculator, Salary Calculator, Tax Calculator, Inflation Calculator, ROI Calculator, Credit Card Payoff, Pregnancy Due Date, Heart Rate Zones, Age Calculator, Ideal Weight, Sleep Calculator, Quadratic Equation, Probability Calculator, Geometry Calculator, Number Base Converter, Speed Distance Time, Time Zone Converter, Cooking Converter, Scientific Calculator, Unit Converter, Random Number Generator, Date Calculator, GPA Calculator, Retirement Planner, Water Intake Calculator",
    "inLanguage": ["en", "ar"],
    "creator": {
      "@type": "Organization",
      "name": "CalcWise",
      "url": "https://calcwises.com"
    }
  }
  </script>

  <!-- ‚îÄ‚îÄ GOOGLE ANALYTICS 4 ‚îÄ‚îÄ -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-XXXXXXXXXX');
  </script>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link
    href="https://fonts.googleapis.com/css2?family=Instrument+Serif:ital@0;1&family=Outfit:wght@300;400;500;600;700&display=swap"
    rel="stylesheet">
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5388783007820121"
    crossorigin="anonymous"></script>
  <style>
    :root {
      --bg: #07071a;
      --surface: rgba(255, 255, 255, 0.04);
      --surface2: rgba(255, 255, 255, 0.07);
      --border: rgba(255, 255, 255, 0.09);
      --border2: rgba(108, 99, 255, 0.45);
      --text: #e8e8f0;
      --muted: #7070a0;
      --muted2: #9090b8;
      --accent: #6c63ff;
      --accent2: #8b84ff;
      --accent3: #b3aeff;
      --green: #22d3a0;
      --orange: #ff8c42;
      --pink: #ff6b9d;
      --blue: #4da6ff;
      --yellow: #ffd166;
      --radius: 16px;
      --radius-sm: 10px;
      --shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
      --shadow-lg: 0 24px 80px rgba(0, 0, 0, 0.6);
      --glow: 0 0 60px rgba(108, 99, 255, 0.25);
      --glass: rgba(255, 255, 255, 0.04);
      --glass-border: rgba(255, 255, 255, 0.09);
      --glass-blur: blur(20px) saturate(160%);
    }

    *,
    *::before,
    *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html {
      scroll-behavior: smooth;
    }

    body {
      font-family: 'Outfit', sans-serif;
      background: var(--bg);
      background-attachment: fixed;
      color: var(--text);
      line-height: 1.6;
      min-height: 100vh;
      overflow-x: hidden;
      transition: background 0.3s ease, color 0.3s ease;
    }

    /* Ambient orbs */
    body::before {
      content: '';
      position: fixed;
      inset: 0;
      z-index: 0;
      pointer-events: none;
      background:
        radial-gradient(ellipse 700px 500px at 15% 10%, rgba(108, 99, 255, 0.18) 0%, transparent 70%),
        radial-gradient(ellipse 500px 400px at 85% 5%, rgba(77, 166, 255, 0.13) 0%, transparent 65%),
        radial-gradient(ellipse 600px 400px at 50% 95%, rgba(255, 107, 157, 0.1) 0%, transparent 70%);
    }

    /* ‚îÄ‚îÄ NAV ‚îÄ‚îÄ */
    nav {
      position: sticky;
      top: 0;
      z-index: 100;
      background: rgba(7, 7, 26, 0.6);
      backdrop-filter: blur(28px) saturate(180%);
      -webkit-backdrop-filter: blur(28px) saturate(180%);
      border-bottom: 1px solid rgba(255, 255, 255, 0.07);
      padding: 0 2rem;
    }

    .nav-inner {
      max-width: 1280px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
      height: 60px;
    }

    .logo {
      font-family: 'Outfit', sans-serif;
      font-weight: 800;
      font-size: 1.5rem;
      color: var(--text);
      text-decoration: none;
      letter-spacing: -0.02em;
      display: flex;
      align-items: center;
      gap: 0.4rem;
    }

    .logo-dot {
      color: var(--accent);
    }

    .nav-search {
      display: flex;
      align-items: center;
      background: rgba(255, 255, 255, 0.06);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 100px;
      padding: 0.3rem 0.75rem;
      gap: 0.4rem;
      width: 200px;
      transition: border-color 0.25s, width 0.25s, box-shadow 0.25s;
      backdrop-filter: blur(10px);
    }

    .nav-search:focus-within {
      border-color: rgba(108, 99, 255, 0.6);
      width: 230px;
      box-shadow: 0 0 0 3px rgba(108, 99, 255, 0.12);
    }

    .nav-search input {
      background: none;
      border: none;
      outline: none;
      color: var(--text);
      font-family: inherit;
      font-size: 0.8rem;
      width: 100%;
    }

    .nav-search input::placeholder {
      color: var(--muted);
    }

    .nav-cats {
      display: flex;
      gap: 0.25rem;
      list-style: none;
    }

    .nav-cats button {
      background: none;
      border: none;
      cursor: pointer;
      color: var(--muted);
      font-family: inherit;
      font-size: 0.85rem;
      font-weight: 500;
      padding: 0.35rem 0.85rem;
      border-radius: 100px;
      transition: all 0.2s;
    }

    .nav-cats button:hover,
    .nav-cats button.active {
      background: rgba(108, 99, 255, 0.18);
      border: 1px solid rgba(108, 99, 255, 0.35);
      color: var(--text);
    }

    /* ‚îÄ‚îÄ HERO ‚îÄ‚îÄ */
    .hero {
      position: relative;
      z-index: 1;
      text-align: center;
      padding: 5rem 2rem 3.5rem;
      overflow: hidden;
    }

    .hero-glow {
      position: absolute;
      top: -100px;
      left: 50%;
      transform: translateX(-50%);
      width: 600px;
      height: 400px;
      background: radial-gradient(ellipse, rgba(108, 99, 255, 0.2) 0%, transparent 70%);
      pointer-events: none;
    }

    .hero-eyebrow {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      border: 1px solid rgba(255, 255, 255, 0.12);
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(12px);
      padding: 0.35rem 1rem;
      border-radius: 100px;
      font-size: 0.8rem;
      color: var(--muted2);
      margin-bottom: 1.75rem;
      letter-spacing: 0.05em;
      text-transform: uppercase;
    }

    .hero-eyebrow span {
      color: var(--accent2);
    }

    .hero h1 {
      font-family: 'Outfit', sans-serif;
      font-weight: 800;
      font-size: clamp(2.8rem, 7vw, 5rem);
      line-height: 1.08;
      letter-spacing: -0.03em;
      margin-bottom: 1.25rem;
    }

    .hero h1 em {
      font-style: italic;
      color: var(--accent2);
    }

    .hero p {
      font-size: 1.1rem;
      color: var(--muted2);
      max-width: 520px;
      margin: 0 auto 2.5rem;
      font-weight: 300;
      line-height: 1.7;
    }

    .hero-stats {
      display: flex;
      justify-content: center;
      gap: 3rem;
      flex-wrap: wrap;
    }

    .stat {
      text-align: center;
    }

    .stat-num {
      font-family: 'Outfit', sans-serif;
      font-weight: 800;
      font-size: 2rem;
      color: var(--text);
      display: block;
      letter-spacing: -0.02em;
    }

    .stat-label {
      font-size: 0.8rem;
      color: var(--muted);
    }

    /* ‚îÄ‚îÄ AD BANNER ‚îÄ‚îÄ */
    .ad-wrap {
      position: relative;
      z-index: 1;
      max-width: 1280px;
      margin: 0 auto;
      padding: 0 2rem;
    }

    .ad-unit {
      background: var(--surface);
      border: 1px dashed var(--border2);
      border-radius: var(--radius);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--muted);
      font-size: 0.72rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    .ad-unit.leaderboard {
      height: 90px;
      margin: 1.5rem 0;
    }

    .ad-unit.rectangle {
      height: 250px;
      max-width: 336px;
    }

    .ad-unit.sidebar {
      height: 600px;
      width: 160px;
    }

    /* ‚îÄ‚îÄ MAIN LAYOUT ‚îÄ‚îÄ */
    .main-wrap {
      position: relative;
      z-index: 1;
      max-width: 1280px;
      margin: 0 auto;
      padding: 2rem;
      display: grid;
      grid-template-columns: 1fr 180px;
      gap: 2rem;
      align-items: start;
    }

    .main-content {
      min-width: 0;
    }

    .sidebar-col {
      position: sticky;
      top: 80px;
    }

    /* ‚îÄ‚îÄ CATEGORY TABS ‚îÄ‚îÄ */
    .cat-tabs {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
      margin-bottom: 2rem;
    }

    .cat-tab {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      background: rgba(255, 255, 255, 0.04);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 100px;
      padding: 0.45rem 1rem;
      cursor: pointer;
      font-family: inherit;
      font-size: 0.85rem;
      font-weight: 500;
      color: var(--muted2);
      transition: all 0.25s;
      backdrop-filter: blur(10px);
    }

    .cat-tab:hover {
      border-color: rgba(108, 99, 255, 0.35);
      background: rgba(108, 99, 255, 0.08);
      color: var(--text);
    }

    .cat-tab.active {
      background: rgba(108, 99, 255, 0.25);
      border-color: rgba(108, 99, 255, 0.55);
      color: white;
      box-shadow: 0 0 20px rgba(108, 99, 255, 0.25);
    }

    .cat-tab .tab-icon {
      font-size: 1rem;
    }

    /* ‚îÄ‚îÄ CALCULATOR GRID ‚îÄ‚îÄ */
    .calc-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 1.25rem;
      margin-bottom: 2rem;
    }

    .calc-card {
      background: rgba(255, 255, 255, 0.04);
      backdrop-filter: blur(20px) saturate(150%);
      -webkit-backdrop-filter: blur(20px) saturate(150%);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: var(--radius);
      padding: 1.5rem;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.34, 1.3, 0.64, 1);
      position: relative;
      overflow: hidden;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.35), inset 0 1px 0 rgba(255, 255, 255, 0.06);
    }

    .calc-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, var(--card-color, var(--accent)), transparent);
      opacity: 0;
      transition: opacity 0.3s;
    }

    .calc-card:hover {
      background: rgba(255, 255, 255, 0.07);
      border-color: rgba(108, 99, 255, 0.4);
      transform: translateY(-5px);
      box-shadow: 0 16px 48px rgba(108, 99, 255, 0.18), inset 0 1px 0 rgba(255, 255, 255, 0.1);
    }

    .calc-card:hover::before {
      opacity: 1;
    }

    .card-icon {
      width: 44px;
      height: 44px;
      background: rgba(255, 255, 255, 0.07);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.3rem;
      margin-bottom: 0.9rem;
      transition: all 0.25s;
    }

    .calc-card:hover .card-icon {
      background: color-mix(in srgb, var(--card-color, var(--accent)) 20%, rgba(255, 255, 255, 0.07));
      border-color: color-mix(in srgb, var(--card-color, var(--accent)) 40%, transparent);
    }

    .calc-card h3 {
      font-size: 0.95rem;
      font-weight: 600;
      margin-bottom: 0.3rem;
    }

    .calc-card p {
      font-size: 0.8rem;
      color: var(--muted);
      line-height: 1.5;
    }

    .card-tag {
      position: absolute;
      top: 1rem;
      right: 1rem;
      background: var(--card-color, var(--accent));
      color: white;
      font-size: 0.62rem;
      font-weight: 700;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      padding: 0.2rem 0.5rem;
      border-radius: 4px;
      opacity: 0.9;
    }

    /* ‚îÄ‚îÄ CALCULATOR MODAL ‚îÄ‚îÄ */
    .modal-overlay {
      position: fixed;
      inset: 0;
      z-index: 200;
      background: rgba(4, 4, 18, 0.75);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      display: none;
      align-items: center;
      justify-content: center;
      padding: 1rem;
    }

    .modal-overlay.open {
      display: flex;
    }

    .modal {
      background: rgba(10, 10, 30, 0.75);
      backdrop-filter: blur(36px) saturate(180%);
      -webkit-backdrop-filter: blur(36px) saturate(180%);
      border: 1px solid rgba(255, 255, 255, 0.12);
      border-radius: 22px;
      width: 100%;
      max-width: 680px;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 24px 80px rgba(0, 0, 0, 0.65), 0 0 0 1px rgba(108, 99, 255, 0.12), inset 0 1px 0 rgba(255, 255, 255, 0.08);
      animation: modalIn 0.3s cubic-bezier(0.34, 1.4, 0.64, 1);
    }

    @keyframes modalIn {
      from {
        opacity: 0;
        transform: translateY(20px) scale(0.97);
      }

      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    .modal-header {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1.5rem 1.75rem;
      border-bottom: 1px solid var(--border);
    }

    .modal-icon {
      width: 52px;
      height: 52px;
      border-radius: 14px;
      background: rgba(255, 255, 255, 0.07);
      border: 1px solid rgba(255, 255, 255, 0.1);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      flex-shrink: 0;
    }

    .modal-header h2 {
      font-family: 'Outfit', sans-serif;
      font-weight: 800;
      font-size: 1.5rem;
      letter-spacing: -0.02em;
    }

    .modal-header p {
      font-size: 0.83rem;
      color: var(--muted2);
      margin-top: 0.15rem;
    }

    .modal-close {
      margin-left: auto;
      background: rgba(255, 255, 255, 0.06);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      width: 36px;
      height: 36px;
      cursor: pointer;
      color: var(--muted2);
      font-size: 1.1rem;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
      flex-shrink: 0;
    }

    .modal-close:hover {
      background: rgba(255, 255, 255, 0.1);
      border-color: rgba(108, 99, 255, 0.4);
      color: var(--text);
    }

    .modal-body {
      padding: 1.75rem;
    }

    /* ‚îÄ‚îÄ FORM ELEMENTS ‚îÄ‚îÄ */
    .field-group {
      margin-bottom: 1.25rem;
    }

    .field-group label {
      display: block;
      font-size: 0.82rem;
      font-weight: 600;
      color: var(--muted2);
      margin-bottom: 0.4rem;
      letter-spacing: 0.03em;
      text-transform: uppercase;
    }

    .input-wrap {
      position: relative;
    }

    .input-prefix,
    .input-suffix {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      color: var(--muted);
      font-size: 0.9rem;
      font-weight: 500;
      pointer-events: none;
    }

    .input-prefix {
      left: 0.9rem;
    }

    .input-suffix {
      right: 0.9rem;
    }

    input[type="number"],
    input[type="text"],
    select {
      width: 100%;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: var(--radius-sm);
      padding: 0.7rem 0.9rem;
      font-family: inherit;
      font-size: 0.95rem;
      color: var(--text);
      outline: none;
      transition: border-color 0.25s, box-shadow 0.25s;
      appearance: none;
      backdrop-filter: blur(8px);
    }

    input[type="number"]:focus,
    input[type="text"]:focus,
    select:focus {
      border-color: rgba(108, 99, 255, 0.6);
      box-shadow: 0 0 0 3px rgba(108, 99, 255, 0.12);
    }

    .has-prefix input {
      padding-left: 2rem;
    }

    .has-suffix input {
      padding-right: 2.5rem;
    }

    select {
      cursor: pointer;
    }

    .field-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
    }

    .field-row-3 {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 1rem;
    }

    .calc-btn {
      width: 100%;
      background: linear-gradient(135deg, rgba(108, 99, 255, 0.8), rgba(139, 132, 255, 0.7));
      border: 1px solid rgba(108, 99, 255, 0.5);
      border-radius: var(--radius-sm);
      padding: 0.85rem;
      color: white;
      font-family: inherit;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.25s;
      margin-top: 0.5rem;
      backdrop-filter: blur(10px);
      box-shadow: 0 4px 20px rgba(108, 99, 255, 0.3);
    }

    .calc-btn:hover {
      background: linear-gradient(135deg, rgba(108, 99, 255, 1), rgba(139, 132, 255, 0.9));
      transform: translateY(-2px);
      box-shadow: 0 8px 30px rgba(108, 99, 255, 0.45);
    }

    /* ‚îÄ‚îÄ RESULTS ‚îÄ‚îÄ */
    .results {
      display: none;
      margin-top: 1.5rem;
      background: rgba(255, 255, 255, 0.04);
      border: 1px solid rgba(108, 99, 255, 0.2);
      border-radius: var(--radius);
      padding: 1.5rem;
      backdrop-filter: blur(16px);
    }

    .results.show {
      display: block;
    }

    .results h3 {
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.08em;
      margin-bottom: 1rem;
    }

    .result-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 1rem;
    }

    .result-item {
      text-align: center;
    }

    .result-value {
      font-family: 'Outfit', sans-serif;
      font-weight: 800;
      font-size: 1.8rem;
      color: var(--accent2);
      display: block;
      line-height: 1.1;
      letter-spacing: -0.02em;
    }

    .result-label {
      font-size: 0.78rem;
      color: var(--muted);
      margin-top: 0.25rem;
    }

    .result-highlight {
      background: linear-gradient(135deg, rgba(108, 99, 255, 0.2), rgba(108, 99, 255, 0.07));
      border: 1px solid rgba(108, 99, 255, 0.35);
      border-radius: 12px;
      padding: 1rem;
      text-align: center;
      margin-bottom: 1rem;
      box-shadow: 0 0 30px rgba(108, 99, 255, 0.12);
    }

    .result-highlight .result-value {
      font-size: 2.4rem;
    }

    .result-note {
      font-size: 0.8rem;
      color: var(--muted);
      margin-top: 1rem;
      padding-top: 1rem;
      border-top: 1px solid var(--border);
      line-height: 1.6;
    }

    /* Result bar chart */
    .result-bar {
      margin-top: 1rem;
    }

    .bar-row {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 0.6rem;
      font-size: 0.82rem;
    }

    .bar-label {
      width: 130px;
      color: var(--muted2);
      flex-shrink: 0;
      text-align: right;
    }

    .bar-track {
      flex: 1;
      background: rgba(255, 255, 255, 0.06);
      border-radius: 100px;
      height: 8px;
      overflow: hidden;
    }

    .bar-fill {
      height: 100%;
      border-radius: 100px;
      transition: width 0.6s ease;
    }

    .bar-val {
      width: 80px;
      color: var(--text);
      font-weight: 500;
    }

    /* ‚îÄ‚îÄ MODAL AD ‚îÄ‚îÄ */
    .modal-ad {
      background: var(--bg);
      border: 1px dashed var(--border);
      border-radius: var(--radius-sm);
      margin-top: 1.5rem;
      height: 90px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--muted);
      font-size: 0.7rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    /* ‚îÄ‚îÄ SECTION HEADER ‚îÄ‚îÄ */
    .section-head {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 1.25rem;
    }

    .section-head h2 {
      font-family: 'Outfit', sans-serif;
      font-weight: 800;
      font-size: 1.4rem;
      letter-spacing: -0.02em;
    }

    .section-badge {
      background: rgba(108, 99, 255, 0.12);
      border: 1px solid rgba(108, 99, 255, 0.25);
      border-radius: 100px;
      padding: 0.2rem 0.6rem;
      font-size: 0.72rem;
      color: var(--accent3);
      font-weight: 600;
    }

    /* ‚îÄ‚îÄ FOOTER ‚îÄ‚îÄ */
    footer {
      position: relative;
      z-index: 1;
      border-top: 1px solid rgba(255, 255, 255, 0.07);
      background: rgba(7, 7, 26, 0.6);
      backdrop-filter: blur(20px);
      padding: 3rem 2rem 2rem;
      margin-top: 4rem;
    }

    .footer-inner {
      max-width: 1280px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: 2fr 1fr 1fr 1fr;
      gap: 2.5rem;
      margin-bottom: 2.5rem;
    }

    .footer-brand .logo {
      font-size: 1.25rem;
      margin-bottom: 0.75rem;
      display: inline-block;
    }

    .footer-brand p {
      font-size: 0.85rem;
      color: var(--muted);
      line-height: 1.7;
      max-width: 280px;
    }

    footer h4 {
      font-size: 0.8rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--muted);
      margin-bottom: 1rem;
    }

    footer ul {
      list-style: none;
    }

    footer ul li {
      margin-bottom: 0.6rem;
    }

    footer ul a {
      color: var(--muted2);
      text-decoration: none;
      font-size: 0.875rem;
      transition: color 0.2s;
    }

    footer ul a:hover {
      color: var(--text);
    }

    .footer-bottom {
      max-width: 1280px;
      margin: 0 auto;
      padding-top: 1.5rem;
      border-top: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.8rem;
      color: var(--muted);
      flex-wrap: wrap;
      gap: 1rem;
    }

    /* ‚îÄ‚îÄ SEARCH HIGHLIGHT ‚îÄ‚îÄ */
    .calc-card.hidden {
      display: none;
    }

    .no-results {
      grid-column: 1/-1;
      text-align: center;
      padding: 3rem;
      color: var(--muted);
    }

    .no-results p {
      font-size: 1rem;
      margin-top: 0.5rem;
    }

    /* ‚îÄ‚îÄ RESPONSIVE ‚îÄ‚îÄ */
    @media (max-width: 900px) {
      .main-wrap {
        grid-template-columns: 1fr;
      }

      .sidebar-col {
        display: none;
      }

      .nav-cats {
        display: none;
      }

      .footer-inner {
        grid-template-columns: 1fr 1fr;
      }
    }

    @media (max-width: 600px) {

      .field-row,
      .field-row-3 {
        grid-template-columns: 1fr;
      }

      .hero h1 {
        font-size: 2.5rem;
      }

      .hero-stats {
        gap: 1.5rem;
      }

      .footer-inner {
        grid-template-columns: 1fr;
      }
    }

    /* ‚îÄ‚îÄ ANIMATIONS ‚îÄ‚îÄ */
    @keyframes heartbeatPulse {

      0%,
      100% {
        transform: scale(1);
        opacity: 0.4;
      }

      15% {
        transform: scale(1.12);
        opacity: 0.8;
      }

      30% {
        transform: scale(1);
        opacity: 0.4;
      }

      45% {
        transform: scale(1.08);
        opacity: 0.6;
      }

      60% {
        transform: scale(1);
        opacity: 0.4;
      }
    }

    @keyframes fadeUp {
      from {
        opacity: 0;
        transform: translateY(16px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .calc-card {
      animation: fadeUp 0.4s ease both;
    }

    .calc-card:nth-child(1) {
      animation-delay: 0.05s;
    }

    .calc-card:nth-child(2) {
      animation-delay: 0.1s;
    }

    .calc-card:nth-child(3) {
      animation-delay: 0.15s;
    }

    .calc-card:nth-child(4) {
      animation-delay: 0.2s;
    }

    .calc-card:nth-child(5) {
      animation-delay: 0.25s;
    }

    .calc-card:nth-child(6) {
      animation-delay: 0.3s;
    }

    /* ‚îÄ‚îÄ LANGUAGE TOGGLE ‚îÄ‚îÄ */
    .lang-toggle {
      position: fixed;
      top: 50%;
      right: 0;
      transform: translateY(-50%);
      z-index: 9999;
      display: flex;
      flex-direction: column;
      border-radius: 12px 0 0 12px;
      overflow: hidden;
      box-shadow: -4px 0 24px rgba(0, 0, 0, 0.4);
    }

    .lang-toggle a {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 48px;
      height: 46px;
      text-decoration: none;
      font-size: 0.8rem;
      font-weight: 700;
      transition: all 0.2s;
      letter-spacing: 0.04em;
    }

    .lang-toggle a.lang-en {
      background: #6c63ff;
      color: white;
      border-bottom: 1px solid rgba(255, 255, 255, 0.15);
    }

    .lang-toggle a.lang-en:hover {
      background: #8b84ff;
    }

    .lang-toggle a.lang-ar {
      background: #1c1c27;
      color: #9090b8;
      font-family: 'Cairo', sans-serif;
    }

    .lang-toggle a.lang-ar:hover {
      background: #2a2a3d;
      color: #e8e8f0;
    }

    .lang-toggle a::after {
      content: attr(data-tooltip);
      position: absolute;
      right: 56px;
      background: #1c1c27;
      border: 1px solid #363650;
      color: #e8e8f0;
      font-size: 0.75rem;
      padding: 0.3rem 0.7rem;
      border-radius: 6px;
      white-space: nowrap;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s;
    }

    .lang-toggle a:hover::after {
      opacity: 1;
    }

    @media (max-width: 600px) {
      .lang-toggle {
        top: auto;
        bottom: 1.5rem;
        transform: none;
      }
    }

    /* ‚îÄ‚îÄ UX POLISH ‚îÄ‚îÄ */
    @keyframes shakeInput {

      0%,
      100% {
        transform: translateX(0);
      }

      15% {
        transform: translateX(-6px);
      }

      30% {
        transform: translateX(6px);
      }

      45% {
        transform: translateX(-4px);
      }

      60% {
        transform: translateX(4px);
      }

      75% {
        transform: translateX(-2px);
      }

      90% {
        transform: translateX(2px);
      }
    }

    .shake {
      animation: shakeInput 0.5s ease-in-out;
      border-color: var(--pink) !important;
    }

    #confetti-canvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 99999;
    }

    @keyframes skeletonPulse {
      0% {
        opacity: 0.4;
      }

      50% {
        opacity: 1;
      }

      100% {
        opacity: 0.4;
      }
    }

    .skeleton-line {
      height: 14px;
      background: rgba(108, 99, 255, 0.15);
      border-radius: 6px;
      animation: skeletonPulse 1.2s ease-in-out infinite;
      margin-bottom: 0.5rem;
    }

    .skeleton-line.w60 {
      width: 60%;
    }

    .skeleton-line.w80 {
      width: 80%;
    }

    .skeleton-line.w40 {
      width: 40%;
    }

    /* ‚îÄ‚îÄ PREMIUM FEATURES CSS ‚îÄ‚îÄ */

    /* Neumorphic Light Mode Redesign */
    [data-theme="light"] {
      --bg: #EBECF0;
      --surface: #EBECF0;
      --surface2: #EBECF0;
      --border: transparent;
      --border2: transparent;
      --text: #2D3748;
      --text-muted: #718096;
      --muted: #A0AEC0;
      --muted2: #CBD5E0;
      --accent: #6C63FF;
      --accent-hover: #5A52D5;
      
      --neu-light: #ffffff;
      --neu-dark: #babecc;
      --accent-shadow: 6px 6px 12px rgba(186, 190, 204, 0.4), -6px -6px 12px rgba(255, 255, 255, 0.9);
      --card-shadow: 8px 8px 16px rgba(186, 190, 204, 0.5), -8px -8px 16px rgba(255, 255, 255, 0.8);
      --card-hover-shadow: inset 4px 4px 8px rgba(186, 190, 204, 0.4), inset -4px -4px 8px rgba(255, 255, 255, 0.8);
      --neu-inset: inset 5px 5px 10px rgba(186, 190, 204, 0.45), inset -5px -5px 10px rgba(255, 255, 255, 0.8);
      --neu-pressed: inset 7px 7px 14px rgba(186, 190, 204, 0.6), inset -7px -7px 14px rgba(255, 255, 255, 0.9);
      
      --success: #10B981;
      --warning: #F59E0B;
      --error: #EF4444;
      --info: #3B82F6;

      /* Neutralize dark-mode leaky variables */
      --accent2: #6C63FF;
      --accent3: #8B84FF;
      --blue: #3B82F6;
      --pink: #EC4899;
      --green: #10B981;
      --glow: none;
      --card-glow: none;
    }

    html[data-theme="light"] body {
      background: var(--bg) !important;
      color: var(--text-muted);
      line-height: 1.6;
      font-weight: 400;
    }

    html[data-theme="light"] body::before,
    html[data-theme="light"] .hero-glow,
    html[data-theme="light"] .about-hero::before, 
    html[data-theme="light"] .page-hero::before,
    html[data-theme="light"] .hero::after,
    html[data-theme="light"] .calc-card::before {
      display: none !important;
      background: none !important;
    }

    html[data-theme="light"] .section-title,
    html[data-theme="light"] h1, html[data-theme="light"] h2, html[data-theme="light"] h3, html[data-theme="light"] h4, html[data-theme="light"] .logo {
      color: var(--text) !important;
      letter-spacing: -0.01em;
      font-weight: 600;
      text-shadow: 2px 2px 5px rgba(186, 190, 204, 0.4), -2px -2px 5px rgba(255, 255, 255, 0.8) !important;
    }

    html[data-theme="light"] .logo .logo-dot {
      color: var(--accent) !important;
    }

    html[data-theme="light"] nav, html[data-theme="light"] header, html[data-theme="light"] footer, html[data-theme="light"] .stats-strip, html[data-theme="light"] .navbar {
      background: var(--surface) !important;
      backdrop-filter: none !important;
      -webkit-backdrop-filter: none !important;
      border: none !important;
      box-shadow: 0 4px 10px rgba(186, 190, 204, 0.3) !important;
    }

    html[data-theme="light"] .nav-search {
      background: var(--surface) !important;
      border: none !important;
      box-shadow: var(--neu-inset) !important;
    }

    html[data-theme="light"] .nav-search input:focus {
      box-shadow: none !important;
    }

    html[data-theme="light"] .nav-cats button {
      color: var(--muted) !important;
    }

    html[data-theme="light"] .nav-cats button:hover {
      background: var(--surface) !important;
      box-shadow: var(--card-shadow) !important;
      color: var(--accent) !important;
      border-color: transparent !important;
    }

    html[data-theme="light"] .nav-cats button.active {
      background: var(--surface) !important;
      border-color: transparent !important;
      color: var(--accent) !important;
      box-shadow: var(--neu-pressed) !important;
    }

    html[data-theme="light"] .calc-card, html[data-theme="light"] .col-visual, html[data-theme="light"] .value-card, html[data-theme="light"] .cat-card, html[data-theme="light"] .team-card, html[data-theme="light"] .contact-item, html[data-theme="light"] .article-card, html[data-theme="light"] .highlight-box, html[data-theme="light"] .green-box, html[data-theme="light"] .toc, html[data-theme="light"] .contact-card {
      background: var(--surface) !important;
      border: none !important;
      box-shadow: var(--card-shadow) !important;
      border-radius: 20px;
    }

    html[data-theme="light"] .calc-card:hover, html[data-theme="light"] .cat-card:hover, html[data-theme="light"] .contact-item:hover, html[data-theme="light"] .article-card:hover {
      transform: translateY(-2px);
      box-shadow: var(--card-hover-shadow) !important;
      border-color: transparent !important;
    }

    html[data-theme="light"] .card-icon {
      background: var(--surface) !important;
      border: none !important;
      box-shadow: var(--card-shadow) !important;
    }

    html[data-theme="light"] .calc-card:hover .card-icon {
      box-shadow: var(--neu-pressed) !important;
    }

    html[data-theme="light"] .modal-content, html[data-theme="light"] .modal {
      background: var(--surface) !important;
      border: none !important;
      box-shadow: 12px 12px 24px rgba(186, 190, 204, 0.6), -12px -12px 24px rgba(255, 255, 255, 0.9) !important;
      backdrop-filter: none !important;
      border-radius: 24px !important;
    }

    html[data-theme="light"] .calc-btn, html[data-theme="light"] .nav-back, html[data-theme="light"] .nav-link, html[data-theme="light"] .article-card .tag {
      background: var(--surface) !important;
      color: var(--accent) !important;
      border: none !important;
      border-radius: 12px;
      box-shadow: var(--card-shadow) !important;
      font-weight: 700 !important;
    }

    html[data-theme="light"] .calc-btn:hover, html[data-theme="light"] .nav-back:hover, html[data-theme="light"] .nav-link:hover {
      box-shadow: var(--neu-pressed) !important;
      transform: translateY(0) !important;
      background: var(--surface) !important;
    }

    html[data-theme="light"] input, html[data-theme="light"] select {
      background: var(--surface) !important;
      border: none !important;
      color: var(--text) !important;
      box-shadow: var(--neu-inset) !important;
    }

    html[data-theme="light"] input:focus, html[data-theme="light"] select:focus {
      box-shadow: var(--neu-pressed) !important;
      border: none !important;
    }

    html[data-theme="light"] .results {
      background: var(--surface) !important;
      border: none !important;
      box-shadow: var(--neu-inset) !important;
      border-radius: 20px !important;
    }

    html[data-theme="light"] footer {
      background: var(--surface) !important;
      border-top: none !important;
      box-shadow: inset 0 10px 10px -10px rgba(186, 190, 204, 0.5) !important;
    }
    
    html[data-theme="light"] .data-table th, html[data-theme="light"] .data-table td {
      border-color: rgba(186, 190, 204, 0.3) !important;
    }

    html[data-theme="light"] .fav-chip {
      background: var(--surface) !important;
      border: none !important;
      box-shadow: var(--card-shadow) !important;
    }

    html[data-theme="light"] .fav-chip:hover {
      box-shadow: var(--neu-pressed) !important;
      transform: translateY(0) !important;
    }

    /* Theme toggle button */
    .theme-toggle {
      position: fixed;
      bottom: 1.5rem;
      left: 1.5rem;
      z-index: 9999;
      width: 44px;
      height: 44px;
      border-radius: 50%;
      border: 1px solid var(--border);
      background: var(--surface);
      color: var(--text);
      font-size: 1.2rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.2);
    }

    .theme-toggle:hover {
      transform: scale(1.1);
      border-color: var(--accent);
    }

    /* Copy results button */
    .copy-results-btn {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      padding: 0.4rem 0.9rem;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: var(--surface2);
      color: var(--muted2);
      font-size: 0.75rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      margin-top: 0.8rem;
    }

    .copy-results-btn:hover {
      border-color: var(--accent);
      color: var(--accent2);
    }

    .copy-results-btn.copied {
      border-color: var(--green) !important;
      color: var(--green) !important;
    }

    /* Favorites star on calc cards */
    .fav-star {
      position: absolute;
      bottom: 0.6rem;
      right: 0.6rem;
      background: none;
      border: none;
      font-size: 1.1rem;
      cursor: pointer;
      opacity: 0.3;
      transition: all 0.2s;
      z-index: 5;
      padding: 0.25rem;
    }

    .fav-star:hover {
      opacity: 0.7;
      transform: scale(1.2);
    }

    .fav-star.active {
      opacity: 1;
      transform: scale(1.1);
    }

    /* Favorites section */
    .fav-section {
      margin-bottom: 2rem;
      display: none;
    }

    .fav-section.has-favs {
      display: block;
    }

    .fav-section h3 {
      font-size: 1.1rem;
      color: var(--accent2);
      margin-bottom: 0.8rem;
      font-weight: 600;
    }

    .fav-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: 0.8rem;
    }

    .fav-chip {
      background: var(--surface);
      border: 1px solid rgba(108, 99, 255, 0.25);
      border-radius: 10px;
      padding: 0.6rem 0.8rem;
      cursor: pointer;
      font-size: 0.8rem;
      font-weight: 500;
      color: var(--text);
      transition: all 0.2s;
      text-align: center;
    }

    .fav-chip:hover {
      border-color: var(--accent);
      transform: translateY(-2px);
    }

    /* Chart canvas */
    .chart-container {
      margin-top: 1rem;
      background: rgba(108, 99, 255, 0.04);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 1rem;
    }

    .chart-container canvas {
      width: 100%;
      height: 200px;
    }

    /* Share button */
    .share-btn {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      padding: 0.4rem 0.9rem;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: var(--surface2);
      color: var(--muted2);
      font-size: 0.75rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      margin-top: 0.5rem;
      margin-left: 0.5rem;
    }

    .share-btn:hover {
      border-color: var(--pink);
      color: var(--pink);
    }

    .share-btn.shared {
      border-color: var(--green) !important;
      color: var(--green) !important;
    }
  </style>
</head>

<body>

  <!-- ‚ïê‚ïê‚ïê LANGUAGE TOGGLE ‚ïê‚ïê‚ïê -->
  <div class="lang-toggle">
    <a href="index.html" class="lang-en" data-tooltip="English (current)">EN</a>
    <a href="index-ar.html" class="lang-ar" data-tooltip="ÿßŸÑÿπÿ±ÿ®Ÿäÿ©" style="font-family:'Cairo',sans-serif;">ÿπ</a>
  </div>

  <!-- Theme Toggle -->
  <button class="theme-toggle" id="theme-toggle" onclick="toggleTheme()" title="Toggle light/dark mode">üåô</button>

  <nav>
    <div class="nav-inner">
      <a href="#" class="logo">Calc<span class="logo-dot">Wise</span></a>
      <div class="nav-search">
        <span style="color:var(--muted);font-size:0.8rem;">‚åï</span>
        <input type="text" id="global-search" placeholder="Search calculators‚Ä¶" oninput="searchCalcs(this.value)">
      </div>
      <ul class="nav-cats">
        <li><button onclick="scrollToSection('top')" class="active" id="nav-all">Start</button></li>
        <li><button onclick="scrollToSection('section-finance')" id="nav-finance">Finance</button></li>
        <li><button onclick="scrollToSection('section-health')" id="nav-health">Health</button></li>
        <li><button onclick="scrollToSection('section-math')" id="nav-math">Math</button></li>
        <li><button onclick="scrollToSection('section-everyday')" id="nav-everyday">Everyday</button></li>
        <li><a href="blog.html"
            style="color:var(--muted);font-size:0.82rem;font-weight:500;text-decoration:none;padding:0.4rem 0.8rem;border-radius:8px;background:rgba(108,99,255,0.1);transition:all 0.2s;">üìù
            Blog</a></li>
      </ul>
    </div>
  </nav>

  <!-- HERO -->
  <section class="hero">
    <div class="hero-glow"></div>
    <div class="hero-eyebrow"><span>‚ú¶</span> Free ¬∑ Instant ¬∑ Private <span>‚ú¶</span></div>
    <h1>Every Calculator<br>You'll Ever <em>Need</em></h1>
    <p>36+ free online calculators for finance, health, math, and everyday life. No ads blocking your results, no
      signup, no nonsense.</p>
    <div class="hero-stats">
      <div class="stat"><span class="stat-num">36+</span><span class="stat-label">Calculators</span></div>
      <div class="stat"><span class="stat-num">100%</span><span class="stat-label">Free Forever</span></div>
      <div class="stat"><span class="stat-num">0</span><span class="stat-label">Data Collected</span></div>
    </div>
  </section>

  <!-- TOP AD -->
  <div class="ad-wrap">
    <div class="ad-unit leaderboard">Advertisement ¬∑ 728√ó90 ‚Äî Replace with AdSense code</div>
  </div>

  <!-- MAIN CONTENT -->
  <div class="main-wrap">
    <div class="main-content">

      <!-- CATEGORY TABS -->
      <div class="cat-tabs">
        <button class="cat-tab active" onclick="filterCat('all')" id="tab-all">
          <span class="tab-icon">‚ö°</span> All Calculators
        </button>
        <button class="cat-tab" onclick="filterCat('finance')" id="tab-finance">
          <span class="tab-icon">üí∞</span> Finance
        </button>
        <button class="cat-tab" onclick="filterCat('health')" id="tab-health">
          <span class="tab-icon">‚ù§Ô∏è</span> Health & Fitness
        </button>
        <button class="cat-tab" onclick="filterCat('math')" id="tab-math">
          <span class="tab-icon">üìê</span> Math & Science
        </button>
        <button class="cat-tab" onclick="filterCat('everyday')" id="tab-everyday">
          <span class="tab-icon">üåü</span> Everyday
        </button>
      </div>

      <!-- FINANCE SECTION -->
      <div id="section-finance" class="calc-section">
        <div class="section-head">
          <h2>üí∞ Finance & Money</h2>
          <span class="section-badge">12 Calculators</span>
        </div>
        <div class="calc-grid" id="grid-finance">

          <div class="calc-card" style="--card-color:var(--green)" data-cat="finance" data-name="mortgage calculator"
            onclick="openCalc('mortgage')">
            <div class="card-icon">üè†</div>
            <h3>Mortgage Calculator</h3>
            <p>Monthly payments, total interest, and full amortization schedule.</p>
            <span class="card-tag" style="background:var(--green)">Popular</span>
          </div>

          <div class="calc-card" style="--card-color:var(--blue)" data-cat="finance"
            data-name="loan calculator personal loan" onclick="openCalc('loan')">
            <div class="card-icon">üí≥</div>
            <h3>Loan Calculator</h3>
            <p>Calculate monthly payments for any personal or auto loan.</p>
          </div>

          <div class="calc-card" style="--card-color:var(--yellow)" data-cat="finance"
            data-name="compound interest savings investment" onclick="openCalc('compound')">
            <div class="card-icon">üìà</div>
            <h3>Compound Interest</h3>
            <p>See how your savings or investments grow over time.</p>
            <span class="card-tag" style="background:var(--yellow);color:#000">Hot</span>
          </div>

          <div class="calc-card" style="--card-color:var(--orange)" data-cat="finance"
            data-name="credit card payoff debt" onclick="openCalc('creditcard')">
            <div class="card-icon">üí≥</div>
            <h3>Credit Card Payoff</h3>
            <p>Find out how long to pay off your balance and total interest paid.</p>
          </div>

          <div class="calc-card" style="--card-color:var(--accent)" data-cat="finance"
            data-name="salary hourly wage income" onclick="openCalc('salary')">
            <div class="card-icon">üíº</div>
            <h3>Salary Calculator</h3>
            <p>Convert hourly, weekly, monthly and annual salary figures.</p>
          </div>

          <div class="calc-card" style="--card-color:var(--pink)" data-cat="finance"
            data-name="tip calculator restaurant bill" onclick="openCalc('tip')">
            <div class="card-icon">üçΩÔ∏è</div>
            <h3>Tip Calculator</h3>
            <p>Split a restaurant bill and calculate tip per person instantly.</p>
          </div>

          <div class="calc-card" style="--card-color:var(--green)" data-cat="finance"
            data-name="ROI return on investment" onclick="openCalc('roi')">
            <div class="card-icon">üìä</div>
            <h3>ROI Calculator</h3>
            <p>Calculate return on investment and profit percentage.</p>
          </div>

          <div class="calc-card" style="--card-color:var(--blue)" data-cat="finance"
            data-name="percentage discount sale price" onclick="openCalc('percentage')">
            <div class="card-icon">%</div>
            <h3>Percentage Calculator</h3>
            <p>What is X% of Y? Percentage change, increase, decrease.</p>
          </div>

          <div class="calc-card" style="--card-color:var(--yellow)" data-cat="finance" data-name="tax income sales tax"
            onclick="openCalc('tax')">
            <div class="card-icon">üßæ</div>
            <h3>Sales Tax Calculator</h3>
            <p>Add or remove sales tax from any price instantly.</p>
          </div>

          <div class="calc-card" style="--card-color:var(--orange)" data-cat="finance"
            data-name="retirement savings 401k pension" onclick="openCalc('retirement')">
            <div class="card-icon">üèñÔ∏è</div>
            <h3>Retirement Savings</h3>
            <p>How much you need to save monthly to retire comfortably.</p>
          </div>

          <div class="calc-card" style="--card-color:var(--accent)" data-cat="finance"
            data-name="currency exchange rate converter" onclick="openCalc('currency')">
            <div class="card-icon">üí±</div>
            <h3>Currency Converter</h3>
            <p>Convert between major world currencies with live-style rates.</p>
          </div>

          <div class="calc-card" style="--card-color:var(--pink)" data-cat="finance"
            data-name="inflation purchasing power" onclick="openCalc('inflation')">
            <div class="card-icon">üìâ</div>
            <h3>Inflation Calculator</h3>
            <p>See how inflation erodes purchasing power over time.</p>
          </div>

        </div>
      </div>

      <!-- MID AD -->
      <div class="ad-unit leaderboard" style="margin:2rem 0">Advertisement ¬∑ 728√ó90 ‚Äî Replace with AdSense code</div>

      <!-- HEALTH SECTION -->
      <div id="section-health" class="calc-section">
        <div class="section-head">
          <h2>‚ù§Ô∏è Health & Fitness</h2>
          <span class="section-badge">10 Calculators</span>
        </div>
        <div class="calc-grid" id="grid-health">

          <div class="calc-card" style="--card-color:var(--pink)" data-cat="health"
            data-name="BMI body mass index weight" onclick="openCalc('bmi')">
            <div class="card-icon">‚öñÔ∏è</div>
            <h3>BMI Calculator</h3>
            <p>Body mass index with healthy weight range and category.</p>
            <span class="card-tag" style="background:var(--pink)">Popular</span>
          </div>

          <div class="calc-card" style="--card-color:var(--orange)" data-cat="health"
            data-name="calorie intake TDEE diet weight loss" onclick="openCalc('calories')">
            <div class="card-icon">üî•</div>
            <h3>Calorie Calculator</h3>
            <p>Daily calorie needs based on your goal: lose, maintain, or gain.</p>
            <span class="card-tag" style="background:var(--orange)">Hot</span>
          </div>

          <div class="calc-card" style="--card-color:var(--green)" data-cat="health"
            data-name="protein macros macronutrients diet" onclick="openCalc('macros')">
            <div class="card-icon">ü•©</div>
            <h3>Macro Calculator</h3>
            <p>Protein, carb and fat targets for your fitness goal.</p>
          </div>

          <div class="calc-card" style="--card-color:var(--blue)" data-cat="health"
            data-name="body fat percentage lean mass" onclick="openCalc('bodyfat')">
            <div class="card-icon">üí™</div>
            <h3>Body Fat Calculator</h3>
            <p>Estimate body fat percentage using measurements.</p>
          </div>

          <div class="calc-card" style="--card-color:var(--yellow)" data-cat="health"
            data-name="running pace pace per mile km" onclick="openCalc('pace')">
            <div class="card-icon">üèÉ</div>
            <h3>Running Pace Calculator</h3>
            <p>Calculate pace, finish time, or distance for any run.</p>
          </div>

          <div class="calc-card" style="--card-color:var(--accent)" data-cat="health"
            data-name="water intake hydration drink" onclick="openCalc('water')">
            <div class="card-icon">üíß</div>
            <h3>Water Intake Calculator</h3>
            <p>Daily hydration needs based on weight and activity level.</p>
          </div>

          <div class="calc-card" style="--card-color:var(--pink)" data-cat="health" data-name="sleep hours age bedtime"
            onclick="openCalc('sleep')">
            <div class="card-icon">üò¥</div>
            <h3>Sleep Calculator</h3>
            <p>Find the best bedtime based on sleep cycles and wake time.</p>
          </div>

          <div class="calc-card" style="--card-color:var(--green)" data-cat="health"
            data-name="pregnancy due date weeks" onclick="openCalc('pregnancy')">
            <div class="card-icon">ü§∞</div>
            <h3>Pregnancy Due Date</h3>
            <p>Calculate expected due date from last menstrual period.</p>
          </div>

          <div class="calc-card" style="--card-color:var(--orange)" data-cat="health"
            data-name="heart rate max target zone cardio" onclick="openCalc('heartrate')">
            <div class="card-icon">‚ù§Ô∏è</div>
            <h3>Heart Rate Zones</h3>
            <p>Target heart rate zones for fat burn and cardio training.</p>
          </div>

          <div class="calc-card" style="--card-color:var(--blue)" data-cat="health"
            data-name="ideal weight healthy body frame" onclick="openCalc('idealweight')">
            <div class="card-icon">üéØ</div>
            <h3>Ideal Weight Calculator</h3>
            <p>Estimate healthy weight range for your height and frame.</p>
          </div>

        </div>
      </div>

      <!-- MID AD 2 -->
      <div class="ad-unit leaderboard" style="margin:2rem 0">Advertisement ¬∑ 728√ó90 ‚Äî Replace with AdSense code</div>

      <!-- MATH SECTION -->
      <div id="section-math" class="calc-section">
        <div class="section-head">
          <h2>üìê Math & Science</h2>
          <span class="section-badge">8 Calculators</span>
        </div>
        <div class="calc-grid" id="grid-math">

          <div class="calc-card" style="--card-color:var(--accent)" data-cat="math"
            data-name="scientific calculator math" onclick="openCalc('scientific')">
            <div class="card-icon">üî¢</div>
            <h3>Scientific Calculator</h3>
            <p>Full scientific calculator with trig, log, and exponent functions.</p>
          </div>

          <div class="calc-card" style="--card-color:var(--blue)" data-cat="math"
            data-name="unit converter length weight volume temperature" onclick="openCalc('units')">
            <div class="card-icon">üìè</div>
            <h3>Unit Converter</h3>
            <p>Length, weight, volume, temperature, speed and more.</p>
            <span class="card-tag">Popular</span>
          </div>

          <div class="calc-card" style="--card-color:var(--green)" data-cat="math"
            data-name="GPA grade point average college" onclick="openCalc('gpa')">
            <div class="card-icon">üéì</div>
            <h3>GPA Calculator</h3>
            <p>Calculate cumulative GPA from course grades and credits.</p>
          </div>

          <div class="calc-card" style="--card-color:var(--yellow)" data-cat="math"
            data-name="quadratic equation formula roots" onclick="openCalc('quadratic')">
            <div class="card-icon">üìä</div>
            <h3>Quadratic Equation</h3>
            <p>Solve ax¬≤ + bx + c = 0 and find roots instantly.</p>
          </div>

          <div class="calc-card" style="--card-color:var(--orange)" data-cat="math"
            data-name="probability statistics combination permutation" onclick="openCalc('probability')">
            <div class="card-icon">üé≤</div>
            <h3>Probability Calculator</h3>
            <p>Combinations, permutations and event probabilities.</p>
          </div>

          <div class="calc-card" style="--card-color:var(--pink)" data-cat="math" data-name="area volume geometry shape"
            onclick="openCalc('geometry')">
            <div class="card-icon">üìê</div>
            <h3>Geometry Calculator</h3>
            <p>Area, perimeter, and volume for circles, rectangles, triangles.</p>
          </div>

          <div class="calc-card" style="--card-color:var(--accent)" data-cat="math"
            data-name="speed distance time travel" onclick="openCalc('speed')">
            <div class="card-icon">‚ö°</div>
            <h3>Speed Distance Time</h3>
            <p>Solve for speed, distance, or time given the other two values.</p>
          </div>

          <div class="calc-card" style="--card-color:var(--blue)" data-cat="math"
            data-name="number base binary hex decimal convert" onclick="openCalc('base')">
            <div class="card-icon">üíª</div>
            <h3>Number Base Converter</h3>
            <p>Convert between binary, octal, decimal, and hexadecimal.</p>
          </div>

        </div>
      </div>

      <!-- EVERYDAY SECTION -->
      <div id="section-everyday" class="calc-section">
        <div class="section-head" style="margin-top:2rem;">
          <h2>üåü Everyday Life</h2>
          <span class="section-badge">6 Calculators</span>
        </div>
        <div class="calc-grid" id="grid-everyday">

          <div class="calc-card" style="--card-color:var(--yellow)" data-cat="everyday"
            data-name="age birthday date born" onclick="openCalc('age')">
            <div class="card-icon">üéÇ</div>
            <h3>Age Calculator</h3>
            <p>Calculate exact age in years, months, and days from birthdate.</p>
          </div>

          <div class="calc-card" style="--card-color:var(--green)" data-cat="everyday"
            data-name="date difference days between dates" onclick="openCalc('datediff')">
            <div class="card-icon">üìÖ</div>
            <h3>Date Difference</h3>
            <p>Number of days, weeks, and months between two dates.</p>
          </div>

          <div class="calc-card" style="--card-color:var(--pink)" data-cat="everyday"
            data-name="time zone converter world clock" onclick="openCalc('timezone')">
            <div class="card-icon">üåç</div>
            <h3>Time Zone Converter</h3>
            <p>Convert time between major world time zones instantly.</p>
          </div>

          <div class="calc-card" style="--card-color:var(--orange)" data-cat="everyday"
            data-name="fuel gas mileage mpg cost trip" onclick="openCalc('fuel')">
            <div class="card-icon">‚õΩ</div>
            <h3>Fuel Cost Calculator</h3>
            <p>Estimate trip fuel cost based on distance, mpg and gas price.</p>
          </div>

          <div class="calc-card" style="--card-color:var(--blue)" data-cat="everyday"
            data-name="cooking measurement recipe scale" onclick="openCalc('cooking')">
            <div class="card-icon">üë®‚Äçüç≥</div>
            <h3>Cooking Converter</h3>
            <p>Convert cups, tablespoons, teaspoons, ml, and ounces.</p>
          </div>

          <div class="calc-card" style="--card-color:var(--accent)" data-cat="everyday"
            data-name="random number generator dice" onclick="openCalc('random')">
            <div class="card-icon">üé≤</div>
            <h3>Random Number Generator</h3>
            <p>Generate random numbers within any range you specify.</p>
          </div>

        </div>
      </div>

      <!-- NO RESULTS -->
      <div id="no-results" class="no-results" style="display:none;">
        <div style="font-size:3rem;margin-bottom:0.5rem;">üîç</div>
        <p>No calculators found for "<span id="no-results-term"></span>"</p>
      </div>

    </div>

    <!-- SIDEBAR -->
    <div class="sidebar-col">
      <div class="ad-unit sidebar">Ad ¬∑ 160√ó600</div>
    </div>
  </div>

  <!-- FOOTER -->
  <footer>
    <div class="footer-inner">
      <div class="footer-brand">
        <a href="#" class="logo">Calc<span class="logo-dot">Wise</span></a>
        <p>Free online calculators for finance, health, math, and everyday decisions. All calculations happen in your
          browser ‚Äî we never store your data.</p>
      </div>
      <div>
        <h4>Finance</h4>
        <ul>
          <li><a href="#" onclick="openCalc('mortgage')">Mortgage</a></li>
          <li><a href="#" onclick="openCalc('loan')">Loan Payment</a></li>
          <li><a href="#" onclick="openCalc('compound')">Compound Interest</a></li>
          <li><a href="#" onclick="openCalc('tip')">Tip Calculator</a></li>
          <li><a href="#" onclick="openCalc('percentage')">Percentage</a></li>
        </ul>
      </div>
      <div>
        <h4>Health</h4>
        <ul>
          <li><a href="#" onclick="openCalc('bmi')">BMI</a></li>
          <li><a href="#" onclick="openCalc('calories')">Calories</a></li>
          <li><a href="#" onclick="openCalc('macros')">Macros</a></li>
          <li><a href="#" onclick="openCalc('bodyfat')">Body Fat</a></li>
          <li><a href="#" onclick="openCalc('pace')">Running Pace</a></li>
        </ul>
      </div>
      <div>
        <h4>Company</h4>
        <ul>
          <li><a href="privacy.html">Privacy Policy</a></li>
          <li><a href="terms.html">Terms of Use</a></li>
          <li><a href="about.html">About</a></li>
          <li><a href="blog.html">Blog</a></li>
          <li><a href="#">Contact</a></li>
        </ul>
      </div>
    </div>
    <div class="footer-bottom">
      <span>¬© 2026 CalcWise. Free calculators for everyone.</span>
      <span>Results are for informational purposes only.</span>
    </div>
  </footer>

  <!-- MODAL -->
  <div class="modal-overlay" id="modal-overlay" onclick="closeModalOutside(event)">
    <div class="modal" id="modal">
      <div class="modal-header">
        <div class="modal-icon" id="modal-icon">üî¢</div>
        <div>
          <h2 id="modal-title">Calculator</h2>
          <p id="modal-desc">Calculate your result instantly.</p>
        </div>
        <button class="modal-close" onclick="closeModal()">‚úï</button>
      </div>
      <div class="modal-body" id="modal-body">
        <!-- injected per calculator -->
      </div>
    </div>
  </div>

  <script>
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  SEARCH & FILTER
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function searchCalcs(q) {
      q = q.toLowerCase().trim();
      const cards = document.querySelectorAll('.calc-card');
      const sections = document.querySelectorAll('.calc-section');
      let anyVisible = false;
      cards.forEach(c => {
        const name = c.dataset.name || '';
        const title = c.querySelector('h3').textContent.toLowerCase();
        const match = !q || name.includes(q) || title.includes(q);
        c.classList.toggle('hidden', !match);
        if (match) anyVisible = true;
      });
      sections.forEach(s => {
        const visible = s.querySelectorAll('.calc-card:not(.hidden)').length > 0;
        s.style.display = (q && !visible) ? 'none' : '';
      });
      const noR = document.getElementById('no-results');
      noR.style.display = (q && !anyVisible) ? 'block' : 'none';
      if (!anyVisible && q) document.getElementById('no-results-term').textContent = q;
    }

    function scrollToSection(id) {
      if (id === 'top') {
        window.scrollTo({ top: 0, behavior: 'smooth' });
      } else {
        const el = document.getElementById(id);
        if (el) {
          const offset = 70; // sticky nav height
          const top = el.getBoundingClientRect().top + window.pageYOffset - offset;
          window.scrollTo({ top, behavior: 'smooth' });
        }
      }
    }

    function filterCat(cat) {
      // update tabs
      document.querySelectorAll('.cat-tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.nav-cats button').forEach(b => b.classList.remove('active'));
      const tab = document.getElementById('tab-' + cat);
      const navBtn = document.getElementById('nav-' + cat);
      if (tab) tab.classList.add('active');
      if (navBtn) navBtn.classList.add('active');

      const cards = document.querySelectorAll('.calc-card');
      const sections = document.querySelectorAll('.calc-section');
      cards.forEach(c => c.classList.toggle('hidden', cat !== 'all' && c.dataset.cat !== cat));
      sections.forEach(s => {
        if (cat === 'all') { s.style.display = ''; return; }
        const id = s.id.replace('section-', '');
        s.style.display = id === cat ? '' : 'none';
      });
      // clear search
      document.getElementById('global-search').value = '';
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  MODAL
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    const calculators = {
      mortgage: {
        icon: 'üè†', title: 'Mortgage Calculator',
        desc: 'Estimate monthly payments, total interest paid, and loan cost.',
        html: `
      <div class="field-row">
        <div class="field-group"><label>Home Price</label><div class="input-wrap has-prefix"><span class="input-prefix">$</span><input type="number" id="m-price" value="350000" min="0"></div></div>
        <div class="field-group"><label>Down Payment</label><div class="input-wrap has-prefix"><span class="input-prefix">$</span><input type="number" id="m-down" value="70000" min="0"></div></div>
      </div>
      <div class="field-row">
        <div class="field-group"><label>Interest Rate</label><div class="input-wrap has-suffix"><input type="number" id="m-rate" value="6.8" step="0.1" min="0"><span class="input-suffix">%</span></div></div>
        <div class="field-group"><label>Loan Term</label><select id="m-term"><option value="30">30 Years</option><option value="20">20 Years</option><option value="15">15 Years</option><option value="10">10 Years</option></select></div>
      </div>
      <button class="calc-btn" onclick="calcMortgage()">Calculate Payment</button>
      <div class="results" id="r-mortgage">
        <h3>Results</h3>
        <div class="result-highlight"><span class="result-value" id="r-m-monthly">$0</span><div class="result-label">Monthly Payment</div></div>
        <div class="result-grid">
          <div class="result-item"><span class="result-value" id="r-m-total">$0</span><div class="result-label">Total Payment</div></div>
          <div class="result-item"><span class="result-value" id="r-m-interest">$0</span><div class="result-label">Total Interest</div></div>
          <div class="result-item"><span class="result-value" id="r-m-loan">$0</span><div class="result-label">Loan Amount</div></div>
        </div>
        <div class="result-bar" id="r-m-bar"></div>
        <p class="result-note">This estimate covers principal and interest only. Add property tax (~1.2%), homeowners insurance (~$150/mo), and PMI if down payment is less than 20%.</p>
      </div>
      <div class="modal-ad">Advertisement ¬∑ 728√ó90</div>`
      },

      loan: {
        icon: 'üí≥', title: 'Loan Calculator',
        desc: 'Monthly payments and total cost for any personal or auto loan.',
        html: `
      <div class="field-row">
        <div class="field-group"><label>Loan Amount</label><div class="input-wrap has-prefix"><span class="input-prefix">$</span><input type="number" id="l-amount" value="15000" min="0"></div></div>
        <div class="field-group"><label>Annual Interest Rate</label><div class="input-wrap has-suffix"><input type="number" id="l-rate" value="8.5" step="0.1" min="0"><span class="input-suffix">%</span></div></div>
      </div>
      <div class="field-group"><label>Loan Term</label>
        <select id="l-term">
          <option value="12">1 Year</option><option value="24">2 Years</option>
          <option value="36">3 Years</option><option value="48">4 Years</option>
          <option value="60" selected>5 Years</option><option value="72">6 Years</option>
          <option value="84">7 Years</option>
        </select>
      </div>
      <button class="calc-btn" onclick="calcLoan()">Calculate</button>
      <div class="results" id="r-loan">
        <h3>Results</h3>
        <div class="result-highlight"><span class="result-value" id="r-l-monthly">$0</span><div class="result-label">Monthly Payment</div></div>
        <div class="result-grid">
          <div class="result-item"><span class="result-value" id="r-l-total">$0</span><div class="result-label">Total Repaid</div></div>
          <div class="result-item"><span class="result-value" id="r-l-interest">$0</span><div class="result-label">Total Interest</div></div>
        </div>
      </div>
      <div class="modal-ad">Advertisement ¬∑ 728√ó90</div>`
      },

      compound: {
        icon: 'üìà', title: 'Compound Interest Calculator',
        desc: 'Watch your savings grow with the power of compounding.',
        html: `
      <div class="field-row">
        <div class="field-group"><label>Principal Amount</label><div class="input-wrap has-prefix"><span class="input-prefix">$</span><input type="number" id="ci-principal" value="10000" min="0"></div></div>
        <div class="field-group"><label>Annual Interest Rate</label><div class="input-wrap has-suffix"><input type="number" id="ci-rate" value="7" step="0.1" min="0"><span class="input-suffix">%</span></div></div>
      </div>
      <div class="field-row">
        <div class="field-group"><label>Time Period (Years)</label><input type="number" id="ci-years" value="10" min="1"></div>
        <div class="field-group"><label>Compound Frequency</label>
          <select id="ci-freq">
            <option value="1">Annually</option><option value="4">Quarterly</option>
            <option value="12" selected>Monthly</option><option value="365">Daily</option>
          </select>
        </div>
      </div>
      <div class="field-group"><label>Monthly Contribution</label><div class="input-wrap has-prefix"><span class="input-prefix">$</span><input type="number" id="ci-contrib" value="200" min="0"></div></div>
      <button class="calc-btn" onclick="calcCompound()">Calculate Growth</button>
      <div class="results" id="r-compound">
        <h3>Results</h3>
        <div class="result-highlight"><span class="result-value" id="r-ci-final">$0</span><div class="result-label">Final Balance</div></div>
        <div class="result-grid">
          <div class="result-item"><span class="result-value" id="r-ci-contributed">$0</span><div class="result-label">Total Contributed</div></div>
          <div class="result-item"><span class="result-value" id="r-ci-earned">$0</span><div class="result-label">Interest Earned</div></div>
        </div>
      </div>
      <div class="modal-ad">Advertisement ¬∑ 728√ó90</div>`
      },

      tip: {
        icon: 'üçΩÔ∏è', title: 'Tip Calculator',
        desc: 'Split a bill and calculate tip per person.',
        html: `
      <div class="field-row">
        <div class="field-group"><label>Bill Amount</label><div class="input-wrap has-prefix"><span class="input-prefix">$</span><input type="number" id="t-bill" value="85.50" step="0.01" min="0"></div></div>
        <div class="field-group"><label>Tip Percentage</label><div class="input-wrap has-suffix"><input type="number" id="t-tip" value="18" min="0"><span class="input-suffix">%</span></div></div>
      </div>
      <div class="field-group"><label>Number of People</label><input type="number" id="t-people" value="4" min="1"></div>
      <div style="display:flex;gap:0.5rem;margin-bottom:1rem;flex-wrap:wrap;">
        <button onclick="document.getElementById('t-tip').value=10;calcTip()" style="flex:1;padding:0.5rem;background:var(--surface2);border:1px solid var(--border);border-radius:8px;color:var(--text);cursor:pointer;font-family:inherit;font-size:0.85rem;">10%</button>
        <button onclick="document.getElementById('t-tip').value=15;calcTip()" style="flex:1;padding:0.5rem;background:var(--surface2);border:1px solid var(--border);border-radius:8px;color:var(--text);cursor:pointer;font-family:inherit;font-size:0.85rem;">15%</button>
        <button onclick="document.getElementById('t-tip').value=18;calcTip()" style="flex:1;padding:0.5rem;background:var(--accent);border:none;border-radius:8px;color:white;cursor:pointer;font-family:inherit;font-size:0.85rem;font-weight:600;">18%</button>
        <button onclick="document.getElementById('t-tip').value=20;calcTip()" style="flex:1;padding:0.5rem;background:var(--surface2);border:1px solid var(--border);border-radius:8px;color:var(--text);cursor:pointer;font-family:inherit;font-size:0.85rem;">20%</button>
        <button onclick="document.getElementById('t-tip').value=25;calcTip()" style="flex:1;padding:0.5rem;background:var(--surface2);border:1px solid var(--border);border-radius:8px;color:var(--text);cursor:pointer;font-family:inherit;font-size:0.85rem;">25%</button>
      </div>
      <button class="calc-btn" onclick="calcTip()">Calculate</button>
      <div class="results" id="r-tip">
        <h3>Results</h3>
        <div class="result-grid">
          <div class="result-item"><span class="result-value" id="r-t-tip">$0</span><div class="result-label">Tip Amount</div></div>
          <div class="result-item"><span class="result-value" id="r-t-total">$0</span><div class="result-label">Total Bill</div></div>
          <div class="result-item"><span class="result-value" id="r-t-per">$0</span><div class="result-label">Per Person</div></div>
        </div>
      </div>
      <div class="modal-ad">Advertisement ¬∑ 728√ó90</div>`
      },

      bmi: {
        icon: '‚öñÔ∏è', title: 'BMI Calculator',
        desc: 'Body Mass Index with healthy weight range and category.',
        html: `
      <div class="field-group"><label>Unit System</label>
        <select id="bmi-unit" onchange="updateBmiFields()">
          <option value="imperial">Imperial (lbs, inches)</option>
          <option value="metric">Metric (kg, cm)</option>
        </select>
      </div>
      <div class="field-row" id="bmi-imperial-fields">
        <div class="field-group"><label>Weight</label><div class="input-wrap has-suffix"><input type="number" id="bmi-lbs" value="165" min="0"><span class="input-suffix">lbs</span></div></div>
        <div class="field-group"><label>Height</label><div class="input-wrap has-suffix"><input type="number" id="bmi-inches" value="68" min="0"><span class="input-suffix">in</span></div></div>
      </div>
      <div class="field-row" id="bmi-metric-fields" style="display:none">
        <div class="field-group"><label>Weight</label><div class="input-wrap has-suffix"><input type="number" id="bmi-kg" value="75" min="0"><span class="input-suffix">kg</span></div></div>
        <div class="field-group"><label>Height</label><div class="input-wrap has-suffix"><input type="number" id="bmi-cm" value="173" min="0"><span class="input-suffix">cm</span></div></div>
      </div>
      <button class="calc-btn" onclick="calcBMI()">Calculate BMI</button>
      <div class="results" id="r-bmi">
        <h3>Results</h3>
        <div class="result-highlight">
          <span class="result-value" id="r-bmi-val">0</span>
          <div class="result-label">BMI Score</div>
          <div id="r-bmi-cat" style="margin-top:0.5rem;font-weight:700;font-size:1.1rem;"></div>
        </div>
        <div class="result-grid">
          <div class="result-item"><span class="result-value" id="r-bmi-low">0</span><div class="result-label">Healthy Min (lbs)</div></div>
          <div class="result-item"><span class="result-value" id="r-bmi-high">0</span><div class="result-label">Healthy Max (lbs)</div></div>
        </div>
        <p class="result-note">BMI is a screening tool, not a diagnostic measure. Athletes and muscular individuals may have elevated BMI despite healthy body composition.</p>
      </div>
      <div class="modal-ad">Advertisement ¬∑ 728√ó90</div>`
      },

      calories: {
        icon: 'üî•', title: 'Calorie Calculator',
        desc: 'Daily calorie needs based on your body and goal.',
        html: `
      <div class="field-row">
        <div class="field-group"><label>Age</label><div class="input-wrap has-suffix"><input type="number" id="cal-age" value="30" min="1" max="120"><span class="input-suffix">yrs</span></div></div>
        <div class="field-group"><label>Sex</label><select id="cal-sex"><option value="male">Male</option><option value="female">Female</option></select></div>
      </div>
      <div class="field-row">
        <div class="field-group"><label>Weight</label><div class="input-wrap has-suffix"><input type="number" id="cal-weight" value="165" min="0"><span class="input-suffix">lbs</span></div></div>
        <div class="field-group"><label>Height</label><div class="input-wrap has-suffix"><input type="number" id="cal-height" value="68" min="0"><span class="input-suffix">in</span></div></div>
      </div>
      <div class="field-group"><label>Activity Level</label>
        <select id="cal-activity">
          <option value="1.2">Sedentary (little or no exercise)</option>
          <option value="1.375">Light (1‚Äì3 days/week)</option>
          <option value="1.55" selected>Moderate (3‚Äì5 days/week)</option>
          <option value="1.725">Active (6‚Äì7 days/week)</option>
          <option value="1.9">Very Active (physical job or 2√ó training)</option>
        </select>
      </div>
      <div class="field-group"><label>Goal</label>
        <select id="cal-goal">
          <option value="-500">Lose Weight (‚àí500 cal/day)</option>
          <option value="0" selected>Maintain Weight</option>
          <option value="500">Gain Weight (+500 cal/day)</option>
        </select>
      </div>
      <button class="calc-btn" onclick="calcCalories()">Calculate</button>
      <div class="results" id="r-calories">
        <h3>Results</h3>
        <div class="result-highlight"><span class="result-value" id="r-cal-target">0</span><div class="result-label">Daily Calorie Target</div></div>
        <div class="result-grid">
          <div class="result-item"><span class="result-value" id="r-cal-bmr">0</span><div class="result-label">BMR (base rate)</div></div>
          <div class="result-item"><span class="result-value" id="r-cal-tdee">0</span><div class="result-label">TDEE (maintenance)</div></div>
        </div>
      </div>
      <div class="modal-ad">Advertisement ¬∑ 728√ó90</div>`
      },

      macros: {
        icon: 'ü•©', title: 'Macro Calculator',
        desc: 'Protein, carb and fat targets for your fitness goal.',
        html: `
      <div class="field-row">
        <div class="field-group"><label>Daily Calories</label><input type="number" id="mac-cal" value="2200" min="0"></div>
        <div class="field-group"><label>Goal</label>
          <select id="mac-goal">
            <option value="cut">Cut (high protein)</option>
            <option value="maintain" selected>Maintain (balanced)</option>
            <option value="bulk">Bulk (higher carbs)</option>
          </select>
        </div>
      </div>
      <button class="calc-btn" onclick="calcMacros()">Calculate Macros</button>
      <div class="results" id="r-macros">
        <h3>Results</h3>
        <div class="result-grid">
          <div class="result-item"><span class="result-value" id="r-mac-protein" style="color:var(--pink)">0g</span><div class="result-label">Protein</div></div>
          <div class="result-item"><span class="result-value" id="r-mac-carbs" style="color:var(--yellow)">0g</span><div class="result-label">Carbohydrates</div></div>
          <div class="result-item"><span class="result-value" id="r-mac-fat" style="color:var(--orange)">0g</span><div class="result-label">Fats</div></div>
        </div>
        <div class="result-bar" id="r-mac-bar"></div>
      </div>
      <div class="modal-ad">Advertisement ¬∑ 728√ó90</div>`
      },

      bodyfat: {
        icon: 'üí™', title: 'Body Fat Calculator',
        desc: 'Estimate body fat percentage using the US Navy method.',
        html: `
      <div class="field-group"><label>Gender</label>
        <select id="bf-gender" onchange="document.getElementById('bf-hip-group').style.display = this.value === 'female' ? 'block' : 'none'">
          <option value="male" selected>Male</option>
          <option value="female">Female</option>
        </select>
      </div>
      <div class="field-row">
        <div class="field-group"><label>Weight</label><div class="input-wrap has-suffix"><input type="number" id="bf-weight" value="75"><span class="input-suffix">kg</span></div></div>
        <div class="field-group"><label>Height</label><div class="input-wrap has-suffix"><input type="number" id="bf-height" value="175"><span class="input-suffix">cm</span></div></div>
      </div>
      <div class="field-row">
        <div class="field-group"><label>Neck</label><div class="input-wrap has-suffix"><input type="number" id="bf-neck" value="38"><span class="input-suffix">cm</span></div></div>
        <div class="field-group"><label>Waist (at navel)</label><div class="input-wrap has-suffix"><input type="number" id="bf-waist" value="85"><span class="input-suffix">cm</span></div></div>
      </div>
      <div class="field-group" id="bf-hip-group" style="display:none;"><label>Hips (widest)</label><div class="input-wrap has-suffix"><input type="number" id="bf-hip" value="95"><span class="input-suffix">cm</span></div></div>
      <button class="calc-btn" onclick="calcBodyFat()">Calculate</button>
      <div class="results" id="r-bodyfat">
        <h3>Estimated Results</h3>
        <div class="result-highlight"><span class="result-value" id="r-bf-pct">‚Äî</span><div class="result-label">Body Fat Percentage</div></div>
        <div class="result-grid" style="margin-top:1rem;">
          <div class="result-item"><span class="result-value" id="r-bf-category">‚Äî</span><div class="result-label" style="color:var(--accent2)">Category</div></div>
          <div class="result-item"><span class="result-value" id="r-bf-fatmass">‚Äî</span><div class="result-label">Fat Mass</div></div>
          <div class="result-item"><span class="result-value" id="r-bf-leanmass">‚Äî</span><div class="result-label">Lean Body Mass</div></div>
        </div>
      </div>
      <div class="modal-ad">Advertisement ¬∑ 728√ó90</div>`
      },

      salary: {
        icon: 'üíº', title: 'Salary Calculator',
        desc: 'Convert between hourly, daily, weekly, monthly, and annual salary.',
        html: `
      <div class="field-group"><label>Enter Your Salary</label><div class="input-wrap has-prefix"><span class="input-prefix">$</span><input type="number" id="sal-amount" value="75000" min="0"></div></div>
      <div class="field-row">
        <div class="field-group"><label>Pay Period</label>
          <select id="sal-period">
            <option value="hour">Per Hour</option>
            <option value="day">Per Day</option>
            <option value="week">Per Week</option>
            <option value="month">Per Month</option>
            <option value="year" selected>Per Year</option>
          </select>
        </div>
        <div class="field-group"><label>Hours per Week</label><input type="number" id="sal-hours" value="40" min="1"></div>
      </div>
      <button class="calc-btn" onclick="calcSalary()">Convert</button>
      <div class="results" id="r-salary">
        <h3>All Pay Periods</h3>
        <div class="result-grid">
          <div class="result-item"><span class="result-value" id="r-sal-hour">$0</span><div class="result-label">Per Hour</div></div>
          <div class="result-item"><span class="result-value" id="r-sal-day">$0</span><div class="result-label">Per Day</div></div>
          <div class="result-item"><span class="result-value" id="r-sal-week">$0</span><div class="result-label">Per Week</div></div>
          <div class="result-item"><span class="result-value" id="r-sal-month">$0</span><div class="result-label">Per Month</div></div>
          <div class="result-item"><span class="result-value" id="r-sal-year">$0</span><div class="result-label">Per Year</div></div>
        </div>
      </div>
      <div class="modal-ad">Advertisement ¬∑ 728√ó90</div>`
      },

      percentage: {
        icon: '%', title: 'Percentage Calculator',
        desc: 'Three ways to calculate percentages instantly.',
        html: `
      <div style="margin-bottom:1.5rem;">
        <div style="font-size:0.8rem;color:var(--muted2);font-weight:600;text-transform:uppercase;letter-spacing:0.05em;margin-bottom:0.75rem;">What is X% of Y?</div>
        <div class="field-row">
          <div class="field-group"><input type="number" id="p1-x" value="15" placeholder="X%"> </div>
          <div class="field-group"><div class="input-wrap has-prefix"><span class="input-prefix">%</span><input type="number" id="p1-y" value="200" placeholder="of Y"></div></div>
        </div>
        <button onclick="calcPct1()" style="background:var(--surface2);border:1px solid var(--border);border-radius:8px;padding:0.5rem 1.25rem;color:var(--text);cursor:pointer;font-family:inherit;font-size:0.9rem;">= <span id="r-p1" style="color:var(--accent2);font-weight:700;">30</span></button>
      </div>
      <div style="margin-bottom:1.5rem;">
        <div style="font-size:0.8rem;color:var(--muted2);font-weight:600;text-transform:uppercase;letter-spacing:0.05em;margin-bottom:0.75rem;">X is what % of Y?</div>
        <div class="field-row">
          <div class="field-group"><input type="number" id="p2-x" value="30" placeholder="X"></div>
          <div class="field-group"><input type="number" id="p2-y" value="200" placeholder="Y"></div>
        </div>
        <button onclick="calcPct2()" style="background:var(--surface2);border:1px solid var(--border);border-radius:8px;padding:0.5rem 1.25rem;color:var(--text);cursor:pointer;font-family:inherit;font-size:0.9rem;">= <span id="r-p2" style="color:var(--accent2);font-weight:700;">15%</span></button>
      </div>
      <div>
        <div style="font-size:0.8rem;color:var(--muted2);font-weight:600;text-transform:uppercase;letter-spacing:0.05em;margin-bottom:0.75rem;">Percentage Change from X to Y</div>
        <div class="field-row">
          <div class="field-group"><input type="number" id="p3-x" value="80" placeholder="From"></div>
          <div class="field-group"><input type="number" id="p3-y" value="100" placeholder="To"></div>
        </div>
        <button onclick="calcPct3()" style="background:var(--surface2);border:1px solid var(--border);border-radius:8px;padding:0.5rem 1.25rem;color:var(--text);cursor:pointer;font-family:inherit;font-size:0.9rem;">= <span id="r-p3" style="color:var(--green);font-weight:700;">+25%</span></button>
      </div>
      <div class="modal-ad">Advertisement ¬∑ 728√ó90</div>`
      },

      age: {
        icon: 'üéÇ', title: 'Age Calculator',
        desc: 'Exact age in years, months, and days from your birthdate.',
        html: `
      <div class="field-row">
        <div class="field-group"><label>Date of Birth</label><input type="date" id="age-dob" style="width:100%;background:var(--surface2);border:1px solid var(--border);border-radius:8px;padding:0.7rem;font-family:inherit;font-size:0.95rem;color:var(--text);outline:none;"></div>
        <div class="field-group"><label>As of Date</label><input type="date" id="age-today" style="width:100%;background:var(--surface2);border:1px solid var(--border);border-radius:8px;padding:0.7rem;font-family:inherit;font-size:0.95rem;color:var(--text);outline:none;"></div>
      </div>
      <button class="calc-btn" onclick="calcAge()">Calculate Age</button>
      <div class="results" id="r-age">
        <h3>Results</h3>
        <div class="result-highlight"><span class="result-value" id="r-age-years">0</span><div class="result-label">Years Old</div></div>
        <div class="result-grid">
          <div class="result-item"><span class="result-value" id="r-age-months">0</span><div class="result-label">Total Months</div></div>
          <div class="result-item"><span class="result-value" id="r-age-days">0</span><div class="result-label">Total Days</div></div>
          <div class="result-item"><span class="result-value" id="r-age-next">0</span><div class="result-label">Days to Birthday</div></div>
        </div>
      </div>
      <div class="modal-ad">Advertisement ¬∑ 728√ó90</div>`
      },

      gpa: {
        icon: 'üéì', title: 'GPA Calculator',
        desc: 'Calculate your GPA from course grades and credit hours.',
        html: `
      <div id="gpa-courses">
        <div style="display:grid;grid-template-columns:1fr 100px 80px;gap:0.5rem;margin-bottom:0.5rem;">
          <div style="font-size:0.75rem;color:var(--muted);text-transform:uppercase;letter-spacing:0.05em;">Course</div>
          <div style="font-size:0.75rem;color:var(--muted);text-transform:uppercase;letter-spacing:0.05em;">Grade</div>
          <div style="font-size:0.75rem;color:var(--muted);text-transform:uppercase;letter-spacing:0.05em;">Credits</div>
        </div>
        <div id="gpa-rows"></div>
      </div>
      <button onclick="addGpaRow()" style="background:none;border:1px dashed var(--border2);border-radius:8px;padding:0.5rem 1rem;color:var(--muted2);cursor:pointer;font-family:inherit;font-size:0.85rem;width:100%;margin-bottom:1rem;">+ Add Course</button>
      <button class="calc-btn" onclick="calcGPA()">Calculate GPA</button>
      <div class="results" id="r-gpa">
        <h3>Results</h3>
        <div class="result-highlight"><span class="result-value" id="r-gpa-val">0.00</span><div class="result-label">GPA (4.0 Scale)</div></div>
        <div class="result-grid">
          <div class="result-item"><span class="result-value" id="r-gpa-credits">0</span><div class="result-label">Total Credits</div></div>
          <div class="result-item"><span class="result-value" id="r-gpa-letter">‚Äî</span><div class="result-label">Letter Grade</div></div>
        </div>
      </div>
      <div class="modal-ad">Advertisement ¬∑ 728√ó90</div>`
      },

      fuel: {
        icon: '‚õΩ', title: 'Fuel Cost Calculator',
        desc: 'How much will your road trip cost in gas?',
        html: `
      <div class="field-row">
        <div class="field-group"><label>Trip Distance</label><div class="input-wrap has-suffix"><input type="number" id="fuel-dist" value="300" min="0"><span class="input-suffix">mi</span></div></div>
        <div class="field-group"><label>Fuel Efficiency</label><div class="input-wrap has-suffix"><input type="number" id="fuel-mpg" value="32" min="0"><span class="input-suffix">mpg</span></div></div>
      </div>
      <div class="field-group"><label>Gas Price per Gallon</label><div class="input-wrap has-prefix"><span class="input-prefix">$</span><input type="number" id="fuel-price" value="3.89" step="0.01" min="0"></div></div>
      <button class="calc-btn" onclick="calcFuel()">Calculate Cost</button>
      <div class="results" id="r-fuel">
        <h3>Results</h3>
        <div class="result-highlight"><span class="result-value" id="r-fuel-cost">$0</span><div class="result-label">Total Fuel Cost</div></div>
        <div class="result-grid">
          <div class="result-item"><span class="result-value" id="r-fuel-gallons">0</span><div class="result-label">Gallons Needed</div></div>
          <div class="result-item"><span class="result-value" id="r-fuel-per100">$0</span><div class="result-label">Cost per 100 miles</div></div>
        </div>
      </div>
      <div class="modal-ad">Advertisement ¬∑ 728√ó90</div>`
      },

      roi: {
        icon: 'üìä', title: 'ROI Calculator',
        desc: 'Calculate return on investment and profit percentage.',
        html: `
      <div class="field-row">
        <div class="field-group"><label>Initial Investment</label><div class="input-wrap has-prefix"><span class="input-prefix">$</span><input type="number" id="roi-invest" value="10000" min="0"></div></div>
        <div class="field-group"><label>Final Value</label><div class="input-wrap has-prefix"><span class="input-prefix">$</span><input type="number" id="roi-final" value="13500" min="0"></div></div>
      </div>
      <div class="field-group"><label>Time Period (Years, optional)</label><input type="number" id="roi-years" value="3" min="0"></div>
      <button class="calc-btn" onclick="calcROI()">Calculate ROI</button>
      <div class="results" id="r-roi">
        <h3>Results</h3>
        <div class="result-highlight"><span class="result-value" id="r-roi-pct">0%</span><div class="result-label">Total ROI</div></div>
        <div class="result-grid">
          <div class="result-item"><span class="result-value" id="r-roi-profit">$0</span><div class="result-label">Net Profit</div></div>
          <div class="result-item"><span class="result-value" id="r-roi-annual">0%</span><div class="result-label">Annual ROI</div></div>
        </div>
      </div>
      <div class="modal-ad">Advertisement ¬∑ 728√ó90</div>`
      },

      quadratic: {
        icon: 'üìà', title: 'Quadratic Equation solver',
        desc: 'Find roots for equations in the form ax¬≤ + bx + c = 0.',
        html: `
      <div class="field-row">
        <div class="field-group"><label>a (x¬≤)</label><input type="number" id="quad-a" value="1"></div>
        <div class="field-group"><label>b (x)</label><input type="number" id="quad-b" value="-5"></div>
        <div class="field-group"><label>c (constant)</label><input type="number" id="quad-c" value="6"></div>
      </div>
      <button class="calc-btn" onclick="calcQuadratic()">Solve Equation</button>
      <div class="results" id="r-quadratic">
        <h3>Roots (x values)</h3>
        <div class="result-highlight"><span class="result-value" id="r-quad-roots" style="font-size:1.8rem">‚Äî</span><div class="result-label" id="r-quad-type">Nature of Roots</div></div>
        <div class="result-grid" style="margin-top:1rem;">
          <div class="result-item"><span class="result-value" id="r-quad-x1">‚Äî</span><div class="result-label">x‚ÇÅ</div></div>
          <div class="result-item"><span class="result-value" id="r-quad-x2">‚Äî</span><div class="result-label">x‚ÇÇ</div></div>
          <div class="result-item"><span class="result-value" id="r-quad-disc">‚Äî</span><div class="result-label">Discriminant (Œî)</div></div>
        </div>
      </div>
      <div class="modal-ad">Advertisement ¬∑ 728√ó90</div>`
      },

      probability: {
        icon: 'üé≤', title: 'Probability Calculator',
        desc: 'Calculate combinations, permutations, and event probabilities.',
        html: `
      <div class="field-group"><label>Calculation Type</label>
        <select id="prob-type" onchange="updateProbFields()">
          <option value="basic" selected>Basic Event Probability</option>
          <option value="comb">Combinations (nCr)</option>
          <option value="perm">Permutations (nPr)</option>
        </select>
      </div>
      
      <!-- Basic Event Fields -->
      <div id="prob-basic-fields">
        <div class="field-row">
          <div class="field-group"><label>Number of Favorable Outcomes</label><input type="number" id="prob-fav" value="1" min="0"></div>
          <div class="field-group"><label>Total Possible Outcomes</label><input type="number" id="prob-total" value="6" min="1"></div>
        </div>
      </div>
      
      <!-- Comb/Perm Fields -->
      <div id="prob-cp-fields" style="display:none;">
        <div class="field-row">
          <div class="field-group"><label>Total Items (n)</label><input type="number" id="prob-n" value="5" min="0"></div>
          <div class="field-group"><label>Items Chosen (r)</label><input type="number" id="prob-r" value="3" min="0"></div>
        </div>
      </div>

      <button class="calc-btn" onclick="calcProbability()">Calculate Probability</button>
      <div class="results" id="r-probability">
        <h3>Results</h3>
        <div class="result-highlight"><span class="result-value" id="r-prob-main">‚Äî</span><div class="result-label" id="r-prob-label">Probability</div></div>
        
        <div class="result-grid" id="r-prob-extras" style="margin-top:1rem; display:none;">
          <div class="result-item"><span class="result-value" id="r-prob-pct">‚Äî</span><div class="result-label">Percentage</div></div>
          <div class="result-item"><span class="result-value" id="r-prob-odds">‚Äî</span><div class="result-label">Odds (Chances)</div></div>
        </div>
      </div>
      <div class="modal-ad">Advertisement ¬∑ 728√ó90</div>`
      },

      geometry: {
        icon: 'üìê', title: 'Geometry Calculator',
        desc: 'Calculate area and perimeter for basic 2D shapes.',
        html: `
      <div class="field-group"><label>Shape</label>
        <select id="geo-shape" onchange="updateGeoFields()">
          <option value="circle" selected>Circle</option>
          <option value="rectangle">Rectangle</option>
          <option value="triangle">Triangle</option>
        </select>
      </div>
      
      <!-- Circle Fields -->
      <div id="geo-circle-fields">
        <div class="field-row">
          <div class="field-group"><label>Radius (r)</label><input type="number" id="geo-r" value="5" min="0"></div>
        </div>
      </div>

      <!-- Rectangle Fields -->
      <div id="geo-rect-fields" style="display:none;">
        <div class="field-row">
          <div class="field-group"><label>Length (l)</label><input type="number" id="geo-l" value="10" min="0"></div>
          <div class="field-group"><label>Width (w)</label><input type="number" id="geo-w" value="5" min="0"></div>
        </div>
      </div>
      
      <!-- Triangle Fields -->
      <div id="geo-tri-fields" style="display:none;">
        <div class="field-row">
          <div class="field-group"><label>Base (b)</label><input type="number" id="geo-b" value="6" min="0"></div>
          <div class="field-group"><label>Height (h)</label><input type="number" id="geo-h" value="4" min="0"></div>
        </div>
        <p class="result-note" style="margin-top:-0.5rem; margin-bottom:1rem;">Perimeter calculation assumes an isosceles triangle based on the provided height and base.</p>
      </div>

      <button class="calc-btn" onclick="calcGeometry()">Calculate</button>
      <div class="results" id="r-geometry">
        <h3>Geometric Results</h3>
        <div class="result-highlight"><span class="result-value" id="r-geo-area">‚Äî</span><div class="result-label">Area</div></div>
        <div class="result-grid" style="margin-top:1rem;">
          <div class="result-item"><span class="result-value" id="r-geo-perim">‚Äî</span><div class="result-label" id="r-geo-perim-lbl">Perimeter</div></div>
        </div>
      </div>
      <div class="modal-ad">Advertisement ¬∑ 728√ó90</div>`
      },

      base: {
        icon: 'üíª', title: 'Number Base Converter',
        desc: 'Convert numbers between binary, octal, decimal, and hexadecimal.',
        html: `
      <div class="field-row">
        <div class="field-group"><label>Value</label><input type="text" id="base-val" value="255" style="width:100%;background:var(--surface2);border:1px solid var(--border);border-radius:8px;padding:0.7rem;font-family:inherit;font-size:1rem;color:var(--text);outline:none;"></div>
        <div class="field-group"><label>From Base</label>
          <select id="base-from">
            <option value="10" selected>Decimal (Base 10)</option>
            <option value="2">Binary (Base 2)</option>
            <option value="8">Octal (Base 8)</option>
            <option value="16">Hexadecimal (Base 16)</option>
          </select>
        </div>
      </div>
      <button class="calc-btn" onclick="calcBase()">Convert</button>
      <div class="results" id="r-base">
        <h3>Converted Values</h3>
        <div class="result-grid" style="margin-top:1rem;">
          <div class="result-item"><span class="result-value" id="r-base-dec">‚Äî</span><div class="result-label">Decimal (10)</div></div>
          <div class="result-item"><span class="result-value" id="r-base-bin" style="word-break:break-all">‚Äî</span><div class="result-label">Binary (2)</div></div>
          <div class="result-item"><span class="result-value" id="r-base-oct">‚Äî</span><div class="result-label">Octal (8)</div></div>
          <div class="result-item"><span class="result-value" id="r-base-hex" style="text-transform:uppercase">‚Äî</span><div class="result-label">Hexadecimal (16)</div></div>
        </div>
      </div>
      <div class="modal-ad">Advertisement ¬∑ 728√ó90</div>`
      },

      speed: {
        icon: '‚ö°', title: 'Speed Distance Time',
        desc: 'Solve for speed, distance, or time given the other two values.',
        html: `
      <div class="field-group"><label>I want to calculate:</label>
        <select id="spd-solve" onchange="updateSpeedFields()">
          <option value="speed" selected>Speed</option>
          <option value="distance">Distance</option>
          <option value="time">Time</option>
        </select>
      </div>

      <div class="field-row" id="spd-inputs">
        <!-- These fields will be toggled dynamically -->
        <div class="field-group" id="spd-dist-field"><label>Distance</label>
          <div class="input-wrap has-suffix">
            <input type="number" id="spd-dist" value="100" min="0">
            <select id="spd-dist-unit" class="input-suffix standalone" style="width:70px; border:none; background:transparent;">
              <option value="km" selected>km</option>
              <option value="mi">mi</option>
              <option value="m">m</option>
            </select>
          </div>
        </div>
        
        <div class="field-group" id="spd-time-field"><label>Time</label>
          <div style="display:flex; gap:0.5rem;">
            <div class="input-wrap has-suffix" style="flex:1;"><input type="number" id="spd-h" value="1" min="0" placeholder="0"><span class="input-suffix">hr</span></div>
            <div class="input-wrap has-suffix" style="flex:1;"><input type="number" id="spd-m" value="30" min="0" max="59" placeholder="0"><span class="input-suffix">m</span></div>
          </div>
        </div>

        <div class="field-group" id="spd-speed-field" style="display:none;"><label>Speed</label>
          <div class="input-wrap has-suffix">
            <input type="number" id="spd-speed" value="60" min="0">
            <select id="spd-speed-unit" class="input-suffix standalone" style="width:85px; border:none; background:transparent;">
              <option value="kph" selected>km/h</option>
              <option value="mph">mph</option>
              <option value="mps">m/s</option>
            </select>
          </div>
        </div>
      </div>

      <button class="calc-btn" onclick="calcSpeed()">Calculate</button>
      <div class="results" id="r-speed">
        <h3>Result</h3>
        <div class="result-highlight"><span class="result-value" id="r-spd-val">‚Äî</span><div class="result-label" id="r-spd-lbl">Speed</div></div>
      </div>
      <div class="modal-ad">Advertisement ¬∑ 728√ó90</div>`
      },

      timezone: {
        icon: 'üåç', title: 'Time Zone Converter',
        desc: 'Convert time between major world cities instantly.',
        html: `
      <div class="field-row">
        <div class="field-group"><label>Time</label>
          <input type="time" id="tz-time" value="12:00">
        </div>
        <div class="field-group"><label>From Zone</label>
          <select id="tz-from">
            <option value="-8">Pacific Time (PT) UTC-8</option>
            <option value="-5">Eastern Time (ET) UTC-5</option>
            <option value="0" selected>London (GMT) UTC+0</option>
            <option value="1">Paris/Berlin (CET) UTC+1</option>
            <option value="3">Riyadh/Moscow (AST/MSK) UTC+3</option>
            <option value="4">Dubai (GST) UTC+4</option>
            <option value="5.5">India (IST) UTC+5:30</option>
            <option value="8">Beijing/Singapore (CST/SGT) UTC+8</option>
            <option value="9">Tokyo (JST) UTC+9</option>
            <option value="11">Sydney (AEDT) UTC+11</option>
          </select>
        </div>
      </div>
      
      <div class="field-group"><label>To Zone</label>
        <select id="tz-to">
          <option value="-8">Pacific Time (PT) UTC-8</option>
          <option value="-5" selected>Eastern Time (ET) UTC-5</option>
          <option value="0">London (GMT) UTC+0</option>
          <option value="1">Paris/Berlin (CET) UTC+1</option>
          <option value="3">Riyadh/Moscow (AST/MSK) UTC+3</option>
          <option value="4">Dubai (GST) UTC+4</option>
          <option value="5.5">India (IST) UTC+5:30</option>
          <option value="8">Beijing/Singapore (CST/SGT) UTC+8</option>
          <option value="9">Tokyo (JST) UTC+9</option>
          <option value="11">Sydney (AEDT) UTC+11</option>
        </select>
      </div>

      <button class="calc-btn" onclick="calcTimezone()">Convert Time</button>
      <div class="results" id="r-timezone">
        <h3>Converted Time</h3>
        <div class="result-highlight"><span class="result-value" id="r-tz-val">‚Äî</span><div class="result-label" id="r-tz-diff">Time Difference</div></div>
      </div>
      <div class="modal-ad">Advertisement ¬∑ 728√ó90</div>`
      },

      cooking: {
        icon: 'üç≥', title: 'Cooking Converter',
        desc: 'Quickly convert between cups, spoons, fluid ounces, and milliliters.',
        html: `
      <div class="field-row">
        <div class="field-group"><label>Amount</label>
          <input type="number" id="cook-val" value="1" min="0">
        </div>
        <div class="field-group"><label>From Unit</label>
          <select id="cook-from">
            <optgroup label="Volume (US)">
              <option value="cup" selected>Cups</option>
              <option value="tbsp">Tablespoons (tbsp)</option>
              <option value="tsp">Teaspoons (tsp)</option>
              <option value="floz">Fluid Ounces (fl oz)</option>
            </optgroup>
            <optgroup label="Volume (Metric)">
              <option value="ml">Milliliters (ml)</option>
              <option value="l">Liters (L)</option>
            </optgroup>
            <optgroup label="Weight">
              <option value="oz">Ounces (oz)</option>
              <option value="lb">Pounds (lb)</option>
              <option value="g">Grams (g)</option>
              <option value="kg">Kilograms (kg)</option>
            </optgroup>
          </select>
        </div>
      </div>

      <div class="field-group"><label>To Unit</label>
        <select id="cook-to">
          <optgroup label="Volume (US)">
            <option value="cup">Cups</option>
            <option value="tbsp" selected>Tablespoons (tbsp)</option>
            <option value="tsp">Teaspoons (tsp)</option>
            <option value="floz">Fluid Ounces (fl oz)</option>
          </optgroup>
          <optgroup label="Volume (Metric)">
            <option value="ml">Milliliters (ml)</option>
            <option value="l">Liters (L)</option>
          </optgroup>
          <optgroup label="Weight">
            <option value="oz">Ounces (oz)</option>
            <option value="lb">Pounds (lb)</option>
            <option value="g">Grams (g)</option>
            <option value="kg">Kilograms (kg)</option>
          </optgroup>
        </select>
      </div>

      <button class="calc-btn" onclick="calcCooking()">Convert Measurement</button>
      <div class="results" id="r-cooking">
        <h3>Converted Amount</h3>
        <div class="result-highlight"><span class="result-value" id="r-cook-val">‚Äî</span><div class="result-label" id="r-cook-lbl">Result</div></div>
        <p class="result-note" style="margin-top:1rem;font-size:0.85rem;">Note: Converting between volume (cups/ml) and weight (g/oz) depends on the ingredient's density. This calculator performs strict volume-to-volume or weight-to-weight conversions.</p>
      </div>
      <div class="modal-ad">Advertisement ¬∑ 728√ó90</div>`
      },

      scientific: {
        icon: 'üî¢', title: 'Scientific Calculator',
        desc: 'Full scientific calculator with trig and log functions.',
        html: `
      <div style="background:var(--surface2);border:1px solid var(--border);border-radius:10px;padding:1rem;margin-bottom:1rem;">
        <div id="sci-display" style="font-family:'Instrument Serif',serif;font-size:2rem;text-align:right;color:var(--accent2);min-height:2.5rem;letter-spacing:-0.02em;word-break:break-all;">0</div>
        <div id="sci-expr" style="font-size:0.8rem;color:var(--muted);text-align:right;min-height:1rem;margin-top:0.25rem;"></div>
      </div>
      <div style="display:grid;grid-template-columns:repeat(5,1fr);gap:0.4rem;">
        ${[['sin', 'cos', 'tan', 'log', 'ln'],
          ['(', ')', 'œÄ', 'e', '‚àö'],
          ['7', '8', '9', '√∑', 'x¬≤'],
          ['4', '5', '6', '√ó', '^'],
          ['1', '2', '3', '-', '1/x'],
          ['¬±', '0', '.', '+', ' '],
          ['C', 'CE', '‚å´', '=', '']].map(row =>
            row.map(k => k ? `<button onclick="sciKey('${k}')" style="padding:0.6rem 0;background:${['='].includes(k) ? 'var(--accent)' : ['C', 'CE', '‚å´'].includes(k) ? 'var(--surface)' : 'var(--surface2)'};border:1px solid var(--border);border-radius:8px;color:${['='].includes(k) ? 'white' : 'var(--text)'};cursor:pointer;font-family:inherit;font-size:${['sin', 'cos', 'tan', 'log', 'ln', '1/x'].includes(k) ? '0.75' : '0.9'}rem;font-weight:${['=', '+', '-', '√ó', '√∑'].includes(k) ? 600 : 400};transition:background 0.1s;" onmousedown="this.style.background='var(--border2)'" onmouseup="this.style.background='${['='].includes(k) ? 'var(--accent)' : 'var(--surface2)'}'">${k}</button>` : '<div></div>'
            ).join('')
          ).join('')}
      </div>
      <div class="modal-ad">Advertisement ¬∑ 728√ó90</div>`
      },

      units: {
        icon: 'üìè', title: 'Unit Converter',
        desc: 'Convert between units of length, weight, temperature, and more.',
        html: `
      <div class="field-group"><label>Category</label>
        <select id="unit-cat" onchange="updateUnitOptions()">
          <option value="length">Length</option>
          <option value="weight">Weight / Mass</option>
          <option value="temp">Temperature</option>
          <option value="volume">Volume</option>
          <option value="speed">Speed</option>
        </select>
      </div>
      <div class="field-row">
        <div class="field-group"><label>From</label><select id="unit-from"></select></div>
        <div class="field-group"><label>To</label><select id="unit-to"></select></div>
      </div>
      <div class="field-group"><label>Value</label><input type="number" id="unit-val" value="1" oninput="calcUnits()"></div>
      <div class="results show" id="r-units">
        <div class="result-highlight"><span class="result-value" id="r-unit-result">0</span><div class="result-label" id="r-unit-label">Result</div></div>
      </div>
      <div class="modal-ad">Advertisement ¬∑ 728√ó90</div>`
      },

      creditcard: {
        icon: 'üí≥', title: 'Credit Card Payoff Calculator',
        desc: 'See how long it takes to pay off your balance and total interest cost.',
        html: `
      <div class="field-row">
        <div class="field-group"><label>Current Balance</label><div class="input-wrap has-prefix"><span class="input-prefix">$</span><input type="number" id="cc-balance" value="5000" min="0"></div></div>
        <div class="field-group"><label>APR</label><div class="input-wrap has-suffix"><input type="number" id="cc-apr" value="21.5" step="0.1" min="0"><span class="input-suffix">%</span></div></div>
      </div>
      <div class="field-group"><label>Monthly Payment</label><div class="input-wrap has-prefix"><span class="input-prefix">$</span><input type="number" id="cc-payment" value="200" min="0"></div></div>
      <button class="calc-btn" onclick="calcCreditCard()">Calculate Payoff</button>
      <div class="results" id="r-cc">
        <h3>Results</h3>
        <div class="result-highlight"><span class="result-value" id="r-cc-months">0 months</span><div class="result-label">Time to Pay Off</div></div>
        <div class="result-grid">
          <div class="result-item"><span class="result-value" id="r-cc-interest">$0</span><div class="result-label">Total Interest Paid</div></div>
          <div class="result-item"><span class="result-value" id="r-cc-total">$0</span><div class="result-label">Total Paid</div></div>
        </div>
      </div>
      <div class="modal-ad">Advertisement ¬∑ 728√ó90</div>`
      },

      water: {
        icon: 'üíß', title: 'Water Intake Calculator',
        desc: 'How much water should you drink each day?',
        html: `
      <div class="field-row">
        <div class="field-group"><label>Weight</label><div class="input-wrap has-suffix"><input type="number" id="wat-weight" value="165" min="0"><span class="input-suffix">lbs</span></div></div>
        <div class="field-group"><label>Activity Level</label>
          <select id="wat-activity">
            <option value="1">Sedentary</option>
            <option value="1.2" selected>Moderate</option>
            <option value="1.4">Very Active</option>
          </select>
        </div>
      </div>
      <button class="calc-btn" onclick="calcWater()">Calculate</button>
      <div class="results" id="r-water">
        <h3>Daily Water Intake</h3>
        <div class="result-grid">
          <div class="result-item"><span class="result-value" id="r-wat-oz">0 oz</span><div class="result-label">Fluid Ounces</div></div>
          <div class="result-item"><span class="result-value" id="r-wat-cups">0</span><div class="result-label">Cups</div></div>
          <div class="result-item"><span class="result-value" id="r-wat-liters">0 L</span><div class="result-label">Liters</div></div>
        </div>
      </div>
      <div class="modal-ad">Advertisement ¬∑ 728√ó90</div>`
      },

      pregnancy: {
        icon: 'ü§∞', title: 'Pregnancy Due Date',
        desc: 'Calculate expected due date from last menstrual period.',
        html: `
      <div class="field-row">
        <div class="field-group"><label>First Day of Last Period</label><input type="date" id="preg-lmp" style="width:100%;background:var(--surface2);border:1px solid var(--border);border-radius:8px;padding:0.7rem;font-family:inherit;font-size:0.95rem;color:var(--text);outline:none;"></div>
        <div class="field-group"><label>Average Cycle Length</label><div class="input-wrap has-suffix"><input type="number" id="preg-cycle" value="28" min="20" max="45"><span class="input-suffix">days</span></div></div>
      </div>
      <button class="calc-btn" onclick="calcPregnancy()">Calculate Due Date</button>
      <div class="results" id="r-pregnancy">
        <h3>Estimated Due Date</h3>
        <div class="result-highlight"><span class="result-value" id="r-preg-edd">‚Äî</span><div class="result-label" id="r-preg-days-left">Remaining</div></div>
        <div class="result-grid" style="margin-top:1rem;">
          <div class="result-item"><span class="result-value" id="r-preg-week">‚Äî</span><div class="result-label">Current Progress</div></div>
          <div class="result-item"><span class="result-value" id="r-preg-trimester">‚Äî</span><div class="result-label">Trimester</div></div>
          <div class="result-item"><span class="result-value" id="r-preg-conception">‚Äî</span><div class="result-label">Est. Conception</div></div>
        </div>
        <!-- Fetus Visualization -->
        <div id="preg-fetus-viz" style="margin-top:1.5rem;background:linear-gradient(135deg, rgba(108,99,255,0.08), rgba(255,107,157,0.08));border:1px solid rgba(108,99,255,0.15);border-radius:16px;padding:1.5rem;text-align:center;display:none;">
          <div style="display:flex;align-items:center;justify-content:center;gap:1.5rem;flex-wrap:wrap;">
            <!-- Animated Fetus SVG -->
            <div id="preg-fetus-svg" style="position:relative;width:140px;height:140px;display:flex;align-items:center;justify-content:center;">
              <div id="preg-heartbeat-ring" style="position:absolute;width:100%;height:100%;border-radius:50%;border:2px solid rgba(255,107,157,0.3);animation:heartbeatPulse 1.2s ease-in-out infinite;"></div>
              <div id="preg-fetus-icon" style="font-size:4rem;z-index:1;transition:font-size 0.6s cubic-bezier(0.34,1.56,0.64,1);"></div>
            </div>
            <!-- Info Panel -->
            <div style="text-align:left;flex:1;min-width:180px;">
              <div style="font-size:0.72rem;text-transform:uppercase;letter-spacing:0.1em;color:var(--muted);font-weight:700;margin-bottom:0.3rem;">Size Comparison</div>
              <div id="preg-size-compare" style="font-size:1.3rem;font-weight:700;color:var(--accent2);margin-bottom:0.6rem;"></div>
              <div style="font-size:0.72rem;text-transform:uppercase;letter-spacing:0.1em;color:var(--muted);font-weight:700;margin-bottom:0.3rem;">Length & Weight</div>
              <div id="preg-size-detail" style="font-size:0.95rem;color:var(--text);margin-bottom:0.6rem;"></div>
              <div style="font-size:0.72rem;text-transform:uppercase;letter-spacing:0.1em;color:var(--muted);font-weight:700;margin-bottom:0.3rem;">Development</div>
              <div id="preg-dev-note" style="font-size:0.88rem;color:var(--muted2);line-height:1.4;"></div>
            </div>
          </div>
          <!-- Progress bar -->
          <div style="margin-top:1rem;">
            <div style="display:flex;justify-content:space-between;font-size:0.72rem;color:var(--muted);margin-bottom:0.3rem;"><span>Week 0</span><span id="preg-progress-week">Week 0</span><span>Week 40</span></div>
            <div style="width:100%;height:8px;background:var(--surface2);border-radius:99px;overflow:hidden;">
              <div id="preg-progress-bar" style="height:100%;width:0%;background:linear-gradient(90deg,var(--accent),var(--pink));border-radius:99px;transition:width 1s cubic-bezier(0.34,1.56,0.64,1);"></div>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-ad">Advertisement ¬∑ 728√ó90</div>`
      },

      heartrate: {
        icon: '‚ù§Ô∏è', title: 'Heart Rate Zones',
        desc: 'Target heart rate zones for fat burn and cardio training.',
        html: `
      <div class="field-row">
        <div class="field-group"><label>Age</label><div class="input-wrap has-suffix"><input type="number" id="hr-age" value="30" min="10" max="100"><span class="input-suffix">yrs</span></div></div>
        <div class="field-group"><label>Resting Heart Rate</label><div class="input-wrap has-suffix"><input type="number" id="hr-rest" value="60" min="30" max="120"><span class="input-suffix">bpm</span></div></div>
      </div>
      <button class="calc-btn" onclick="calcHeartRate()">Calculate Zones</button>
      <div class="results" id="r-heartrate">
        <h3>Training Zones (Karvonen Method)</h3>
        <div class="result-highlight"><span class="result-value" id="r-hr-max">‚Äî</span><div class="result-label">Maximum Heart Rate (BPM)</div></div>
        <div class="result-grid" style="margin-top:1rem;">
          <div class="result-item"><span class="result-value" id="r-hr-z1" style="color:var(--blue)">‚Äî</span><div class="result-label">Warm Up (50-60%)</div></div>
          <div class="result-item"><span class="result-value" id="r-hr-z2" style="color:var(--green)">‚Äî</span><div class="result-label">Fat Burn (60-70%)</div></div>
          <div class="result-item"><span class="result-value" id="r-hr-z3" style="color:var(--yellow)">‚Äî</span><div class="result-label">Aerobic (70-80%)</div></div>
          <div class="result-item"><span class="result-value" id="r-hr-z4" style="color:var(--orange)">‚Äî</span><div class="result-label">Anaerobic (80-90%)</div></div>
          <div class="result-item"><span class="result-value" id="r-hr-z5" style="color:var(--pink)">‚Äî</span><div class="result-label">Maximum (90-100%)</div></div>
        </div>
      </div>
      <div class="modal-ad">Advertisement ¬∑ 728√ó90</div>`
      },

      idealweight: {
        icon: 'üéØ', title: 'Ideal Weight Calculator',
        desc: 'Estimate healthy weight range for your height and frame.',
        html: `
      <div class="field-row">
        <div class="field-group"><label>Gender</label>
          <select id="iw-gender">
            <option value="male" selected>Male</option>
            <option value="female">Female</option>
          </select>
        </div>
        <div class="field-group"><label>Body Frame Size</label>
          <select id="iw-frame">
            <option value="small">Small (subtract 10%)</option>
            <option value="medium" selected>Medium (standard)</option>
            <option value="large">Large (add 10%)</option>
          </select>
        </div>
      </div>
      <div class="field-row">
        <div class="field-group"><label>Height (cm)</label><div class="input-wrap has-suffix"><input type="number" id="iw-height" value="175" min="100" max="250"><span class="input-suffix">cm</span></div></div>
      </div>
      <button class="calc-btn" onclick="calcIdealWeight()">Calculate Ideal Weight</button>
      <div class="results" id="r-idealweight">
        <h3>Healthy Weight Estimates</h3>
        <div class="result-highlight"><span class="result-value" id="r-iw-primary">‚Äî</span><div class="result-label">Recommended Range</div></div>
        <div class="result-grid" style="margin-top:1rem;">
          <div class="result-item"><span class="result-value" id="r-iw-robinson">‚Äî</span><div class="result-label">Robinson Formula</div></div>
          <div class="result-item"><span class="result-value" id="r-iw-miller">‚Äî</span><div class="result-label">Miller Formula</div></div>
          <div class="result-item"><span class="result-value" id="r-iw-devine">‚Äî</span><div class="result-label">Devine Formula</div></div>
        </div>
        <p class="result-note" style="margin-top:1rem;">These are estimates based on standard clinical formulas. Muscle mass is not accounted for.</p>
      </div>
      <div class="modal-ad">Advertisement ¬∑ 728√ó90</div>`
      },

      sleep: {
        icon: 'üåô', title: 'Sleep Cycle Calculator',
        desc: 'Find the best bedtime or wake time based on 90-minute sleep cycles.',
        html: `
      <div class="field-row">
        <div class="field-group"><label>I want to calculate:</label>
          <select id="slp-mode" onchange="document.getElementById('slp-time-label').textContent = this.value === 'wake' ? 'Time I need to wake up' : 'Time I want to go to bed'">
            <option value="wake" selected>When to go to bed</option>
            <option value="bed">When to wake up</option>
          </select>
        </div>
        <div class="field-group"><label id="slp-time-label">Time I need to wake up</label>
          <input type="time" id="slp-time" value="07:00" style="width:100%;background:var(--surface2);border:1px solid var(--border);border-radius:8px;padding:0.7rem;font-family:inherit;font-size:0.95rem;color:var(--text);outline:none;">
        </div>
      </div>
      <button class="calc-btn" onclick="calcSleep()">Calculate Optimal Times</button>
      <div class="results" id="r-sleep">
        <h3>Optimal Sleep Cycles</h3>
        <p class="result-note" style="margin-bottom:1rem;">It takes the average person 15 minutes to fall asleep. We've factored this into the times below. Aim for 5-6 cycles (7.5-9 hours).</p>
        <div class="result-grid" id="r-slp-cycles"></div>
      </div>
      <div class="modal-ad">Advertisement ¬∑ 728√ó90</div>`
      },

      datediff: {
        icon: 'üìÖ', title: 'Date Difference Calculator',
        desc: 'Number of days, weeks, and months between two dates.',
        html: `
      <div class="field-row">
        <div class="field-group"><label>Start Date</label><input type="date" id="dd-start" style="width:100%;background:var(--surface2);border:1px solid var(--border);border-radius:8px;padding:0.7rem;font-family:inherit;font-size:0.95rem;color:var(--text);outline:none;"></div>
        <div class="field-group"><label>End Date</label><input type="date" id="dd-end" style="width:100%;background:var(--surface2);border:1px solid var(--border);border-radius:8px;padding:0.7rem;font-family:inherit;font-size:0.95rem;color:var(--text);outline:none;"></div>
      </div>
      <button class="calc-btn" onclick="calcDateDiff()">Calculate Difference</button>
      <div class="results" id="r-datediff">
        <h3>Results</h3>
        <div class="result-grid">
          <div class="result-item"><span class="result-value" id="r-dd-days">0</span><div class="result-label">Days</div></div>
          <div class="result-item"><span class="result-value" id="r-dd-weeks">0</span><div class="result-label">Weeks</div></div>
          <div class="result-item"><span class="result-value" id="r-dd-months">0</span><div class="result-label">Months</div></div>
        </div>
      </div>
      <div class="modal-ad">Advertisement ¬∑ 728√ó90</div>`
      },

      pace: {
        icon: 'üèÉ', title: 'Running Pace Calculator',
        desc: 'Calculate pace, finish time, or distance for any run.',
        html: `
      <div class="field-group"><label>Solve For</label>
        <select id="pace-solve" onchange="updatePaceFields()">
          <option value="pace">Pace (given distance + time)</option>
          <option value="time">Finish Time (given distance + pace)</option>
          <option value="distance">Distance (given time + pace)</option>
        </select>
      </div>
      <div class="field-row" id="pace-dist-field">
        <div class="field-group"><label>Distance</label><div class="input-wrap has-suffix"><input type="number" id="pace-dist" value="5" min="0" step="0.1"><span class="input-suffix">km</span></div></div>
        <div class="field-group"><label>Unit</label><select id="pace-unit"><option value="km">Kilometers</option><option value="mi">Miles</option></select></div>
      </div>
      <div class="field-row" id="pace-time-field">
        <div class="field-group"><label>Hours</label><input type="number" id="pace-h" value="0" min="0"></div>
        <div class="field-group"><label>Minutes</label><input type="number" id="pace-m" value="28" min="0"></div>
        <div class="field-group"><label>Seconds</label><input type="number" id="pace-s" value="0" min="0"></div>
      </div>
      <div class="field-group" id="pace-pace-field" style="display:none">
        <label>Pace (min per km)</label>
        <div class="field-row">
          <input type="number" id="pace-min" value="5" min="0">
          <input type="number" id="pace-sec" value="30" min="0" max="59">
        </div>
      </div>
      <button class="calc-btn" onclick="calcPace()">Calculate</button>
      <div class="results" id="r-pace">
        <h3>Result</h3>
        <div class="result-highlight"><span class="result-value" id="r-pace-result">‚Äî</span><div class="result-label" id="r-pace-label">Pace</div></div>
      </div>
      <div class="modal-ad">Advertisement ¬∑ 728√ó90</div>`
      },

      random: {
        icon: 'üé≤', title: 'Random Number Generator',
        desc: 'Generate random numbers within any range.',
        html: `
      <div class="field-row">
        <div class="field-group"><label>Minimum</label><input type="number" id="rng-min" value="1"></div>
        <div class="field-group"><label>Maximum</label><input type="number" id="rng-max" value="100"></div>
      </div>
      <div class="field-group"><label>How Many Numbers?</label><input type="number" id="rng-count" value="1" min="1" max="50"></div>
      <button class="calc-btn" onclick="calcRandom()">üé≤ Generate</button>
      <div class="results" id="r-random">
        <h3>Results</h3>
        <div id="r-rng-numbers" style="font-family:'Instrument Serif',serif;font-size:2rem;color:var(--accent2);text-align:center;letter-spacing:0.1em;line-height:1.6;"></div>
      </div>
      <div class="modal-ad">Advertisement ¬∑ 728√ó90</div>`
      },

      tax: {
        icon: 'üßæ', title: 'Sales Tax Calculator',
        desc: 'Add or remove sales tax from any price.',
        html: `
      <div class="field-row">
        <div class="field-group"><label>Price</label><div class="input-wrap has-prefix"><span class="input-prefix">$</span><input type="number" id="stax-price" value="100" step="0.01" min="0"></div></div>
        <div class="field-group"><label>Tax Rate</label><div class="input-wrap has-suffix"><input type="number" id="stax-rate" value="8.5" step="0.1" min="0"><span class="input-suffix">%</span></div></div>
      </div>
      <div class="field-group"><label>Mode</label>
        <select id="stax-mode">
          <option value="add">Add tax to price</option>
          <option value="remove">Remove tax from price (reverse)</option>
        </select>
      </div>
      <button class="calc-btn" onclick="calcTax()">Calculate</button>
      <div class="results" id="r-tax">
        <h3>Results</h3>
        <div class="result-grid">
          <div class="result-item"><span class="result-value" id="r-tax-pre">$0</span><div class="result-label">Pre-Tax Price</div></div>
          <div class="result-item"><span class="result-value" id="r-tax-amount">$0</span><div class="result-label">Tax Amount</div></div>
          <div class="result-item"><span class="result-value" id="r-tax-total">$0</span><div class="result-label">Total Price</div></div>
        </div>
      </div>
      <div class="modal-ad">Advertisement ¬∑ 728√ó90</div>`
      },

      inflation: {
        icon: 'üõí', title: 'Inflation Calculator',
        desc: 'See how inflation erodes purchasing power over time.',
        html: `
      <div class="field-row">
        <div class="field-group"><label>Current Amount</label><div class="input-wrap has-prefix"><span class="input-prefix">$</span><input type="number" id="inf-amount" value="1000" min="0"></div></div>
        <div class="field-group"><label>Expected Inflation Rate</label><div class="input-wrap has-suffix"><input type="number" id="inf-rate" value="3.0" step="0.1"><span class="input-suffix">%</span></div></div>
      </div>
      <div class="field-group"><label>Years</label><div class="input-wrap has-suffix"><input type="number" id="inf-years" value="10" min="1" max="100"><span class="input-suffix">yrs</span></div></div>
      <button class="calc-btn" onclick="calcInflation()">Calculate</button>
      <div class="results" id="r-inflation">
        <h3>Purchasing Power Results</h3>
        <div class="result-highlight"><span class="result-value" id="r-inf-value">‚Äî</span><div class="result-label">Future Value Equivalent</div></div>
        <div class="result-grid" style="margin-top:1rem">
          <div class="result-item"><span class="result-value" id="r-inf-cumulative">‚Äî</span><div class="result-label">Cumulative Inflation</div></div>
          <div class="result-item"><span class="result-value" id="r-inf-lost">‚Äî</span><div class="result-label">Purchasing Power Lost</div></div>
        </div>
        <p class="result-note" style="margin-top:1rem">To buy what $<span id="r-inf-amount-note">1,000</span> buys today, you will need <strong id="r-inf-future-need" style="color:var(--accent2)">‚Äî</strong> in <span id="r-inf-future-year"></span>.</p>
      </div>
      <div class="modal-ad">Advertisement ¬∑ 728√ó90</div>`
      },

      retirement: {
        icon: 'üèñÔ∏è', title: 'Retirement Savings Calculator',
        desc: 'Find out how much you need to save monthly to retire comfortably.',
        html: `
      <div class="field-row">
        <div class="field-group"><label>Current Age</label><div class="input-wrap has-suffix"><input type="number" id="ret-age" value="30" min="18" max="80"><span class="input-suffix">yrs</span></div></div>
        <div class="field-group"><label>Retirement Age</label><div class="input-wrap has-suffix"><input type="number" id="ret-retire" value="65" min="40" max="90"><span class="input-suffix">yrs</span></div></div>
      </div>
      <div class="field-row">
        <div class="field-group"><label>Current Savings</label><div class="input-wrap has-prefix"><span class="input-prefix">$</span><input type="number" id="ret-current" value="10000" min="0"></div></div>
        <div class="field-group"><label>Monthly Contribution</label><div class="input-wrap has-prefix"><span class="input-prefix">$</span><input type="number" id="ret-contrib" value="500" min="0"></div></div>
      </div>
      <div class="field-row">
        <div class="field-group"><label>Annual Return Rate</label><div class="input-wrap has-suffix"><input type="number" id="ret-return" value="7" step="0.1" min="0" max="30"><span class="input-suffix">%</span></div></div>
        <div class="field-group"><label>Inflation Rate</label><div class="input-wrap has-suffix"><input type="number" id="ret-inflation" value="3" step="0.1" min="0" max="20"><span class="input-suffix">%</span></div></div>
      </div>
      <div class="field-group"><label>Desired Monthly Income in Retirement</label><div class="input-wrap has-prefix"><span class="input-prefix">$</span><input type="number" id="ret-goal" value="4000" min="0"></div></div>
      <button class="calc-btn" onclick="calcRetirement()">Calculate Retirement Plan</button>
      <div class="results" id="r-retirement">
        <h3>Results</h3>
        <div class="result-highlight"><span class="result-value" id="ret-r-nest">$0</span><div class="result-label">Projected Nest Egg at Retirement</div></div>
        <div class="result-grid">
          <div class="result-item"><span class="result-value" id="ret-r-needed">$0</span><div class="result-label">Nest Egg Needed</div></div>
          <div class="result-item"><span class="result-value" id="ret-r-income">$0</span><div class="result-label">Monthly Income (Inflation-Adj.)</div></div>
          <div class="result-item"><span class="result-value" id="ret-r-monthly">$0</span><div class="result-label">Recommended Monthly Savings</div></div>
          <div class="result-item"><span class="result-value" id="ret-r-years">0</span><div class="result-label">Years to Retirement</div></div>
        </div>
        <div id="ret-r-verdict" style="margin-top:1rem;padding:1rem;border-radius:10px;text-align:center;font-weight:600;font-size:0.95rem;"></div>
        <p class="result-note">Assumes a <strong>4% safe withdrawal rate</strong> in retirement. Returns are pre-tax approximations. Actual results depend on market performance, tax treatment, and inflation. Consult a financial advisor for personalized guidance.</p>
      </div>
      <div class="modal-ad">Advertisement ¬∑ 728√ó90</div>`
      },

      currency: {
        icon: 'üí±', title: 'Currency Converter',
        desc: 'Convert between 30+ currencies with live exchange rates.',
        html: `
      <style>
        .cur-swap-btn { background: rgba(108,99,255,0.15); border: 1px solid rgba(108,99,255,0.35); border-radius: 50%; width: 36px; height: 36px; cursor: pointer; color: var(--accent2); font-size: 1.1rem; display: flex; align-items: center; justify-content: center; transition: all 0.2s; flex-shrink: 0; }
        .cur-swap-btn:hover { background: rgba(108,99,255,0.3); transform: rotate(180deg); }
        .cur-row { display: flex; align-items: flex-end; gap: 0.75rem; }
        .cur-row .field-group { flex: 1; }
        .cur-rate-tag { font-size: 0.78rem; color: var(--muted); margin-top: 0.5rem; }
        .cur-rate-tag span { color: var(--accent2); font-weight: 600; }
        .cur-multi { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 0.6rem; margin-top: 0.75rem; }
        .cur-multi-item { background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.08); border-radius: 10px; padding: 0.6rem 0.75rem; }
        .cur-multi-item .cur-code { font-size: 0.72rem; color: var(--muted); font-weight: 700; letter-spacing: 0.04em; }
        .cur-multi-item .cur-val { font-size: 1rem; font-weight: 700; color: var(--text); margin-top: 0.1rem; }
        .cur-status { font-size: 0.75rem; margin-bottom: 0.75rem; }
        .cur-status.live { color: var(--green); } .cur-status.cached { color: var(--yellow); } .cur-status.offline { color: var(--muted); }
      </style>
      <div class="cur-status" id="cur-status">‚è≥ Loading live rates‚Ä¶</div>
      <div class="cur-row">
        <div class="field-group">
          <label>Amount</label>
          <input type="number" id="cur-amount" value="100" min="0" step="any">
        </div>
        <div class="field-group">
          <label>From</label>
          <select id="cur-from"></select>
        </div>
        <button class="cur-swap-btn" onclick="swapCurrency()" title="Swap">‚áÑ</button>
        <div class="field-group">
          <label>To</label>
          <select id="cur-to"></select>
        </div>
      </div>
      <p class="cur-rate-tag" id="cur-rate-tag">1 USD = <span id="cur-rate-display">‚Äî</span></p>
      <button class="calc-btn" onclick="convertCurrency()" style="margin-top:0.75rem">Convert</button>
      <div class="results" id="r-currency">
        <h3>Results</h3>
        <div class="result-highlight"><span class="result-value" id="cur-r-main">‚Äî</span><div class="result-label" id="cur-r-label">Result</div></div>
        <p style="font-size:0.82rem;color:var(--muted);margin-top:0.5rem;margin-bottom:0.75rem">Also converts to popular currencies:</p>
        <div class="cur-multi" id="cur-multi-grid"></div>
        <p class="result-note">Rates provided by <strong>Frankfurter (ECB data)</strong> and updated daily on business days. Not suitable for financial transactions.</p>
      </div>
      <div class="modal-ad">Advertisement ¬∑ 728√ó90</div>`
      }
    };

    // ‚îÄ‚îÄ OPEN/CLOSE MODAL ‚îÄ‚îÄ
    function openCalc(id) {
      const c = calculators[id];
      if (!c) {
        alert(`The ${id} calculator is coming soon!`);
        return;
      }
      document.getElementById('modal-icon').textContent = c.icon;
      document.getElementById('modal-title').textContent = c.title;
      document.getElementById('modal-desc').textContent = c.desc;
      document.getElementById('modal-body').innerHTML = c.html;
      document.getElementById('modal-overlay').classList.add('open');
      document.body.style.overflow = 'hidden';

      // Post-inject setup
      if (id === 'age') {
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('age-today').value = today;
        const dob = new Date(); dob.setFullYear(dob.getFullYear() - 30);
        document.getElementById('age-dob').value = dob.toISOString().split('T')[0];
      }
      if (id === 'datediff') {
        const t = new Date();
        document.getElementById('dd-end').value = t.toISOString().split('T')[0];
        t.setMonth(t.getMonth() - 3);
        document.getElementById('dd-start').value = t.toISOString().split('T')[0];
      }
      if (id === 'gpa') { initGPA(); }
      if (id === 'units') { updateUnitOptions(); }
      if (id === 'scientific') { sciExpr = ''; sciDisplay('0'); }
      if (id === 'currency') { curPopulate(); loadCurrencyRates(); }
    }


    function closeModal() {
      document.getElementById('modal-overlay').classList.remove('open');
      document.body.style.overflow = '';
    }
    function closeModalOutside(e) { if (e.target === document.getElementById('modal-overlay')) closeModal(); }
    document.addEventListener('keydown', e => { if (e.key === 'Escape') closeModal(); });

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  CALCULATOR LOGIC
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    const fmt = (n, d = 0) => n.toLocaleString('en-US', { minimumFractionDigits: d, maximumFractionDigits: d });
    const fmtM = n => '$' + fmt(n, 0);
    const fmtD = n => '$' + fmt(Math.abs(n), 0);

    // MORTGAGE
    function calcMortgage() {
      const price = parseFloat(document.getElementById('m-price').value) || 0;
      const down = parseFloat(document.getElementById('m-down').value) || 0;
      const rate = parseFloat(document.getElementById('m-rate').value) || 0;
      const term = parseInt(document.getElementById('m-term').value);
      const loan = price - down;
      const r = rate / 100 / 12, n = term * 12;
      const monthly = r === 0 ? loan / n : loan * r * Math.pow(1 + r, n) / (Math.pow(1 + r, n) - 1);
      const total = monthly * n;
      const interest = total - loan;
      document.getElementById('r-m-monthly').textContent = fmtM(monthly);
      document.getElementById('r-m-total').textContent = fmtM(total);
      document.getElementById('r-m-interest').textContent = fmtM(interest);
      document.getElementById('r-m-loan').textContent = fmtM(loan);
      const pct = interest / total * 100;
      document.getElementById('r-m-bar').innerHTML = `
    <div class="bar-row"><span class="bar-label">Principal</span><div class="bar-track"><div class="bar-fill" style="width:${100 - pct}%;background:var(--accent)"></div></div><span class="bar-val">${fmtM(loan)}</span></div>
    <div class="bar-row"><span class="bar-label">Total Interest</span><div class="bar-track"><div class="bar-fill" style="width:${pct}%;background:var(--orange)"></div></div><span class="bar-val">${fmtM(interest)}</span></div>`;
      document.getElementById('r-mortgage').classList.add('show');
    }

    // LOAN
    function calcLoan() {
      const amt = parseFloat(document.getElementById('l-amount').value) || 0;
      const rate = parseFloat(document.getElementById('l-rate').value) || 0;
      const n = parseInt(document.getElementById('l-term').value);
      const r = rate / 100 / 12;
      const monthly = r === 0 ? amt / n : amt * r * Math.pow(1 + r, n) / (Math.pow(1 + r, n) - 1);
      const total = monthly * n;
      document.getElementById('r-l-monthly').textContent = fmtM(monthly);
      document.getElementById('r-l-total').textContent = fmtM(total);
      document.getElementById('r-l-interest').textContent = fmtM(total - amt);
      document.getElementById('r-loan').classList.add('show');
    }

    // COMPOUND INTEREST
    function calcCompound() {
      const p = parseFloat(document.getElementById('ci-principal').value) || 0;
      const r = parseFloat(document.getElementById('ci-rate').value) / 100;
      const t = parseFloat(document.getElementById('ci-years').value) || 0;
      const n = parseInt(document.getElementById('ci-freq').value);
      const contrib = parseFloat(document.getElementById('ci-contrib').value) || 0;
      const fv = p * Math.pow(1 + r / n, n * t);
      const fvContrib = contrib * ((Math.pow(1 + r / n, n * t) - 1) / (r / n));
      const total = fv + fvContrib;
      const contributed = p + contrib * 12 * t;
      document.getElementById('r-ci-final').textContent = fmtM(total);
      document.getElementById('r-ci-contributed').textContent = fmtM(contributed);
      document.getElementById('r-ci-earned').textContent = fmtM(total - contributed);
      document.getElementById('r-compound').classList.add('show');
    }

    // TIP
    function calcTip() {
      const bill = parseFloat(document.getElementById('t-bill').value) || 0;
      const tipPct = parseFloat(document.getElementById('t-tip').value) || 0;
      const people = parseInt(document.getElementById('t-people').value) || 1;
      const tip = bill * tipPct / 100;
      const total = bill + tip;
      document.getElementById('r-t-tip').textContent = fmtM(tip);
      document.getElementById('r-t-total').textContent = fmtM(total);
      document.getElementById('r-t-per').textContent = fmtM(total / people);
      document.getElementById('r-tip').classList.add('show');
    }

    // BMI
    function updateBmiFields() {
      const u = document.getElementById('bmi-unit').value;
      document.getElementById('bmi-imperial-fields').style.display = u === 'imperial' ? '' : 'none';
      document.getElementById('bmi-metric-fields').style.display = u === 'metric' ? '' : 'none';
    }
    function calcBMI() {
      const u = document.getElementById('bmi-unit').value;
      let bmi, heightIn;
      if (u === 'imperial') {
        const lbs = parseFloat(document.getElementById('bmi-lbs').value) || 0;
        heightIn = parseFloat(document.getElementById('bmi-inches').value) || 1;
        bmi = (lbs / (heightIn * heightIn)) * 703;
        const lowLbs = 18.5 * heightIn * heightIn / 703;
        const highLbs = 24.9 * heightIn * heightIn / 703;
        document.getElementById('r-bmi-low').textContent = fmt(lowLbs, 0);
        document.getElementById('r-bmi-high').textContent = fmt(highLbs, 0);
      } else {
        const kg = parseFloat(document.getElementById('bmi-kg').value) || 0;
        const cm = parseFloat(document.getElementById('bmi-cm').value) || 1;
        const hm = cm / 100;
        bmi = kg / (hm * hm);
        const lowKg = 18.5 * hm * hm, highKg = 24.9 * hm * hm;
        document.getElementById('r-bmi-low').textContent = fmt(lowKg, 1) + ' kg';
        document.getElementById('r-bmi-high').textContent = fmt(highKg, 1) + ' kg';
      }
      document.getElementById('r-bmi-val').textContent = fmt(bmi, 1);
      const cats = [[18.5, 'Underweight', 'var(--blue)'], [25, 'Normal weight', 'var(--green)'], [30, 'Overweight', 'var(--yellow)'], [Infinity, 'Obese', 'var(--pink)']];
      const cat = cats.find(c => bmi < c[0]);
      const catEl = document.getElementById('r-bmi-cat');
      catEl.textContent = cat[1]; catEl.style.color = cat[2];
      document.getElementById('r-bmi').classList.add('show');
    }

    // CALORIES
    function calcCalories() {
      const age = parseFloat(document.getElementById('cal-age').value) || 0;
      const sex = document.getElementById('cal-sex').value;
      const wt = parseFloat(document.getElementById('cal-weight').value) || 0;
      const ht = parseFloat(document.getElementById('cal-height').value) || 0;
      const act = parseFloat(document.getElementById('cal-activity').value);
      const goal = parseInt(document.getElementById('cal-goal').value);
      const kg = wt * 0.453592, cm = ht * 2.54;
      const bmr = sex === 'male' ? 10 * kg + 6.25 * cm - 5 * age + 5 : 10 * kg + 6.25 * cm - 5 * age - 161;
      const tdee = bmr * act;
      const target = tdee + goal;
      document.getElementById('r-cal-bmr').textContent = fmt(bmr, 0) + ' cal';
      document.getElementById('r-cal-tdee').textContent = fmt(tdee, 0) + ' cal';
      document.getElementById('r-cal-target').textContent = fmt(target, 0);
      document.getElementById('r-calories').classList.add('show');
    }

    // MACROS
    function calcMacros() {
      const cals = parseFloat(document.getElementById('mac-cal').value) || 2000;
      const goal = document.getElementById('mac-goal').value;
      const splits = { cut: [0.4, 0.35, 0.25], maintain: [0.3, 0.4, 0.3], bulk: [0.25, 0.5, 0.25] };
      const [p, c, f] = splits[goal];
      const protein = cals * p / 4, carbs = cals * c / 4, fat = cals * f / 9;
      document.getElementById('r-mac-protein').textContent = fmt(protein, 0) + 'g';
      document.getElementById('r-mac-carbs').textContent = fmt(carbs, 0) + 'g';
      document.getElementById('r-mac-fat').textContent = fmt(fat, 0) + 'g';
      document.getElementById('r-mac-bar').innerHTML = `
    <div class="bar-row"><span class="bar-label">Protein</span><div class="bar-track"><div class="bar-fill" style="width:${p * 100}%;background:var(--pink)"></div></div><span class="bar-val">${(p * 100).toFixed(0)}%</span></div>
    <div class="bar-row"><span class="bar-label">Carbs</span><div class="bar-track"><div class="bar-fill" style="width:${c * 100}%;background:var(--yellow)"></div></div><span class="bar-val">${(c * 100).toFixed(0)}%</span></div>
    <div class="bar-row"><span class="bar-label">Fats</span><div class="bar-track"><div class="bar-fill" style="width:${f * 100}%;background:var(--orange)"></div></div><span class="bar-val">${(f * 100).toFixed(0)}%</span></div>`;
      document.getElementById('r-macros').classList.add('show');
    }

    // BODY FAT
    function calcBodyFat() {
      const g = document.getElementById('bf-gender').value;
      const w = parseFloat(document.getElementById('bf-weight').value) || 0;
      const h = parseFloat(document.getElementById('bf-height').value) || 0;
      const n = parseFloat(document.getElementById('bf-neck').value) || 0;
      const wa = parseFloat(document.getElementById('bf-waist').value) || 0;
      const hip = parseFloat(document.getElementById('bf-hip').value) || 0;
      if (!w || !h || !n || !wa || (g === 'female' && !hip)) return;

      let bf = 0;
      if (g === 'male') {
        const val = wa - n;
        if (val > 0) bf = 495 / (1.0324 - 0.19077 * Math.log10(val) + 0.15456 * Math.log10(h)) - 450;
      } else {
        const val = wa + hip - n;
        if (val > 0) bf = 495 / (1.29579 - 0.35004 * Math.log10(val) + 0.22100 * Math.log10(h)) - 450;
      }

      if (isNaN(bf) || bf < 1 || bf > 80) bf = 0; // fallback

      const fm = w * (bf / 100);
      const lm = w - fm;

      let cat = '‚Äî';
      if (bf > 0) {
        if (g === 'male') {
          if (bf < 6) cat = 'Essential Fat';
          else if (bf < 14) cat = 'Athletes';
          else if (bf < 18) cat = 'Fitness';
          else if (bf < 25) cat = 'Average';
          else cat = 'Obese';
        } else {
          if (bf < 14) cat = 'Essential Fat';
          else if (bf < 21) cat = 'Athletes';
          else if (bf < 25) cat = 'Fitness';
          else if (bf < 32) cat = 'Average';
          else cat = 'Obese';
        }
      }

      document.getElementById('r-bf-pct').textContent = bf > 0 ? fmt(bf, 1) + '%' : 'Invalid metrics';
      document.getElementById('r-bf-category').textContent = cat;
      document.getElementById('r-bf-fatmass').textContent = bf > 0 ? fmt(fm, 1) + ' kg' : '‚Äî';
      document.getElementById('r-bf-leanmass').textContent = bf > 0 ? fmt(lm, 1) + ' kg' : '‚Äî';

      document.getElementById('r-bodyfat').classList.add('show');
    }

    // SALARY
    function calcSalary() {
      const amt = parseFloat(document.getElementById('sal-amount').value) || 0;
      const period = document.getElementById('sal-period').value;
      const hrs = parseFloat(document.getElementById('sal-hours').value) || 40;
      let annual;
      if (period === 'hour') annual = amt * hrs * 52;
      else if (period === 'day') annual = amt * 5 * 52;
      else if (period === 'week') annual = amt * 52;
      else if (period === 'month') annual = amt * 12;
      else annual = amt;
      document.getElementById('r-sal-hour').textContent = fmtM(annual / 52 / hrs);
      document.getElementById('r-sal-day').textContent = fmtM(annual / 260);
      document.getElementById('r-sal-week').textContent = fmtM(annual / 52);
      document.getElementById('r-sal-month').textContent = fmtM(annual / 12);
      document.getElementById('r-sal-year').textContent = fmtM(annual);
      document.getElementById('r-salary').classList.add('show');
    }

    // PERCENTAGE
    function calcPct1() { const r = (parseFloat(document.getElementById('p1-x').value) || 0) / 100 * (parseFloat(document.getElementById('p1-y').value) || 0); document.getElementById('r-p1').textContent = fmt(r, 2); }
    function calcPct2() { const x = parseFloat(document.getElementById('p2-x').value) || 0, y = parseFloat(document.getElementById('p2-y').value) || 1; document.getElementById('r-p2').textContent = fmt(x / y * 100, 2) + '%'; }
    function calcPct3() { const x = parseFloat(document.getElementById('p3-x').value) || 0, y = parseFloat(document.getElementById('p3-y').value) || 0; const pct = (y - x) / Math.abs(x || 1) * 100; const el = document.getElementById('r-p3'); el.textContent = (pct >= 0 ? '+' : '') + fmt(pct, 2) + '%'; el.style.color = pct >= 0 ? 'var(--green)' : 'var(--pink)'; }

    // AGE
    function calcAge() {
      const dob = new Date(document.getElementById('age-dob').value);
      const ref = new Date(document.getElementById('age-today').value);
      let years = ref.getFullYear() - dob.getFullYear();
      let months = ref.getMonth() - dob.getMonth();
      if (months < 0 || (months === 0 && ref.getDate() < dob.getDate())) { years--; months += 12; }
      const days = Math.floor((ref - dob) / 86400000);
      const next = new Date(ref.getFullYear(), dob.getMonth(), dob.getDate());
      if (next <= ref) next.setFullYear(next.getFullYear() + 1);
      const daysToB = Math.floor((next - ref) / 86400000);
      document.getElementById('r-age-years').textContent = years;
      document.getElementById('r-age-months').textContent = fmt(years * 12 + months, 0);
      document.getElementById('r-age-days').textContent = fmt(days, 0);
      document.getElementById('r-age-next').textContent = daysToB === 0 ? 'üéâ Today!' : daysToB;
      document.getElementById('r-age').classList.add('show');
    }

    // GPA
    function initGPA() {
      document.getElementById('gpa-rows').innerHTML = '';
      for (let i = 0; i < 4; i++) addGpaRow();
    }
    function addGpaRow() {
      const d = document.createElement('div');
      d.style.cssText = 'display:grid;grid-template-columns:1fr 100px 80px;gap:0.5rem;margin-bottom:0.5rem;';
      d.innerHTML = `
    <input type="text" placeholder="Course name" style="background:var(--surface2);border:1px solid var(--border);border-radius:8px;padding:0.55rem 0.75rem;font-family:inherit;font-size:0.9rem;color:var(--text);outline:none;">
    <select style="background:var(--surface2);border:1px solid var(--border);border-radius:8px;padding:0.55rem;font-family:inherit;font-size:0.9rem;color:var(--text);outline:none;">
      <option value="4">A (4.0)</option><option value="3.7">A- (3.7)</option>
      <option value="3.3">B+ (3.3)</option><option value="3">B (3.0)</option>
      <option value="2.7">B- (2.7)</option><option value="2.3">C+ (2.3)</option>
      <option value="2">C (2.0)</option><option value="1.7">C- (1.7)</option>
      <option value="1">D (1.0)</option><option value="0">F (0.0)</option>
    </select>
    <input type="number" value="3" min="0" max="6" placeholder="Credits" style="background:var(--surface2);border:1px solid var(--border);border-radius:8px;padding:0.55rem;font-family:inherit;font-size:0.9rem;color:var(--text);outline:none;">`;
      document.getElementById('gpa-rows').appendChild(d);
    }
    function calcGPA() {
      const rows = document.getElementById('gpa-rows').children;
      let totalPts = 0, totalCredits = 0;
      for (const row of rows) {
        const grade = parseFloat(row.querySelectorAll('select, input[type=number]')[0]?.value || row.querySelector('select').value);
        const credits = parseFloat(row.querySelectorAll('input[type=number]')[0]?.value || 3);
        if (isNaN(grade) || isNaN(credits)) continue;
        totalPts += grade * credits; totalCredits += credits;
      }
      const gpa = totalCredits > 0 ? totalPts / totalCredits : 0;
      document.getElementById('r-gpa-val').textContent = gpa.toFixed(2);
      document.getElementById('r-gpa-credits').textContent = totalCredits;
      const letter = gpa >= 3.7 ? 'A+' : gpa >= 3.3 ? 'A' : gpa >= 3 ? 'A-' : gpa >= 2.7 ? 'B+' : gpa >= 2.3 ? 'B' : gpa >= 2 ? 'B-' : gpa >= 1.7 ? 'C+' : gpa >= 1 ? 'C' : 'F';
      document.getElementById('r-gpa-letter').textContent = letter;
      document.getElementById('r-gpa').classList.add('show');
    }

    // FUEL
    function calcFuel() {
      const dist = parseFloat(document.getElementById('fuel-dist').value) || 0;
      const mpg = parseFloat(document.getElementById('fuel-mpg').value) || 1;
      const price = parseFloat(document.getElementById('fuel-price').value) || 0;
      const gallons = dist / mpg;
      const cost = gallons * price;
      document.getElementById('r-fuel-cost').textContent = fmtM(cost);
      document.getElementById('r-fuel-gallons').textContent = fmt(gallons, 1);
      document.getElementById('r-fuel-per100').textContent = fmtM(cost * 100 / dist);
      document.getElementById('r-fuel').classList.add('show');
    }

    // ROI
    function calcROI() {
      const invest = parseFloat(document.getElementById('roi-invest').value) || 1;
      const final = parseFloat(document.getElementById('roi-final').value) || 0;
      const years = parseFloat(document.getElementById('roi-years').value) || 1;
      const profit = final - invest;
      const roi = profit / invest * 100;
      const annualRoi = (Math.pow(final / invest, 1 / years) - 1) * 100;
      const el = document.getElementById('r-roi-pct');
      el.textContent = (roi >= 0 ? '+' : '') + fmt(roi, 1) + '%';
      el.style.color = roi >= 0 ? 'var(--green)' : 'var(--pink)';
      document.getElementById('r-roi-profit').textContent = (profit >= 0 ? '' : '-') + '$' + fmt(Math.abs(profit), 0);
      document.getElementById('r-roi-annual').textContent = (annualRoi >= 0 ? '+' : '') + fmt(annualRoi, 1) + '%';
      document.getElementById('r-roi').classList.add('show');
    }

    // CREDIT CARD
    function calcCreditCard() {
      const balance = parseFloat(document.getElementById('cc-balance').value) || 0;
      const apr = parseFloat(document.getElementById('cc-apr').value) || 0;
      const payment = parseFloat(document.getElementById('cc-payment').value) || 0;
      const r = apr / 100 / 12;
      if (payment <= balance * r) {
        document.getElementById('r-cc-months').textContent = '‚àû (payment too low)';
        document.getElementById('r-cc-interest').textContent = '‚àû';
        document.getElementById('r-cc-total').textContent = '‚àû';
        document.getElementById('r-cc').classList.add('show');
        return;
      }
      const months = Math.ceil(-Math.log(1 - (r * balance / payment)) / Math.log(1 + r));
      const totalPaid = payment * months;
      document.getElementById('r-cc-months').textContent = months < 12 ? months + ' months' : (months / 12).toFixed(1) + ' years';
      document.getElementById('r-cc-interest').textContent = fmtM(totalPaid - balance);
      document.getElementById('r-cc-total').textContent = fmtM(totalPaid);
      document.getElementById('r-cc').classList.add('show');
    }

    // WATER
    function calcWater() {
      const lbs = parseFloat(document.getElementById('wat-weight').value) || 0;
      const act = parseFloat(document.getElementById('wat-activity').value);
      const oz = lbs * 0.5 * act;
      document.getElementById('r-wat-oz').textContent = fmt(oz, 0) + ' oz';
      document.getElementById('r-wat-cups').textContent = fmt(oz / 8, 1);
      document.getElementById('r-wat-liters').textContent = fmt(oz * 0.0295735, 1) + ' L';
      document.getElementById('r-water').classList.add('show');
    }

    // PREGNANCY
    function calcPregnancy() {
      const lmpVal = document.getElementById('preg-lmp').value;
      if (!lmpVal) { alert('Please select your Last Menstrual Period date.'); return; }
      const lmpDate = new Date(lmpVal);
      // Ensure the time component doesn't mess with day calculation (set to midnight local time)
      lmpDate.setHours(0, 0, 0, 0);

      const cycleLen = parseInt(document.getElementById('preg-cycle').value) || 28;

      // Naegele's rule: LMP + 280 days + (cycleLength - 28)
      const adjustedDays = 280 + (cycleLen - 28);

      const edd = new Date(lmpDate);
      edd.setDate(edd.getDate() + adjustedDays);

      const conception = new Date(edd);
      conception.setDate(conception.getDate() - 266);

      const today = new Date();
      today.setHours(0, 0, 0, 0);

      const diffMs = today - lmpDate;
      const currentDays = Math.floor(diffMs / 86400000);

      let weekDayStr = '‚Äî';
      let trimester = '‚Äî';
      let remaining = '‚Äî';

      if (currentDays >= 0 && currentDays <= adjustedDays) {
        const weeks = Math.floor(currentDays / 7);
        const days = currentDays % 7;
        weekDayStr = `Week ${weeks}, Day ${days}`;

        if (weeks < 13) trimester = '1st (1-12 weeks)';
        else if (weeks < 27) trimester = '2nd (13-26 weeks)';
        else trimester = '3rd (27-40+ weeks)';

        remaining = (adjustedDays - currentDays) + ' days';
      } else if (currentDays > adjustedDays) {
        weekDayStr = 'Overdue';
        remaining = '0 days';
        trimester = '3rd (Overdue)';
      } else {
        weekDayStr = 'Future Date Selected';
      }

      const opts = { month: 'short', day: 'numeric', year: 'numeric' };
      document.getElementById('r-preg-edd').textContent = edd.toLocaleDateString('en-US', opts);
      document.getElementById('r-preg-days-left').textContent = remaining + ' left';
      document.getElementById('r-preg-week').textContent = weekDayStr;
      document.getElementById('r-preg-trimester').textContent = trimester;
      document.getElementById('r-preg-conception').textContent = conception.toLocaleDateString('en-US', opts);

      // ‚îÄ‚îÄ Fetus visualization ‚îÄ‚îÄ
      const fetusData = [
        // [emoji, sizeComparison, length, weight, developmentNote]  ‚Äî per week (index 0 = week 0)
        ['üî¨', 'Microscopic', '< 0.1 mm', '‚Äî', 'Fertilized egg begins dividing'],
        ['üî¨', 'Microscopic', '< 0.1 mm', '‚Äî', 'Cells continue rapid division'],
        ['üî¨', 'Microscopic', '0.1 mm', '‚Äî', 'Blastocyst implants in uterus'],
        ['üî¨', 'Microscopic', '0.2 mm', '‚Äî', 'Embryo begins forming; neural tube develops'],
        ['üå∞', 'Poppy Seed', '1 mm', '< 1 g', 'Heart begins to beat; brain forming'],
        ['ü´ò', 'Sesame Seed', '2 mm', '< 1 g', 'Arm and leg buds appear'],
        ['ü´ê', 'Lentil', '5 mm', '< 1 g', 'Nose, mouth & ears forming'],
        ['ü´ê', 'Blueberry', '1.3 cm', '< 1 g', 'Fingers and toes begin forming'],
        ['üçá', 'Raspberry', '1.6 cm', '1 g', 'All major organs forming; can move'],
        ['ü´í', 'Olive', '2.3 cm', '2 g', 'Bones begin hardening; tiny teeth buds'],
        ['üçì', 'Strawberry', '3.1 cm', '4 g', 'Fingernails developing; can hiccup'],
        ['üçã', 'Lime', '4.1 cm', '7 g', 'Vocal cords forming; reflexes developing'],
        ['üçã', 'Lemon', '5.4 cm', '14 g', 'Fingerprints forming; can squint'],
        ['üçä', 'Navel Orange', '7.4 cm', '23 g', 'Can sense light; lanugo hair grows'],
        ['üçé', 'Apple', '8.7 cm', '42 g', 'Can hear sounds; taste buds active'],
        ['üçê', 'Avocado', '10.1 cm', '70 g', 'Skeleton hardening; can make faces'],
        ['ü´ë', 'Pear', '11.6 cm', '100 g', 'Can yawn and stretch'],
        ['ü•≠', 'Mango', '13.2 cm', '140 g', 'Nervous system maturing; vernix forms'],
        ['ü•≠', 'Mango', '14.2 cm', '190 g', 'Hair growing on head; can grip'],
        ['üçå', 'Banana', '15.3 cm', '240 g', 'Swallowing amniotic fluid regularly'],
        ['ü•ï', 'Carrot', '16.7 cm', '300 g', 'Sleep-wake cycles beginning'],
        ['ü•ï', 'Spaghetti Squash', '19.2 cm', '350 g', 'Eyelids can open; lungs developing'],
        ['üåΩ', 'Corn Cob', '21.6 cm', '430 g', 'Responds to sound and music'],
        ['üåΩ', 'Ear of Corn', '22.0 cm', '500 g', 'Brain growing rapidly; viable if born'],
        ['ü•í', 'Zucchini', '23.0 cm', '570 g', 'Developing sense of balance'],
        ['ü•¶', 'Cauliflower', '24.0 cm', '660 g', 'Can open eyes; lungs producing surfactant'],
        ['ü•¶', 'Head of Lettuce', '25.0 cm', '760 g', 'Can dream (REM sleep detected!)'],
        ['üçÜ', 'Eggplant', '27.0 cm', '875 g', 'Five senses fully developed'],
        ['üçÜ', 'Butternut Squash', '28.0 cm', '1.0 kg', 'Gaining weight rapidly now'],
        ['ü••', 'Coconut', '30.0 cm', '1.2 kg', 'Bones fully developed (still soft)'],
        ['ü••', 'Coconut', '32.0 cm', '1.5 kg', 'Can turn head side to side'],
        ['üçç', 'Pineapple', '34.0 cm', '1.7 kg', 'Fat layer building; skin smoothing'],
        ['üçç', 'Pineapple', '35.0 cm', '1.9 kg', 'Immune system strengthening'],
        ['üçç', 'Honeydew Melon', '37.0 cm', '2.1 kg', 'Lungs nearly mature'],
        ['üéÉ', 'Cantaloupe', '38.0 cm', '2.4 kg', 'Brain connections increasing rapidly'],
        ['üéÉ', 'Cantaloupe', '40.0 cm', '2.6 kg', 'Baby is head-down, ready to drop'],
        ['üçâ', 'Honeydew Melon', '43.0 cm', '2.9 kg', 'Lungs mature; gaining 30g/day'],
        ['üçâ', 'Winter Melon', '46.0 cm', '3.1 kg', 'Full term! Ready for birth'],
        ['üçâ', 'Small Watermelon', '48.0 cm', '3.3 kg', 'Movements may feel tighter'],
        ['üçâ', 'Watermelon', '50.0 cm', '3.5 kg', 'Your baby is fully ready!'],
        ['üçâ', 'Watermelon', '51.0 cm', '3.6 kg', 'Due date week ‚Äî welcome baby!']
      ];

      const weeks = currentDays >= 0 ? Math.min(Math.floor(currentDays / 7), 40) : 0;
      const viz = document.getElementById('preg-fetus-viz');

      if (currentDays >= 0 && currentDays <= adjustedDays + 14) {
        const data = fetusData[weeks] || fetusData[40];
        viz.style.display = 'block';

        // Animated icon scaling (smaller early, bigger later)
        const iconSize = Math.max(2.5, Math.min(6, 2.5 + (weeks / 40) * 3.5));
        const icon = document.getElementById('preg-fetus-icon');
        icon.textContent = data[0];
        icon.style.fontSize = iconSize + 'rem';

        document.getElementById('preg-size-compare').textContent = `${data[0]} About the size of a ${data[1]}`;
        document.getElementById('preg-size-detail').textContent = `${data[2]} long ¬∑ ${data[3]}`;
        document.getElementById('preg-dev-note').textContent = data[4];

        // Progress bar
        const pctProgress = Math.min(100, (weeks / 40) * 100);
        document.getElementById('preg-progress-bar').style.width = pctProgress + '%';
        document.getElementById('preg-progress-week').textContent = `Week ${weeks}`;
      } else {
        viz.style.display = 'none';
      }

      document.getElementById('r-pregnancy').classList.add('show');
    }

    // HEART RATE ZONES
    function calcHeartRate() {
      const age = parseInt(document.getElementById('hr-age').value) || 30;
      const rest = parseInt(document.getElementById('hr-rest').value) || 60;

      const maxHr = 220 - age;
      const hrr = maxHr - rest; // Heart Rate Reserve (Karvonen)

      const calcZone = (pct) => Math.round(rest + (hrr * pct));

      document.getElementById('r-hr-max').textContent = maxHr;
      document.getElementById('r-hr-z1').textContent = `${calcZone(0.50)} - ${calcZone(0.60)}`;
      document.getElementById('r-hr-z2').textContent = `${calcZone(0.60)} - ${calcZone(0.70)}`;
      document.getElementById('r-hr-z3').textContent = `${calcZone(0.70)} - ${calcZone(0.80)}`;
      document.getElementById('r-hr-z4').textContent = `${calcZone(0.80)} - ${calcZone(0.90)}`;
      document.getElementById('r-hr-z5').textContent = `${calcZone(0.90)} - ${calcZone(1.00)}`;

      document.getElementById('r-heartrate').classList.add('show');
    }

    // IDEAL WEIGHT
    function calcIdealWeight() {
      const g = document.getElementById('iw-gender').value;
      const hCm = parseFloat(document.getElementById('iw-height').value) || 0;
      const frame = document.getElementById('iw-frame').value;

      if (hCm < 100 || hCm > 250) { alert('Please enter a valid height (100-250cm).'); return; }

      const hInches = hCm / 2.54;
      const over5Ft = Math.max(0, hInches - 60); // inches over 5 feet

      // J.D. Robinson (1983)
      let robinson = g === 'male' ? 52 + (1.9 * over5Ft) : 49 + (1.7 * over5Ft);

      // D.R. Miller (1983)
      let miller = g === 'male' ? 56.2 + (1.41 * over5Ft) : 53.1 + (1.36 * over5Ft);

      // B.J. Devine (1974)
      let devine = g === 'male' ? 50 + (2.3 * over5Ft) : 45.5 + (2.3 * over5Ft);

      // Apply frame adjustment (+/- 10%)
      const adj = frame === 'small' ? 0.9 : (frame === 'large' ? 1.1 : 1);
      robinson *= adj;
      miller *= adj;
      devine *= adj;

      // Primary range: +/- 10% from the average of the three formulas
      const avg = (robinson + miller + devine) / 3;
      const low = avg * 0.9;
      const high = avg * 1.1;

      document.getElementById('r-iw-primary').textContent = `${fmt(low, 1)} - ${fmt(high, 1)} kg`;
      document.getElementById('r-iw-robinson').textContent = `${fmt(robinson, 1)} kg`;
      document.getElementById('r-iw-miller').textContent = `${fmt(miller, 1)} kg`;
      document.getElementById('r-iw-devine').textContent = `${fmt(devine, 1)} kg`;

      document.getElementById('r-idealweight').classList.add('show');
    }

    // SLEEP CALCULATOR
    function calcSleep() {
      const mode = document.getElementById('slp-mode').value;
      const timeVal = document.getElementById('slp-time').value;
      if (!timeVal) { alert('Please select a time.'); return; }

      const [h, m] = timeVal.split(':').map(Number);
      const baseDate = new Date();
      baseDate.setHours(h, m, 0, 0);

      const cycles = [6, 5, 4, 3]; // 9h, 7.5h, 6h, 4.5h
      const resultsHTML = [];

      for (let c of cycles) {
        const target = new Date(baseDate);
        // 1 cycle = 90 mins = 5400000 ms. Fall asleep time = 15 mins = 900000 ms.
        if (mode === 'wake') {
          // Time to go to bed = Wake time - (cycles * 90) - 15 mins to fall asleep
          target.setTime(target.getTime() - (c * 5400000) - 900000);
        } else {
          // Time to wake up = Bed time + 15 mins to fall asleep + (cycles * 90)
          target.setTime(target.getTime() + 900000 + (c * 5400000));
        }

        const timeStr = target.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });
        const hours = (c * 90) / 60;

        // Highlight 5 and 6 cycles as optimal
        const color = (c === 5 || c === 6) ? 'var(--green)' : (c === 4 ? 'var(--yellow)' : 'var(--orange)');

        resultsHTML.push(`
          <div class="result-item">
            <span class="result-value" style="color:${color}">${timeStr}</span>
            <div class="result-label">${c} Cycles (${hours} Hours)</div>
          </div>
        `);
      }

      document.getElementById('r-slp-cycles').innerHTML = resultsHTML.join('');
      document.getElementById('r-sleep').classList.add('show');
    }


    // DATE DIFF
    function calcDateDiff() {
      const start = new Date(document.getElementById('dd-start').value);
      const end = new Date(document.getElementById('dd-end').value);
      const diffMs = Math.abs(end - start);
      const days = Math.floor(diffMs / 86400000);
      document.getElementById('r-dd-days').textContent = fmt(days, 0);
      document.getElementById('r-dd-weeks').textContent = fmt(days / 7, 1);
      document.getElementById('r-dd-months').textContent = fmt(days / 30.44, 1);
      document.getElementById('r-datediff').classList.add('show');
    }

    // TAX
    function calcTax() {
      const price = parseFloat(document.getElementById('stax-price').value) || 0;
      const rate = parseFloat(document.getElementById('stax-rate').value) || 0;
      const mode = document.getElementById('stax-mode').value;
      let pre, taxAmt, total;
      if (mode === 'add') { pre = price; taxAmt = price * rate / 100; total = pre + taxAmt; }
      else { total = price; pre = price / (1 + rate / 100); taxAmt = total - pre; }
      document.getElementById('r-tax-pre').textContent = fmtM(pre);
      document.getElementById('r-tax-amount').textContent = fmtM(taxAmt);
      document.getElementById('r-tax-total').textContent = fmtM(total);
      document.getElementById('r-tax').classList.add('show');
    }

    // INFLATION
    function calcInflation() {
      const amount = parseFloat(document.getElementById('inf-amount').value) || 0;
      const rate = parseFloat(document.getElementById('inf-rate').value) / 100 || 0;
      const years = parseInt(document.getElementById('inf-years').value) || 0;

      // Future Need = amount * (1 + rate)^years 
      // How much money you will need in the future to have the same buying power as 'amount' today
      const futureNeed = amount * Math.pow(1 + rate, years);

      // Future Value (Purchasing Power) = amount / (1 + rate)^years
      // What 'amount' today will feel like it's worth in the future
      const futureValue = amount / Math.pow(1 + rate, years);

      const lost = amount - futureValue;
      const cumulative = (Math.pow(1 + rate, years) - 1) * 100;
      const futureYear = new Date().getFullYear() + years;

      document.getElementById('r-inf-value').textContent = fmtM(futureValue);
      document.getElementById('r-inf-cumulative').textContent = fmt(cumulative, 1) + '%';
      document.getElementById('r-inf-lost').textContent = fmtM(lost);

      const noteAmountEl = document.getElementById('r-inf-amount-note');
      if (noteAmountEl) noteAmountEl.textContent = amount.toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 2 });

      const noteNeedEl = document.getElementById('r-inf-future-need');
      if (noteNeedEl) noteNeedEl.textContent = fmtM(futureNeed);

      const yearEl = document.getElementById('r-inf-future-year');
      if (yearEl) yearEl.textContent = futureYear;

      document.getElementById('r-inflation').classList.add('show');
    }

    // RETIREMENT
    function calcRetirement() {
      const currentAge = parseFloat(document.getElementById('ret-age').value) || 30;
      const retireAge = parseFloat(document.getElementById('ret-retire').value) || 65;
      const currentSav = parseFloat(document.getElementById('ret-current').value) || 0;
      const monthlyContr = parseFloat(document.getElementById('ret-contrib').value) || 0;
      const annualReturn = parseFloat(document.getElementById('ret-return').value) / 100 || 0.07;
      const inflation = parseFloat(document.getElementById('ret-inflation').value) / 100 || 0.03;
      const monthlyGoal = parseFloat(document.getElementById('ret-goal').value) || 4000;

      const years = Math.max(retireAge - currentAge, 1);
      const months = years * 12;
      const r = annualReturn / 12; // monthly rate

      // Future value of current savings
      const fvCurrent = currentSav * Math.pow(1 + r, months);

      // Future value of monthly contributions (annuity)
      const fvContrib = r > 0
        ? monthlyContr * ((Math.pow(1 + r, months) - 1) / r)
        : monthlyContr * months;

      const projectedNestEgg = fvCurrent + fvContrib;

      // Inflation-adjust the monthly goal to retirement date (today's dollars shown)
      const inflatedGoal = monthlyGoal * Math.pow(1 + inflation, years);
      // Nest egg needed: 4% safe withdrawal (annual = monthlyGoal*12, so nest egg = goal*12/0.04 = goal*300)
      const neededNestEgg = inflatedGoal * 12 / 0.04;

      // Monthly income the projected nest egg supports (inflation-adjusted, in today's dollars)
      const supportedMonthlyInflated = projectedNestEgg * 0.04 / 12;
      const supportedMonthlyToday = supportedMonthlyInflated / Math.pow(1 + inflation, years);

      // Monthly savings needed to hit the target (if there's a gap)
      const gap = neededNestEgg - fvCurrent; // what contributions need to cover
      let recommendedMonthly = r > 0
        ? gap * r / (Math.pow(1 + r, months) - 1)
        : gap / months;
      recommendedMonthly = Math.max(0, recommendedMonthly);

      // Render
      document.getElementById('ret-r-nest').textContent = fmtM(projectedNestEgg);
      document.getElementById('ret-r-needed').textContent = fmtM(neededNestEgg);
      document.getElementById('ret-r-income').textContent = fmtM(supportedMonthlyToday) + '/mo';
      document.getElementById('ret-r-monthly').textContent = fmtM(recommendedMonthly) + '/mo';
      document.getElementById('ret-r-years').textContent = years + ' yrs';

      // Verdict
      const verdict = document.getElementById('ret-r-verdict');
      if (projectedNestEgg >= neededNestEgg) {
        verdict.style.background = 'rgba(34,211,160,0.12)';
        verdict.style.border = '1px solid rgba(34,211,160,0.3)';
        verdict.style.color = '#22d3a0';
        const surplus = projectedNestEgg - neededNestEgg;
        verdict.textContent = `‚úÖ You're on track! Your plan projects a surplus of ${fmtM(surplus)} above your goal.`;
      } else {
        const shortfall = neededNestEgg - projectedNestEgg;
        verdict.style.background = 'rgba(255,140,66,0.1)';
        verdict.style.border = '1px solid rgba(255,140,66,0.3)';
        verdict.style.color = '#ff8c42';
        verdict.textContent = `‚ö†Ô∏è Shortfall of ${fmtM(shortfall)}. Increase monthly savings to ${fmtM(recommendedMonthly)}/mo to reach your goal.`;
      }
      document.getElementById('r-retirement').classList.add('show');
    }


    // CURRENCY CONVERTER
    const CURRENCY_LIST = [
      ['USD', '$ US Dollar'], ['EUR', '‚Ç¨ Euro'], ['GBP', '¬£ British Pound'], ['SAR', 'ÿ±.ÿ≥ Saudi Riyal'],
      ['AED', 'ÿØ.ÿ• UAE Dirham'], ['JPY', '¬• Japanese Yen'], ['CNY', '¬• Chinese Yuan'], ['INR', '‚Çπ Indian Rupee'],
      ['KWD', 'ÿØ.ŸÉ Kuwaiti Dinar'], ['QAR', 'ÿ±.ŸÇ Qatari Riyal'], ['BHD', 'BD Bahraini Dinar'], ['OMR', 'ÿ±.ÿπ Omani Rial'],
      ['EGP', 'ÿ¨.ŸÖ Egyptian Pound'], ['JOD', 'ÿØ.ÿß Jordanian Dinar'], ['TRY', '‚Ç∫ Turkish Lira'],
      ['CAD', 'C$ Canadian Dollar'], ['AUD', 'A$ Australian Dollar'], ['CHF', 'Fr Swiss Franc'],
      ['SEK', 'kr Swedish Krona'], ['NOK', 'kr Norwegian Krone'], ['DKK', 'kr Danish Krone'],
      ['HKD', 'HK$ Hong Kong Dollar'], ['SGD', 'S$ Singapore Dollar'], ['KRW', '‚Ç© South Korean Won'],
      ['MYR', 'RM Malaysian Ringgit'], ['THB', '‡∏ø Thai Baht'], ['IDR', 'Rp Indonesian Rupiah'],
      ['PKR', '‚Ç® Pakistani Rupee'], ['BDT', '‡ß≥ Bangladeshi Taka'], ['NGN', '‚Ç¶ Nigerian Naira'],
      ['ZAR', 'R South African Rand'], ['BRL', 'R$ Brazilian Real'], ['MXN', '$ Mexican Peso'],
    ];
    // Base: USD fallback rates (approximate, updated Feb 2026)
    const CUR_FALLBACK = {
      USD: 1, EUR: 0.924, GBP: 0.791, SAR: 3.751, AED: 3.673, JPY: 149.5, CNY: 7.24,
      INR: 83.1, KWD: 0.307, QAR: 3.641, BHD: 0.377, OMR: 0.385, EGP: 30.9, JOD: 0.709,
      TRY: 32.5, CAD: 1.356, AUD: 1.535, CHF: 0.878, SEK: 10.45, NOK: 10.58, DKK: 6.9,
      HKD: 7.824, SGD: 1.344, KRW: 1327, MYR: 4.74, THB: 35.5, IDR: 15700, PKR: 278,
      BDT: 110, NGN: 1580, ZAR: 18.8, BRL: 4.98, MXN: 17.15,
    };
    let curRates = null; // will be {base:'USD', rates:{...}}
    const POPULAR_TARGETS = ['USD', 'EUR', 'GBP', 'SAR', 'AED', 'JPY', 'CAD', 'AUD', 'CHF', 'INR'];

    function curPopulate() {
      const fromSel = document.getElementById('cur-from');
      const toSel = document.getElementById('cur-to');
      if (!fromSel || !toSel) return;
      fromSel.innerHTML = '';
      toSel.innerHTML = '';
      CURRENCY_LIST.forEach(([code, label]) => {
        const o1 = `<option value="${code}" ${code === 'USD' ? 'selected' : ''}>${code} ‚Äî ${label.split(' ').slice(1).join(' ')}</option>`;
        const o2 = `<option value="${code}" ${code === 'SAR' ? 'selected' : ''}>${code} ‚Äî ${label.split(' ').slice(1).join(' ')}</option>`;
        fromSel.insertAdjacentHTML('beforeend', o1);
        toSel.insertAdjacentHTML('beforeend', o2);
      });

      const triggerCalc = () => { updateRateTag(); convertCurrency(); };
      fromSel.addEventListener('change', triggerCalc);
      toSel.addEventListener('change', triggerCalc);
      document.getElementById('cur-amount').addEventListener('input', convertCurrency);
    }

    function getRate(from, to) {
      if (!curRates) return CUR_FALLBACK[to] / CUR_FALLBACK[from];
      const base = curRates.rates;
      // The API base is EUR.
      // If a currency is missing from the API (like SAR, AED), we anchor it to the live USD rate.
      // E.g., if live EUR->USD is 1.08, and fallback USD->SAR is 3.75, live EUR->SAR = 1.08 * 3.75 = 4.05
      const liveUSD = base['USD'] || (1 / CUR_FALLBACK['EUR']);

      const getRateToBase = (c) => {
        if (c === 'EUR') return 1;
        if (base[c]) return base[c];
        // Missing from API: use (Live USD/EUR) * (Fallback CUR/USD)
        return liveUSD * CUR_FALLBACK[c];
      };

      const fromEUR = getRateToBase(from);
      const toEUR = getRateToBase(to);
      return toEUR / fromEUR;
    }

    function updateRateTag() {
      const from = document.getElementById('cur-from')?.value;
      const to = document.getElementById('cur-to')?.value;
      if (!from || !to) return;
      const rate = getRate(from, to);
      const rateEl = document.getElementById('cur-rate-display');
      const tagEl = document.getElementById('cur-rate-tag');
      if (rateEl) rateEl.textContent = rate.toFixed(rate < 0.01 ? 6 : rate < 1 ? 4 : 4) + ' ' + to;
      if (tagEl) tagEl.firstChild.textContent = '1 ' + from + ' = ';
    }

    function swapCurrency() {
      const f = document.getElementById('cur-from');
      const t = document.getElementById('cur-to');
      if (!f || !t) return;
      [f.value, t.value] = [t.value, f.value];
      updateRateTag();
    }

    function convertCurrency() {
      const amount = parseFloat(document.getElementById('cur-amount').value) || 0;
      const from = document.getElementById('cur-from').value;
      const to = document.getElementById('cur-to').value;
      const rate = getRate(from, to);
      const result = amount * rate;
      const dp = result < 0.1 ? 6 : result < 1 ? 4 : 2;
      document.getElementById('cur-r-main').textContent = result.toLocaleString('en-US', { minimumFractionDigits: dp, maximumFractionDigits: dp }) + ' ' + to;
      document.getElementById('cur-r-label').textContent = `${amount.toLocaleString()} ${from} ‚Üí`;

      // Multi grid
      const grid = document.getElementById('cur-multi-grid');
      grid.innerHTML = POPULAR_TARGETS.filter(c => c !== to).slice(0, 8).map(c => {
        const r = getRate(from, c);
        const v = (amount * r);
        const d = v < 1 ? 4 : 2;
        return `<div class="cur-multi-item"><div class="cur-code">${c}</div><div class="cur-val">${v.toLocaleString('en-US', { minimumFractionDigits: d, maximumFractionDigits: d })}</div></div>`;
      }).join('');
      document.getElementById('r-currency').classList.add('show');
    }

    async function loadCurrencyRates() {
      const statusEl = document.getElementById('cur-status');
      try {
        const res = await fetch('https://api.frankfurter.app/latest?base=EUR&symbols=USD,GBP,SAR,AED,JPY,CNY,INR,KWD,QAR,BHD,OMR,EGP,JOD,TRY,CAD,AUD,CHF,SEK,NOK,DKK,HKD,SGD,KRW,MYR,THB,IDR,PKR,BDT,NGN,ZAR,BRL,MXN');
        if (!res.ok) throw new Error('API error');
        const data = await res.json();
        curRates = { base: 'EUR', rates: { ...data.rates, EUR: 1 } };
        if (statusEl) { statusEl.textContent = 'üü¢ Live rates ¬∑ ' + data.date; statusEl.className = 'cur-status live'; }
        updateRateTag();
      } catch (e) {
        if (statusEl) { statusEl.textContent = '‚ö™ Offline mode ‚Äî using approximate rates (Feb 2026)'; statusEl.className = 'cur-status offline'; }
      }
    }

    // RANDOM
    function calcRandom() {
      const min = parseInt(document.getElementById('rng-min').value) || 0;
      const max = parseInt(document.getElementById('rng-max').value) || 100;
      const count = Math.min(parseInt(document.getElementById('rng-count').value) || 1, 50);
      const nums = Array.from({ length: count }, () => Math.floor(Math.random() * (max - min + 1)) + min);
      document.getElementById('r-rng-numbers').innerHTML = nums.join('  ¬∑  ');
      document.getElementById('r-random').classList.add('show');
    }

    // PACE
    function updatePaceFields() {
      const solve = document.getElementById('pace-solve').value;
      document.getElementById('pace-pace-field').style.display = solve === 'pace' ? 'none' : '';
    }
    function calcPace() {
      const solve = document.getElementById('pace-solve').value;
      const dist = parseFloat(document.getElementById('pace-dist').value) || 0;
      const h = parseInt(document.getElementById('pace-h').value) || 0;
      const m = parseInt(document.getElementById('pace-m').value) || 0;
      const s = parseInt(document.getElementById('pace-s').value) || 0;
      const totalSec = h * 3600 + m * 60 + s;
      const pMin = parseInt(document.getElementById('pace-min')?.value || 0);
      const pSec = parseInt(document.getElementById('pace-sec')?.value || 0);
      let result, label;
      if (solve === 'pace') {
        const secPerKm = totalSec / dist;
        result = Math.floor(secPerKm / 60) + ':' + String(Math.round(secPerKm % 60)).padStart(2, '0') + ' /km';
        label = 'Pace';
      } else if (solve === 'time') {
        const paceSec = pMin * 60 + pSec;
        const totalT = paceSec * dist;
        result = Math.floor(totalT / 3600) + 'h ' + Math.floor((totalT % 3600) / 60) + 'm ' + Math.round(totalT % 60) + 's';
        label = 'Finish Time';
      } else {
        const paceSec = pMin * 60 + pSec;
        result = fmt(totalSec / paceSec, 2) + ' km';
        label = 'Distance';
      }
      document.getElementById('r-pace-result').textContent = result;
      document.getElementById('r-pace-label').textContent = label;
      document.getElementById('r-pace').classList.add('show');
    }

    // ‚îÄ‚îÄ UNIT CONVERTER ‚îÄ‚îÄ
    const unitData = {
      length: { units: ['Millimeter', 'Centimeter', 'Meter', 'Kilometer', 'Inch', 'Foot', 'Yard', 'Mile'], toBase: [0.001, 0.01, 1, 1000, 0.0254, 0.3048, 0.9144, 1609.344] },
      weight: { units: ['Milligram', 'Gram', 'Kilogram', 'Tonne', 'Ounce', 'Pound', 'Stone'], toBase: [0.000001, 0.001, 1, 1000, 0.0283495, 0.453592, 6.35029] },
      temp: { units: ['Celsius', 'Fahrenheit', 'Kelvin'], toBase: null },
      volume: { units: ['Milliliter', 'Liter', 'Cup', 'Fluid Ounce', 'Pint', 'Quart', 'Gallon'], toBase: [0.001, 1, 0.236588, 0.0295735, 0.473176, 0.946353, 3.78541] },
      speed: { units: ['m/s', 'km/h', 'mph', 'knot'], toBase: [1, 0.277778, 0.44704, 0.514444] }
    };
    function updateUnitOptions() {
      const cat = document.getElementById('unit-cat').value;
      const data = unitData[cat];
      const fromSel = document.getElementById('unit-from');
      const toSel = document.getElementById('unit-to');
      fromSel.innerHTML = data.units.map((u, i) => `<option value="${i}">${u}</option>`).join('');
      toSel.innerHTML = data.units.map((u, i) => `<option value="${i}">${u}</option>`).join('');
      toSel.selectedIndex = 1;
      calcUnits();
    }
    function calcUnits() {
      if (!document.getElementById('unit-cat')) return;
      const cat = document.getElementById('unit-cat').value;
      const fromI = parseInt(document.getElementById('unit-from').value);
      const toI = parseInt(document.getElementById('unit-to').value);
      const val = parseFloat(document.getElementById('unit-val').value) || 0;
      const data = unitData[cat];
      let result;
      if (cat === 'temp') {
        const units = data.units;
        let celsius;
        if (fromI === 0) celsius = val; else if (fromI === 1) celsius = (val - 32) * 5 / 9; else celsius = val - 273.15;
        if (toI === 0) result = celsius; else if (toI === 1) result = celsius * 9 / 5 + 32; else result = celsius + 273.15;
      } else {
        const base = val * data.toBase[fromI];
        result = base / data.toBase[toI];
      }
      const el = document.getElementById('r-unit-result');
      if (el) {
        el.textContent = Math.abs(result) < 0.001 || Math.abs(result) > 1e7 ? result.toExponential(4) : fmt(result, 4).replace(/\.?0+$/, '');
        document.getElementById('r-unit-label').textContent = `${data.units[fromI]} ‚Üí ${data.units[toI]}`;
      }
    }

    // GEOMETRY
    function updateGeoFields() {
      const shape = document.getElementById('geo-shape').value;
      document.getElementById('geo-circle-fields').style.display = shape === 'circle' ? 'block' : 'none';
      document.getElementById('geo-rect-fields').style.display = shape === 'rectangle' ? 'block' : 'none';
      document.getElementById('geo-tri-fields').style.display = shape === 'triangle' ? 'block' : 'none';
      document.getElementById('r-geo-perim-lbl').textContent = shape === 'circle' ? 'Circumference' : 'Perimeter';
    }

    function calcGeometry() {
      const shape = document.getElementById('geo-shape').value;
      let area = 0, perim = 0;

      if (shape === 'circle') {
        const r = parseFloat(document.getElementById('geo-r').value) || 0;
        if (r < 0) { alert('Radius cannot be negative.'); return; }
        area = Math.PI * r * r;
        perim = 2 * Math.PI * r;
      } else if (shape === 'rectangle') {
        const l = parseFloat(document.getElementById('geo-l').value) || 0;
        const w = parseFloat(document.getElementById('geo-w').value) || 0;
        if (l < 0 || w < 0) { alert('Length and Width cannot be negative.'); return; }
        area = l * w;
        perim = 2 * (l + w);
      } else if (shape === 'triangle') {
        const b = parseFloat(document.getElementById('geo-b').value) || 0;
        const h = parseFloat(document.getElementById('geo-h').value) || 0;
        if (b < 0 || h < 0) { alert('Base and Height cannot be negative.'); return; }
        area = (b * h) / 2;
        // Assume isosceles for perimeter
        const side = Math.sqrt((b / 2) ** 2 + h ** 2);
        perim = b + (2 * side);
      }

      document.getElementById('r-geo-area').textContent = fmt(area, 2);
      document.getElementById('r-geo-perim').textContent = fmt(perim, 2);

      document.getElementById('r-geometry').classList.add('show');
    }

    // PROBABILITY
    function updateProbFields() {
      const type = document.getElementById('prob-type').value;
      document.getElementById('prob-basic-fields').style.display = type === 'basic' ? 'block' : 'none';
      document.getElementById('prob-cp-fields').style.display = type !== 'basic' ? 'block' : 'none';
      document.getElementById('r-prob-extras').style.display = type === 'basic' ? 'grid' : 'none';
    }

    function calcProbability() {
      const type = document.getElementById('prob-type').value;
      const fact = (n) => {
        if (n < 0) return 0;
        if (n === 0 || n === 1) return 1;
        let r = 1;
        for (let i = 2; i <= n; i++) r *= i;
        return r;
      };

      if (type === 'basic') {
        const fav = parseFloat(document.getElementById('prob-fav').value) || 0;
        const total = parseFloat(document.getElementById('prob-total').value) || 0;

        if (total === 0 || fav < 0 || total < 0 || fav > total) {
          alert('Invalid input. Total must be > 0 and Favorable cannot exceed Total.');
          return;
        }

        const prob = fav / total;
        document.getElementById('r-prob-main').textContent = `${fav} in ${total}`;
        document.getElementById('r-prob-label').textContent = 'Probability (as fraction)';

        document.getElementById('r-prob-pct').textContent = `${fmt(prob * 100, 2)}%`;

        const unfav = total - fav;
        if (fav === 0) {
          document.getElementById('r-prob-odds').textContent = '0 to ' + unfav;
        } else {
          // Simplify odds roughly
          document.getElementById('r-prob-odds').textContent = `${fav} to ${unfav}`;
        }
        document.getElementById('r-prob-extras').style.display = 'grid';

      } else {
        const n = parseInt(document.getElementById('prob-n').value) || 0;
        const r = parseInt(document.getElementById('prob-r').value) || 0;

        if (n < 0 || r < 0 || r > n) {
          alert('Invalid input. n and r must be >= 0, and r cannot exceed n.');
          return;
        }

        if (type === 'comb') {
          const c = fact(n) / (fact(r) * fact(n - r));
          document.getElementById('r-prob-main').textContent = c.toLocaleString();
          document.getElementById('r-prob-label').textContent = `Combinations (${n}C${r})`;
        } else if (type === 'perm') {
          const p = fact(n) / fact(n - r);
          document.getElementById('r-prob-main').textContent = p.toLocaleString();
          document.getElementById('r-prob-label').textContent = `Permutations (${n}P${r})`;
        }
        document.getElementById('r-prob-extras').style.display = 'none';
      }

      document.getElementById('r-probability').classList.add('show');
    }

    // QUADRATIC EQUATION
    function calcQuadratic() {
      const a = parseFloat(document.getElementById('quad-a').value);
      const b = parseFloat(document.getElementById('quad-b').value) || 0;
      const c = parseFloat(document.getElementById('quad-c').value) || 0;

      if (isNaN(a) || a === 0) {
        alert("Coefficient 'a' cannot be 0 for a quadratic equation.");
        return;
      }

      const disc = (b * b) - (4 * a * c);
      let rootsStr = '';
      let typeStr = '';
      let x1 = '‚Äî', x2 = '‚Äî';

      if (disc > 0) {
        typeStr = 'Two Real Roots';
        const root1 = (-b + Math.sqrt(disc)) / (2 * a);
        const root2 = (-b - Math.sqrt(disc)) / (2 * a);
        x1 = fmt(root1, 4);
        x2 = fmt(root2, 4);
        rootsStr = `x = ${x1}, x = ${x2}`;
      } else if (disc === 0) {
        typeStr = 'One Real Root (Repeated)';
        const root = -b / (2 * a);
        x1 = fmt(root, 4);
        x2 = x1;
        rootsStr = `x = ${x1}`;
      } else {
        typeStr = 'Complex/Imaginary Roots';
        const real = -b / (2 * a);
        const img = Math.sqrt(-disc) / (2 * a);
        const rm = fmt(real, 4);
        const im = fmt(Math.abs(img), 4);

        x1 = `${rm} + ${im}i`;
        x2 = `${rm} - ${im}i`;
        rootsStr = `x = ${x1}, x = ${x2}`;
      }

      document.getElementById('r-quad-type').textContent = typeStr;
      document.getElementById('r-quad-roots').textContent = rootsStr;
      document.getElementById('r-quad-disc').textContent = fmt(disc, 4);
      document.getElementById('r-quad-x1').textContent = x1;
      document.getElementById('r-quad-x2').textContent = x2;

      document.getElementById('r-quadratic').classList.add('show');
    }

    // BASE CONVERTER
    function calcBase() {
      const val = document.getElementById('base-val').value.trim();
      const fromBase = parseInt(document.getElementById('base-from').value);

      if (!val) { alert('Please enter a value.'); return; }

      // Parse the input value using the selected base
      const num = parseInt(val, fromBase);
      if (isNaN(num)) {
        alert('Invalid number for the selected base.');
        return;
      }

      // Convert to requested bases and update UI
      document.getElementById('r-base-dec').textContent = num.toString(10);
      document.getElementById('r-base-bin').textContent = num.toString(2);
      document.getElementById('r-base-oct').textContent = num.toString(8);
      document.getElementById('r-base-hex').textContent = num.toString(16).toUpperCase();

      document.getElementById('r-base').classList.add('show');
    }

    // SPEED DISTANCE TIME
    function updateSpeedFields() {
      const solveFor = document.getElementById('spd-solve').value;
      document.getElementById('spd-dist-field').style.display = solveFor === 'distance' ? 'none' : 'block';
      document.getElementById('spd-time-field').style.display = solveFor === 'time' ? 'none' : 'block';
      document.getElementById('spd-speed-field').style.display = solveFor === 'speed' ? 'none' : 'block';
    }

    function calcSpeed() {
      const solveFor = document.getElementById('spd-solve').value;

      const getDistKm = () => {
        const d = parseFloat(document.getElementById('spd-dist').value) || 0;
        const u = document.getElementById('spd-dist-unit').value;
        if (u === 'mi') return d * 1.60934;
        if (u === 'm') return d / 1000;
        return d;
      };

      const getTimeHr = () => {
        const h = parseFloat(document.getElementById('spd-h').value) || 0;
        const m = parseFloat(document.getElementById('spd-m').value) || 0;
        return h + (m / 60);
      };

      const getSpeedKph = () => {
        const s = parseFloat(document.getElementById('spd-speed').value) || 0;
        const u = document.getElementById('spd-speed-unit').value;
        if (u === 'mph') return s * 1.60934;
        if (u === 'mps') return s * 3.6;
        return s;
      };

      let resultVal = 0;
      let resultLbl = '';
      let formatted = '';

      if (solveFor === 'speed') {
        const d = getDistKm();
        const t = getTimeHr();
        if (t <= 0) { alert('Time must be greater than zero.'); return; }

        const speedKph = d / t;
        resultLbl = 'Speed';

        // Output in all 3 formats for convenience
        const mph = speedKph / 1.60934;
        const mps = speedKph / 3.6;
        formatted = `${fmt(speedKph, 2)} km/h<br><span style="font-size:1rem;color:var(--muted)">${fmt(mph, 2)} mph<br>${fmt(mps, 2)} m/s</span>`;

      } else if (solveFor === 'distance') {
        const s = getSpeedKph();
        const t = getTimeHr();

        const distKm = s * t;
        resultLbl = 'Distance';

        const mi = distKm / 1.60934;
        const m = distKm * 1000;
        formatted = `${fmt(distKm, 2)} km<br><span style="font-size:1rem;color:var(--muted)">${fmt(mi, 2)} mi<br>${fmt(m, 2)} m</span>`;

      } else if (solveFor === 'time') {
        const d = getDistKm();
        const s = getSpeedKph();
        if (s <= 0) { alert('Speed must be greater than zero.'); return; }

        const timeHr = d / s;
        resultLbl = 'Time';

        const totalMin = timeHr * 60;
        const hrs = Math.floor(totalMin / 60);
        const mins = Math.round(totalMin % 60);
        formatted = `${hrs > 0 ? hrs + ' hr ' : ''}${mins} min<br><span style="font-size:1rem;color:var(--muted)">${fmt(timeHr, 2)} decimal hours</span>`;
      }

      document.getElementById('r-spd-val').innerHTML = formatted;
      document.getElementById('r-spd-lbl').textContent = resultLbl;
      document.getElementById('r-speed').classList.add('show');
    }

    // TIMEZONE
    function calcTimezone() {
      const timeVal = document.getElementById('tz-time').value;
      const fromOffset = parseFloat(document.getElementById('tz-from').value);
      const toOffset = parseFloat(document.getElementById('tz-to').value);

      if (!timeVal) { alert('Please enter a time.'); return; }

      // Parse input time
      const [hours, mins] = timeVal.split(':').map(Number);

      // Calculate minutes from midnight in the FROM zone
      let totalMins = (hours * 60) + mins;

      // Difference in hours
      const diffHours = toOffset - fromOffset;
      const diffMins = diffHours * 60;

      // Apply offset
      totalMins += diffMins;

      let dayOffset = '';
      if (totalMins < 0) {
        totalMins += (24 * 60);
        dayOffset = ' (Previous Day)';
      } else if (totalMins >= (24 * 60)) {
        totalMins -= (24 * 60);
        dayOffset = ' (Next Day)';
      }

      // Format back to HH:MM
      const finalH = Math.floor(totalMins / 60);
      const finalM = Math.round(totalMins % 60);

      const pad = (n) => n.toString().padStart(2, '0');
      const formattedTime = `${pad(finalH)}:${pad(finalM)}` + dayOffset;

      // Difference string
      const sign = diffHours > 0 ? '+' : '';
      const diffStr = diffHours === 0 ? 'Same Zone' : `${sign}${diffHours} Hours`;

      document.getElementById('r-tz-val').textContent = formattedTime;
      document.getElementById('r-tz-diff').textContent = `Time Difference: ${diffStr}`;

      document.getElementById('r-timezone').classList.add('show');
    }

    // COOKING CONVERTER
    function calcCooking() {
      const val = parseFloat(document.getElementById('cook-val').value) || 0;
      const fromUnit = document.getElementById('cook-from').value;
      const toUnit = document.getElementById('cook-to').value;

      if (val < 0) { alert('Amount cannot be negative.'); return; }

      // Define bases
      // Volume: base is ML
      const volUnits = {
        'ml': 1,
        'l': 1000,
        'tsp': 4.92892,
        'tbsp': 14.7868,
        'floz': 29.5735,
        'cup': 236.588
      };

      // Weight: base is Grams
      const wtUnits = {
        'g': 1,
        'kg': 1000,
        'oz': 28.3495,
        'lb': 453.592
      };

      const isVolFrom = volUnits.hasOwnProperty(fromUnit);
      const isVolTo = volUnits.hasOwnProperty(toUnit);

      if (isVolFrom !== isVolTo) {
        alert('Cannot directly convert between volume and weight without knowing the ingredient density.');
        return;
      }

      let result = 0;
      if (isVolFrom) {
        const inMl = val * volUnits[fromUnit];
        result = inMl / volUnits[toUnit];
      } else {
        const inG = val * wtUnits[fromUnit];
        result = inG / wtUnits[toUnit];
      }

      const selTo = document.getElementById('cook-to');
      let lblText = selTo.options[selTo.selectedIndex].text;

      document.getElementById('r-cook-val').textContent = fmt(result, 2);
      document.getElementById('r-cook-lbl').textContent = lblText;
      document.getElementById('r-cooking').classList.add('show');
    }

    // ‚îÄ‚îÄ SCIENTIFIC CALCULATOR ‚îÄ‚îÄ
    let sciExpr = '', sciResult = null;
    function sciDisplay(val) { if (document.getElementById('sci-display')) document.getElementById('sci-display').textContent = val; }
    function sciExprDisplay(val) { if (document.getElementById('sci-expr')) document.getElementById('sci-expr').textContent = val; }
    function sciKey(k) {
      if (k === 'C') { sciExpr = ''; sciResult = null; sciDisplay('0'); sciExprDisplay(''); return; }
      if (k === 'CE') { sciExpr = sciExpr.slice(0, -1) || ''; sciDisplay(sciExpr || '0'); return; }
      if (k === '‚å´') { sciExpr = sciExpr.slice(0, -1); sciDisplay(sciExpr || '0'); return; }
      if (k === '=') {
        try {
          let expr = sciExpr
            .replace(/√∑/g, '/').replace(/√ó/g, '*').replace(/œÄ/g, 'Math.PI').replace(/e(?!xp)/g, 'Math.E')
            .replace(/sin\(/g, 'Math.sin(').replace(/cos\(/g, 'Math.cos(').replace(/tan\(/g, 'Math.tan(')
            .replace(/log\(/g, 'Math.log10(').replace(/ln\(/g, 'Math.log(')
            .replace(/‚àö\(/g, 'Math.sqrt(').replace(/x¬≤/g, '**2').replace(/\^/g, '**')
            .replace(/1\/x/g, '1/x');
          const res = Function('"use strict";return(' + expr + ')')();
          sciExprDisplay(sciExpr + ' =');
          sciExpr = String(parseFloat(res.toFixed(10)));
          sciDisplay(sciExpr);
        } catch (e) { sciDisplay('Error'); sciExpr = ''; }
        return;
      }
      const map = { '√∑': '√∑', '√ó': '√ó', 'x¬≤': '¬≤', '1/x': '1/(', '‚àö': '‚àö(', 'œÄ': 'œÄ', 'e': 'e', '^': '^' };
      const funcs = ['sin', 'cos', 'tan', 'log', 'ln'];
      if (funcs.includes(k)) { sciExpr += k + '('; }
      else { sciExpr += k; }
      sciDisplay(sciExpr);
    }

    // ‚îÄ‚îÄ INIT ‚îÄ‚îÄ
    document.getElementById('global-search').addEventListener('keydown', e => { if (e.key === 'Escape') { e.target.value = ''; searchCalcs(''); } });

    // Set today's date for age calc if needed
    window.addEventListener('load', () => { });

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  UX POLISH: 5 Features
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

    // ‚îÄ‚îÄ 1. SMOOTH SCROLL TO RESULTS ‚îÄ‚îÄ
    // After any .results div gets .show, scroll it into view
    const resultsObserver = new MutationObserver(mutations => {
      mutations.forEach(m => {
        if (m.type === 'attributes' && m.attributeName === 'class') {
          const el = m.target;
          if (el.classList.contains('results') && el.classList.contains('show')) {
            setTimeout(() => el.scrollIntoView({ behavior: 'smooth', block: 'nearest' }), 100);
          }
        }
      });
    });
    // Observe all current and future .results elements
    function observeResults() {
      document.querySelectorAll('.results').forEach(r => {
        resultsObserver.observe(r, { attributes: true, attributeFilter: ['class'] });
      });
    }
    // Re-observe when modal opens (new results elements are injected)
    const origOpenCalc = window.openCalc;
    window.openCalc = function (id) {
      origOpenCalc(id);
      setTimeout(observeResults, 50);
    };
    observeResults();

    // ‚îÄ‚îÄ 2. SHAKE VALIDATION (replaces alert for inputs) ‚îÄ‚îÄ
    window.shakeField = function (fieldId, message) {
      const el = document.getElementById(fieldId);
      if (!el) { alert(message); return; }
      // Find the closest input wrapper or the element itself
      const target = el.closest('.input-wrap') || el.closest('.field-group') || el;
      target.classList.remove('shake');
      void target.offsetWidth; // force reflow
      target.classList.add('shake');
      target.style.outline = '2px solid var(--pink)';
      setTimeout(() => { target.classList.remove('shake'); target.style.outline = ''; }, 600);

      // Show a subtle inline message
      let tip = target.parentElement.querySelector('.shake-tip');
      if (!tip) {
        tip = document.createElement('div');
        tip.className = 'shake-tip';
        tip.style.cssText = 'font-size:0.75rem;color:var(--pink);margin-top:0.25rem;font-weight:600;transition:opacity 0.3s;';
        target.parentElement.appendChild(tip);
      }
      tip.textContent = message;
      tip.style.opacity = '1';
      setTimeout(() => { tip.style.opacity = '0'; setTimeout(() => tip.remove(), 300); }, 2500);
    };

    // ‚îÄ‚îÄ 3. CONFETTI CELEBRATION ‚îÄ‚îÄ
    window.launchConfetti = function () {
      let canvas = document.getElementById('confetti-canvas');
      if (!canvas) {
        canvas = document.createElement('canvas');
        canvas.id = 'confetti-canvas';
        document.body.appendChild(canvas);
      }
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      const ctx = canvas.getContext('2d');
      const colors = ['#6C63FF', '#FF6B9D', '#00D4AA', '#FFD93D', '#FF8A65', '#AB47BC', '#42A5F5'];
      const particles = [];

      for (let i = 0; i < 120; i++) {
        particles.push({
          x: Math.random() * canvas.width,
          y: Math.random() * canvas.height - canvas.height,
          w: Math.random() * 10 + 4,
          h: Math.random() * 6 + 2,
          color: colors[Math.floor(Math.random() * colors.length)],
          vx: (Math.random() - 0.5) * 4,
          vy: Math.random() * 3 + 2,
          rot: Math.random() * 360,
          rotV: (Math.random() - 0.5) * 8,
          opacity: 1
        });
      }

      let frame = 0;
      function animate() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        let alive = false;
        particles.forEach(p => {
          p.x += p.vx;
          p.y += p.vy;
          p.vy += 0.05;
          p.rot += p.rotV;
          if (frame > 60) p.opacity -= 0.015;
          if (p.opacity <= 0) return;
          alive = true;
          ctx.save();
          ctx.translate(p.x, p.y);
          ctx.rotate(p.rot * Math.PI / 180);
          ctx.globalAlpha = Math.max(0, p.opacity);
          ctx.fillStyle = p.color;
          ctx.fillRect(-p.w / 2, -p.h / 2, p.w, p.h);
          ctx.restore();
        });
        frame++;
        if (alive) requestAnimationFrame(animate);
        else { ctx.clearRect(0, 0, canvas.width, canvas.height); canvas.remove(); }
      }
      requestAnimationFrame(animate);
    };

    // Hook confetti into pregnancy & age calculators
    const origCalcPregnancy = window.calcPregnancy;
    if (typeof calcPregnancy === 'function') {
      const _origPreg = calcPregnancy;
      window.calcPregnancy = function () {
        _origPreg();
        if (document.getElementById('r-pregnancy')?.classList.contains('show')) {
          setTimeout(launchConfetti, 300);
        }
      };
    }

    // ‚îÄ‚îÄ 4. ENTER KEY TO SUBMIT ‚îÄ‚îÄ
    document.addEventListener('keydown', function (e) {
      if (e.key !== 'Enter') return;
      const modal = document.getElementById('modal-overlay');
      if (!modal || !modal.classList.contains('open')) return;
      // Don't trigger if user is inside a textarea
      if (e.target.tagName === 'TEXTAREA') return;

      const calcBtn = modal.querySelector('.calc-btn');
      if (calcBtn) {
        e.preventDefault();
        calcBtn.click();
      }
    });

    // ‚îÄ‚îÄ 5. CURRENCY LOADING SKELETON ‚îÄ‚îÄ
    const origLoadCurrencyRates = window.loadCurrencyRates;
    if (typeof loadCurrencyRates === 'function') {
      const _origLoad = loadCurrencyRates;
      window.loadCurrencyRates = function () {
        // Show skeleton while loading
        const grid = document.getElementById('cur-multi-grid');
        if (grid) {
          grid.innerHTML = `
            <div class="cur-multi-item"><div class="skeleton-line w40"></div><div class="skeleton-line w60"></div></div>
            <div class="cur-multi-item"><div class="skeleton-line w40"></div><div class="skeleton-line w60"></div></div>
            <div class="cur-multi-item"><div class="skeleton-line w40"></div><div class="skeleton-line w60"></div></div>
            <div class="cur-multi-item"><div class="skeleton-line w40"></div><div class="skeleton-line w60"></div></div>
            <div class="cur-multi-item"><div class="skeleton-line w40"></div><div class="skeleton-line w60"></div></div>
            <div class="cur-multi-item"><div class="skeleton-line w40"></div><div class="skeleton-line w60"></div></div>
          `;
        }
        _origLoad();
      };
    }


    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  PREMIUM FEATURES: 6 Features
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

    // ‚îÄ‚îÄ 1. LIGHT/DARK MODE TOGGLE ‚îÄ‚îÄ
    window.toggleTheme = function () {
      const html = document.documentElement;
      const current = html.getAttribute('data-theme');
      const next = current === 'light' ? 'dark' : 'light';
      html.setAttribute('data-theme', next);
      localStorage.setItem('cw-theme', next);
      const btn = document.getElementById('theme-toggle');
      if (btn) btn.textContent = next === 'light' ? '‚òÄÔ∏è' : 'üåô';
    };
    // Initialize toggle icon
    setTimeout(() => {
      const btn = document.getElementById('theme-toggle');
      if (btn) {
        const current = document.documentElement.getAttribute('data-theme');
        btn.textContent = current === 'light' ? '‚òÄÔ∏è' : 'üåô';
      }
    }, 100);

    // ‚îÄ‚îÄ 2. COPY RESULTS BUTTON ‚îÄ‚îÄ
    // Auto-inject copy button into every .results panel
    const _origOpenCalcPremium = window.openCalc;
    window.openCalc = function (id) {
      _origOpenCalcPremium(id);
      setTimeout(() => {
        document.querySelectorAll('.results').forEach(r => {
          if (r.querySelector('.copy-results-btn')) return;
          const btn = document.createElement('button');
          btn.className = 'copy-results-btn';
          btn.innerHTML = 'üìã Copy Results';
          btn.onclick = function (e) {
            e.stopPropagation();
            const text = r.innerText.replace('üìã Copy Results', '').replace('‚úÖ Copied!', '').replace('üîó Share', '').replace('‚úÖ Link Copied!', '').trim();
            navigator.clipboard.writeText(text).then(() => {
              btn.innerHTML = '‚úÖ Copied!';
              btn.classList.add('copied');
              setTimeout(() => { btn.innerHTML = 'üìã Copy Results'; btn.classList.remove('copied'); }, 2000);
            });
          };
          r.appendChild(btn);

          // Also add share button
          if (!r.querySelector('.share-btn')) {
            const shareBtn = document.createElement('button');
            shareBtn.className = 'share-btn';
            shareBtn.innerHTML = 'üîó Share';
            shareBtn.onclick = function (e) {
              e.stopPropagation();
              // Get current calculator inputs
              const modal = document.getElementById('modal-overlay');
              const inputs = modal.querySelectorAll('input, select');
              const params = new URLSearchParams();
              params.set('calc', id);
              inputs.forEach(inp => {
                if (inp.id && inp.value) params.set(inp.id, inp.value);
              });
              const url = window.location.origin + window.location.pathname + '?' + params.toString();
              navigator.clipboard.writeText(url).then(() => {
                shareBtn.innerHTML = '‚úÖ Link Copied!';
                shareBtn.classList.add('shared');
                setTimeout(() => { shareBtn.innerHTML = 'üîó Share'; shareBtn.classList.remove('shared'); }, 2000);
              });
            };
            r.appendChild(shareBtn);
          }
        });
      }, 100);
    };

    // ‚îÄ‚îÄ 3. CHARTS (Mortgage, Compound Interest, BMI) ‚îÄ‚îÄ
    window.drawMortgageChart = function () {
      const container = document.getElementById('mortgage-chart');
      if (!container) return;
      let canvas = container.querySelector('canvas');
      if (!canvas) { canvas = document.createElement('canvas'); container.appendChild(canvas); }
      canvas.width = container.clientWidth - 20;
      canvas.height = 200;
      const ctx = canvas.getContext('2d');
      const principal = parseFloat(document.getElementById('mort-principal')?.value) || 300000;
      const rate = (parseFloat(document.getElementById('mort-rate')?.value) || 6) / 100 / 12;
      const years = parseFloat(document.getElementById('mort-years')?.value) || 30;
      const n = years * 12;
      const payment = principal * (rate * Math.pow(1 + rate, n)) / (Math.pow(1 + rate, n) - 1);
      let balance = principal; let totalInterest = 0; let totalPrincipal = 0;
      const balances = []; const intData = []; const prinData = [];
      for (let i = 0; i <= n; i += Math.max(1, Math.floor(n / 50))) {
        balances.push(balance);
        intData.push(totalInterest);
        prinData.push(totalPrincipal);
        for (let j = 0; j < Math.max(1, Math.floor(n / 50)) && balance > 0; j++) {
          const intPmt = balance * rate; totalInterest += intPmt;
          const prinPmt = payment - intPmt; totalPrincipal += prinPmt;
          balance = Math.max(0, balance - prinPmt);
        }
      }
      const maxVal = Math.max(principal, totalInterest + totalPrincipal);
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      const w = canvas.width; const h = canvas.height - 20;
      // Draw balance line
      ctx.beginPath(); ctx.strokeStyle = '#6C63FF'; ctx.lineWidth = 2;
      balances.forEach((b, i) => { const x = (i / (balances.length - 1)) * w; const y = h - (b / maxVal) * h; i === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y); });
      ctx.stroke();
      // Fill under
      ctx.lineTo(w, h); ctx.lineTo(0, h); ctx.closePath();
      ctx.fillStyle = 'rgba(108,99,255,0.1)'; ctx.fill();
      // Labels
      ctx.fillStyle = '#8888a0'; ctx.font = '10px Outfit';
      ctx.fillText('Year 0', 2, h + 14);
      ctx.fillText('Year ' + years, w - 45, h + 14);
      ctx.fillText('Balance', 2, 14);
    };

    window.drawCompoundChart = function () {
      const container = document.getElementById('compound-chart');
      if (!container) return;
      let canvas = container.querySelector('canvas');
      if (!canvas) { canvas = document.createElement('canvas'); container.appendChild(canvas); }
      canvas.width = container.clientWidth - 20;
      canvas.height = 200;
      const ctx = canvas.getContext('2d');
      const init = parseFloat(document.getElementById('ci-principal')?.value) || 10000;
      const rate = (parseFloat(document.getElementById('ci-rate')?.value) || 7) / 100;
      const years = parseFloat(document.getElementById('ci-years')?.value) || 10;
      const monthly = parseFloat(document.getElementById('ci-monthly')?.value) || 200;
      const points = [];
      for (let y = 0; y <= years; y++) {
        let val = init * Math.pow(1 + rate, y);
        if (monthly > 0) val += monthly * 12 * ((Math.pow(1 + rate, y) - 1) / rate);
        points.push(val);
      }
      const maxVal = points[points.length - 1] || 1;
      const w = canvas.width; const h = canvas.height - 20;
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      // Gradient fill
      const grad = ctx.createLinearGradient(0, 0, 0, h);
      grad.addColorStop(0, 'rgba(0,212,170,0.3)'); grad.addColorStop(1, 'rgba(0,212,170,0.02)');
      ctx.beginPath(); ctx.strokeStyle = '#00D4AA'; ctx.lineWidth = 2;
      points.forEach((v, i) => { const x = (i / years) * w; const y = h - (v / maxVal) * h; i === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y); });
      ctx.stroke(); ctx.lineTo(w, h); ctx.lineTo(0, h); ctx.closePath(); ctx.fillStyle = grad; ctx.fill();
      ctx.fillStyle = '#8888a0'; ctx.font = '10px Outfit';
      ctx.fillText('Year 0', 2, h + 14);
      ctx.fillText('Year ' + years, w - 45, h + 14);
      ctx.fillText('$' + Math.round(maxVal).toLocaleString(), 2, 14);
    };

    window.drawBMIChart = function (bmi) {
      const container = document.getElementById('bmi-chart');
      if (!container) return;
      let canvas = container.querySelector('canvas');
      if (!canvas) { canvas = document.createElement('canvas'); container.appendChild(canvas); }
      canvas.width = container.clientWidth - 20;
      canvas.height = 60;
      const ctx = canvas.getContext('2d');
      const w = canvas.width; const h = 30;
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      // BMI scale bar: 15 to 40
      const zones = [
        { min: 15, max: 18.5, color: '#42A5F5', label: 'Under' },
        { min: 18.5, max: 25, color: '#00D4AA', label: 'Normal' },
        { min: 25, max: 30, color: '#FFD93D', label: 'Over' },
        { min: 30, max: 40, color: '#FF6B9D', label: 'Obese' }
      ];
      zones.forEach(z => {
        const x1 = ((z.min - 15) / 25) * w; const x2 = ((z.max - 15) / 25) * w;
        ctx.fillStyle = z.color; ctx.globalAlpha = 0.3;
        ctx.fillRect(x1, 5, x2 - x1, h);
        ctx.globalAlpha = 1; ctx.fillStyle = z.color; ctx.font = '9px Outfit';
        ctx.fillText(z.label, x1 + 4, h + 18);
      });
      // Marker
      const markerX = Math.min(w, Math.max(0, ((bmi - 15) / 25) * w));
      ctx.fillStyle = '#ffffff'; ctx.beginPath();
      ctx.arc(markerX, 5 + h / 2, 6, 0, Math.PI * 2); ctx.fill();
      ctx.fillStyle = '#6C63FF'; ctx.beginPath();
      ctx.arc(markerX, 5 + h / 2, 4, 0, Math.PI * 2); ctx.fill();
      ctx.fillStyle = '#e8e8f0'; ctx.font = 'bold 10px Outfit';
      ctx.fillText(bmi.toFixed(1), markerX - 10, h + 30);
    };

    // ‚îÄ‚îÄ 4. PWA SERVICE WORKER ‚îÄ‚îÄ
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js').catch(() => { });
    }

    // ‚îÄ‚îÄ 5. FAVORITES / RECENTLY USED ‚îÄ‚îÄ
    window.cwFavorites = JSON.parse(localStorage.getItem('cw-favorites') || '[]');
    window.toggleFavorite = function (calcId, e) {
      if (e) e.stopPropagation();
      const idx = cwFavorites.indexOf(calcId);
      if (idx > -1) cwFavorites.splice(idx, 1);
      else cwFavorites.push(calcId);
      localStorage.setItem('cw-favorites', JSON.stringify(cwFavorites));
      renderFavorites();
      // Update star buttons
      document.querySelectorAll('.fav-star').forEach(s => {
        s.classList.toggle('active', cwFavorites.includes(s.dataset.calc));
        s.textContent = cwFavorites.includes(s.dataset.calc) ? '‚≠ê' : '‚òÜ';
      });
    };

    function renderFavorites() {
      const section = document.getElementById('fav-section');
      if (!section) return;
      const grid = section.querySelector('.fav-grid');
      if (cwFavorites.length === 0) { section.classList.remove('has-favs'); return; }
      section.classList.add('has-favs');
      grid.innerHTML = '';
      cwFavorites.forEach(id => {
        const card = document.querySelector(`.calc-card[onclick*="${id}"]`);
        if (!card) return;
        const name = card.querySelector('h3')?.textContent || id;
        const emoji = card.querySelector('.card-emoji')?.textContent || 'üßÆ';
        const chip = document.createElement('div');
        chip.className = 'fav-chip';
        chip.textContent = emoji + ' ' + name;
        chip.onclick = () => openCalc(id);
        grid.appendChild(chip);
      });
    }

    // Add star buttons to all calc cards and insert favorites section
    (function initFavorites() {
      // Insert favorites section before the first section
      const firstSection = document.querySelector('.section-title');
      if (firstSection) {
        const favSection = document.createElement('div');
        favSection.id = 'fav-section';
        favSection.className = 'fav-section';
        favSection.innerHTML = '<h3>‚≠ê Favorites</h3><div class="fav-grid"></div>';
        firstSection.parentElement.insertBefore(favSection, firstSection);
      }
      // Add stars to cards
      document.querySelectorAll('.calc-card').forEach(card => {
        const onclick = card.getAttribute('onclick') || '';
        const match = onclick.match(/openCalc\('([^']+)'\)/);
        if (!match) return;
        const calcId = match[1];
        const star = document.createElement('button');
        star.className = 'fav-star' + (cwFavorites.includes(calcId) ? ' active' : '');
        star.dataset.calc = calcId;
        star.textContent = cwFavorites.includes(calcId) ? '‚≠ê' : '‚òÜ';
        star.onclick = function (e) { toggleFavorite(calcId, e); };
        card.style.position = 'relative';
        card.appendChild(star);
      });
      renderFavorites();
    })();

    // ‚îÄ‚îÄ 6. SHARE RESULT LINKS (auto-open from URL) ‚îÄ‚îÄ
    (function checkShareURL() {
      const params = new URLSearchParams(window.location.search);
      const calcId = params.get('calc');
      if (calcId) {
        setTimeout(() => {
          openCalc(calcId);
          // Fill in inputs
          setTimeout(() => {
            params.forEach((val, key) => {
              if (key === 'calc') return;
              const el = document.getElementById(key);
              if (el) { el.value = val; el.dispatchEvent(new Event('input')); }
            });
            // Try clicking the calculate button
            setTimeout(() => {
              const btn = document.querySelector('#modal-overlay .calc-btn');
              if (btn) btn.click();
            }, 200);
          }, 200);
        }, 500);
      }
    })();

  </script>
</body>

</html>